<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Efficient R programming</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Efficient R programming.">
  <meta name="generator" content="bookdown 0.0.70 and GitBook 2.6.7">

  <meta property="og:title" content="Efficient R programming" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="<a href="https://csgillespie.github.io/efficientR/" class="uri">https://csgillespie.github.io/efficientR/</a>" />
  <meta property="og:image" content="<a href="https://csgillespie.github.io/efficientR/" class="uri">https://csgillespie.github.io/efficientR/</a>figures/full.png" />
  <meta property="og:description" content="Efficient R programming." />
  <meta name="github-repo" content="csgillespie/efficientR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Efficient R programming" />
  
  <meta name="twitter:description" content="Efficient R programming." />
  <meta name="twitter:image" content="<a href="https://csgillespie.github.io/efficientR/" class="uri">https://csgillespie.github.io/efficientR/</a>figures/full.png" />

<meta name="author" content="Colin Gillespie and Robin Lovelace">

<meta name="date" content="2016-05-04">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="pkgs.html">
<link rel="next" href="tidying-data-with-tidyr.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Efficient R programming</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction (Place holder page for preface)</a><ul>
<li class="chapter" data-level="1.1" data-path="package-dependencies.html"><a href="package-dependencies.html"><i class="fa fa-check"></i><b>1.1</b> Package Dependencies</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="efficient-set-up.html"><a href="efficient-set-up.html"><i class="fa fa-check"></i><b>2</b> Efficient set-up</a><ul>
<li class="chapter" data-level="2.1" data-path="top-5-tips-for-an-efficient-r-set-up.html"><a href="top-5-tips-for-an-efficient-r-set-up.html"><i class="fa fa-check"></i><b>2.1</b> Top 5 tips for an efficient R set-up</a></li>
<li class="chapter" data-level="2.2" data-path="operating-system.html"><a href="operating-system.html"><i class="fa fa-check"></i><b>2.2</b> Operating system</a><ul>
<li class="chapter" data-level="2.2.1" data-path="operating-system.html"><a href="operating-system.html#operating-system-and-resource-monitoring"><i class="fa fa-check"></i><b>2.2.1</b> Operating system and resource monitoring</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="r-version.html"><a href="r-version.html"><i class="fa fa-check"></i><b>2.3</b> R version</a><ul>
<li class="chapter" data-level="2.3.1" data-path="r-version.html"><a href="r-version.html#installing-r"><i class="fa fa-check"></i><b>2.3.1</b> Installing R</a></li>
<li class="chapter" data-level="2.3.2" data-path="r-version.html"><a href="r-version.html#updating-r"><i class="fa fa-check"></i><b>2.3.2</b> Updating R</a></li>
<li class="chapter" data-level="2.3.3" data-path="r-version.html"><a href="r-version.html#installing-r-packages"><i class="fa fa-check"></i><b>2.3.3</b> Installing R packages</a></li>
<li class="chapter" data-level="2.3.4" data-path="r-version.html"><a href="r-version.html#deps"><i class="fa fa-check"></i><b>2.3.4</b> Installing R packages with dependencies</a></li>
<li class="chapter" data-level="2.3.5" data-path="r-version.html"><a href="r-version.html#updating-r-packages"><i class="fa fa-check"></i><b>2.3.5</b> Updating R packages</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="r-startup.html"><a href="r-startup.html"><i class="fa fa-check"></i><b>2.4</b> R startup</a><ul>
<li class="chapter" data-level="2.4.1" data-path="r-startup.html"><a href="r-startup.html#r-startup-arguments"><i class="fa fa-check"></i><b>2.4.1</b> R startup arguments</a></li>
<li class="chapter" data-level="2.4.2" data-path="r-startup.html"><a href="r-startup.html#an-overview-of-rs-startup-files"><i class="fa fa-check"></i><b>2.4.2</b> An overview of R’s startup files</a></li>
<li class="chapter" data-level="2.4.3" data-path="r-startup.html"><a href="r-startup.html#the-location-of-startup-files"><i class="fa fa-check"></i><b>2.4.3</b> The location of startup files</a></li>
<li class="chapter" data-level="2.4.4" data-path="r-startup.html"><a href="r-startup.html#rprofile"><i class="fa fa-check"></i><b>2.4.4</b> The <code>.Rprofile</code> file</a></li>
<li class="chapter" data-level="2.4.5" data-path="r-startup.html"><a href="r-startup.html#example-.rprofile-settings"><i class="fa fa-check"></i><b>2.4.5</b> Example <code>.Rprofile</code> settings</a></li>
<li class="chapter" data-level="2.4.6" data-path="r-startup.html"><a href="r-startup.html#renviron"><i class="fa fa-check"></i><b>2.4.6</b> The <code>.Renviron</code> file</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="rstudio.html"><a href="rstudio.html"><i class="fa fa-check"></i><b>2.5</b> RStudio</a><ul>
<li class="chapter" data-level="2.5.1" data-path="rstudio.html"><a href="rstudio.html#install-rstudio"><i class="fa fa-check"></i><b>2.5.1</b> Installing and updating RStudio</a></li>
<li class="chapter" data-level="2.5.2" data-path="rstudio.html"><a href="rstudio.html#window-pane-layout"><i class="fa fa-check"></i><b>2.5.2</b> Window pane layout</a></li>
<li class="chapter" data-level="2.5.3" data-path="rstudio.html"><a href="rstudio.html#exercises-3"><i class="fa fa-check"></i><b>2.5.3</b> Exercises</a></li>
<li class="chapter" data-level="2.5.4" data-path="rstudio.html"><a href="rstudio.html#rstudio-options"><i class="fa fa-check"></i><b>2.5.4</b> RStudio options</a></li>
<li class="chapter" data-level="2.5.5" data-path="rstudio.html"><a href="rstudio.html#auto-completion"><i class="fa fa-check"></i><b>2.5.5</b> Auto-completion</a></li>
<li class="chapter" data-level="2.5.6" data-path="rstudio.html"><a href="rstudio.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>2.5.6</b> Keyboard shortcuts</a></li>
<li class="chapter" data-level="2.5.7" data-path="rstudio.html"><a href="rstudio.html#object-display-and-output-table"><i class="fa fa-check"></i><b>2.5.7</b> Object display and output table</a></li>
<li class="chapter" data-level="2.5.8" data-path="rstudio.html"><a href="rstudio.html#project-management"><i class="fa fa-check"></i><b>2.5.8</b> Project management</a></li>
<li class="chapter" data-level="2.5.9" data-path="rstudio.html"><a href="rstudio.html#exercises-4"><i class="fa fa-check"></i><b>2.5.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html"><i class="fa fa-check"></i><b>2.6</b> BLAS and alternative R interpreters</a><ul>
<li class="chapter" data-level="2.6.1" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#testing-performance-gains-from-blas"><i class="fa fa-check"></i><b>2.6.1</b> Testing performance gains from BLAS</a></li>
<li class="chapter" data-level="2.6.2" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#revolution-r"><i class="fa fa-check"></i><b>2.6.2</b> Revolution R</a></li>
<li class="chapter" data-level="2.6.3" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#other-interpreters"><i class="fa fa-check"></i><b>2.6.3</b> Other interpreters</a></li>
<li class="chapter" data-level="2.6.4" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#useful-blasbenchmarking-resources"><i class="fa fa-check"></i><b>2.6.4</b> Useful BLAS/benchmarking resources</a></li>
<li class="chapter" data-level="2.6.5" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#exercises-5"><i class="fa fa-check"></i><b>2.6.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>3</b> Efficient programming</a><ul>
<li class="chapter" data-level="3.1" data-path="general-advice.html"><a href="general-advice.html"><i class="fa fa-check"></i><b>3.1</b> General advice</a><ul>
<li class="chapter" data-level="3.1.1" data-path="general-advice.html"><a href="general-advice.html#memory-allocation"><i class="fa fa-check"></i><b>3.1.1</b> Memory allocation</a></li>
<li class="chapter" data-level="3.1.2" data-path="general-advice.html"><a href="general-advice.html#vectorised-code"><i class="fa fa-check"></i><b>3.1.2</b> Vectorised code</a></li>
<li class="chapter" data-level="" data-path="general-advice.html"><a href="general-advice.html#exercise-1"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="3.1.3" data-path="general-advice.html"><a href="general-advice.html#type-consistency"><i class="fa fa-check"></i><b>3.1.3</b> Type consistency</a></li>
<li class="chapter" data-level="3.1.4" data-path="general-advice.html"><a href="general-advice.html#invisible-returns"><i class="fa fa-check"></i><b>3.1.4</b> Invisible returns</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i><b>3.2</b> Factors</a><ul>
<li class="chapter" data-level="3.2.1" data-path="factors.html"><a href="factors.html#example-months-of-the-year"><i class="fa fa-check"></i><b>3.2.1</b> Example: Months of the year</a></li>
<li class="chapter" data-level="3.2.2" data-path="factors.html"><a href="factors.html#example-graphics"><i class="fa fa-check"></i><b>3.2.2</b> Example: Graphics</a></li>
<li class="chapter" data-level="3.2.3" data-path="factors.html"><a href="factors.html#example-analysis-of-variance"><i class="fa fa-check"></i><b>3.2.3</b> Example: Analysis of variance</a></li>
<li class="chapter" data-level="3.2.4" data-path="factors.html"><a href="factors.html#example-data-input"><i class="fa fa-check"></i><b>3.2.4</b> Example: data input</a></li>
<li class="chapter" data-level="3.2.5" data-path="factors.html"><a href="factors.html#example-factors-are-not-character-vectors"><i class="fa fa-check"></i><b>3.2.5</b> Example: Factors are not character vectors</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="S3.html"><a href="S3.html"><i class="fa fa-check"></i><b>3.3</b> S3 objects</a></li>
<li class="chapter" data-level="3.4" data-path="caching-variables.html"><a href="caching-variables.html"><i class="fa fa-check"></i><b>3.4</b> Caching variables</a><ul>
<li class="chapter" data-level="3.4.1" data-path="caching-variables.html"><a href="caching-variables.html#function-closures"><i class="fa fa-check"></i><b>3.4.1</b> Function closures</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="the-byte-compiler.html"><a href="the-byte-compiler.html"><i class="fa fa-check"></i><b>3.5</b> The byte compiler</a><ul>
<li class="chapter" data-level="3.5.1" data-path="the-byte-compiler.html"><a href="the-byte-compiler.html#example-the-mean-function"><i class="fa fa-check"></i><b>3.5.1</b> Example: the mean function</a></li>
<li class="chapter" data-level="3.5.2" data-path="the-byte-compiler.html"><a href="the-byte-compiler.html#compiling-code"><i class="fa fa-check"></i><b>3.5.2</b> Compiling code</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="parallel-computing.html"><a href="parallel-computing.html"><i class="fa fa-check"></i><b>3.6</b> Parallel computing</a><ul>
<li class="chapter" data-level="3.6.1" data-path="parallel-computing.html"><a href="parallel-computing.html#parallel-versions-of-apply-functions"><i class="fa fa-check"></i><b>3.6.1</b> Parallel versions of apply functions</a></li>
<li class="chapter" data-level="3.6.2" data-path="parallel-computing.html"><a href="parallel-computing.html#example-snakes-and-ladders"><i class="fa fa-check"></i><b>3.6.2</b> Example: Snakes and Ladders</a></li>
<li class="chapter" data-level="3.6.3" data-path="parallel-computing.html"><a href="parallel-computing.html#exit-functions-with-care"><i class="fa fa-check"></i><b>3.6.3</b> Exit functions with care</a></li>
<li class="chapter" data-level="3.6.4" data-path="parallel-computing.html"><a href="parallel-computing.html#process-forking"><i class="fa fa-check"></i><b>3.6.4</b> Process forking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="efficient-workflow.html"><a href="efficient-workflow.html"><i class="fa fa-check"></i><b>4</b> Efficient workflow</a><ul>
<li class="chapter" data-level="4.1" data-path="project-planning.html"><a href="project-planning.html"><i class="fa fa-check"></i><b>4.1</b> Project planning</a><ul>
<li class="chapter" data-level="4.1.1" data-path="project-planning.html"><a href="project-planning.html#chunking-your-work"><i class="fa fa-check"></i><b>4.1.1</b> ‘Chunking’ your work</a></li>
<li class="chapter" data-level="4.1.2" data-path="project-planning.html"><a href="project-planning.html#smart"><i class="fa fa-check"></i><b>4.1.2</b> Making your workflow SMART</a></li>
<li class="chapter" data-level="4.1.3" data-path="project-planning.html"><a href="project-planning.html#r-packages-for-planning"><i class="fa fa-check"></i><b>4.1.3</b> R packages for planning</a></li>
<li class="chapter" data-level="4.1.4" data-path="project-planning.html"><a href="project-planning.html#exercises-9"><i class="fa fa-check"></i><b>4.1.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="pkgs.html"><a href="pkgs.html"><i class="fa fa-check"></i><b>4.2</b> Package selection</a></li>
<li class="chapter" data-level="4.3" data-path="importing-data.html"><a href="importing-data.html"><i class="fa fa-check"></i><b>4.3</b> Importing data</a><ul>
<li class="chapter" data-level="4.3.1" data-path="importing-data.html"><a href="importing-data.html#fread"><i class="fa fa-check"></i><b>4.3.1</b> Fast data reading</a></li>
<li class="chapter" data-level="4.3.2" data-path="importing-data.html"><a href="importing-data.html#preprocessing-outside-r"><i class="fa fa-check"></i><b>4.3.2</b> Preprocessing outside R</a></li>
<li class="chapter" data-level="4.3.3" data-path="importing-data.html"><a href="importing-data.html#working-with-databases"><i class="fa fa-check"></i><b>4.3.3</b> Working with databases</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="tidying-data-with-tidyr.html"><a href="tidying-data-with-tidyr.html"><i class="fa fa-check"></i><b>4.4</b> Tidying data with tidyr</a></li>
<li class="chapter" data-level="4.5" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>4.5</b> Data processing with dplyr</a><ul>
<li class="chapter" data-level="4.5.1" data-path="dplyr.html"><a href="dplyr.html#renaming-columns"><i class="fa fa-check"></i><b>4.5.1</b> Renaming columns</a></li>
<li class="chapter" data-level="4.5.2" data-path="dplyr.html"><a href="dplyr.html#changing-column-classes"><i class="fa fa-check"></i><b>4.5.2</b> Changing column classes</a></li>
<li class="chapter" data-level="4.5.3" data-path="dplyr.html"><a href="dplyr.html#filtering-rows"><i class="fa fa-check"></i><b>4.5.3</b> Filtering rows</a></li>
<li class="chapter" data-level="4.5.4" data-path="dplyr.html"><a href="dplyr.html#filtering-columns"><i class="fa fa-check"></i><b>4.5.4</b> Filtering columns</a></li>
<li class="chapter" data-level="4.5.5" data-path="dplyr.html"><a href="dplyr.html#data-aggregation"><i class="fa fa-check"></i><b>4.5.5</b> Data aggregation</a></li>
<li class="chapter" data-level="4.5.6" data-path="dplyr.html"><a href="dplyr.html#chaining-operations"><i class="fa fa-check"></i><b>4.5.6</b> Chaining operations</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="data-processing-with-data-table.html"><a href="data-processing-with-data-table.html"><i class="fa fa-check"></i><b>4.6</b> Data processing with data.table</a></li>
<li class="chapter" data-level="4.7" data-path="publication.html"><a href="publication.html"><i class="fa fa-check"></i><b>4.7</b> Publication</a><ul>
<li class="chapter" data-level="4.7.1" data-path="publication.html"><a href="publication.html#dynamic-documents-with-knitr"><i class="fa fa-check"></i><b>4.7.1</b> Dynamic documents with knitr</a></li>
<li class="chapter" data-level="4.7.2" data-path="publication.html"><a href="publication.html#r-packages"><i class="fa fa-check"></i><b>4.7.2</b> R packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html"><i class="fa fa-check"></i><b>5</b> Efficient data carpentry</a></li>
<li class="chapter" data-level="6" data-path="efficient-visualisation.html"><a href="efficient-visualisation.html"><i class="fa fa-check"></i><b>6</b> Efficient visualisation</a><ul>
<li class="chapter" data-level="6.1" data-path="rough-outline.html"><a href="rough-outline.html"><i class="fa fa-check"></i><b>6.1</b> Rough outline</a></li>
<li class="chapter" data-level="6.2" data-path="cairo-type.html"><a href="cairo-type.html"><i class="fa fa-check"></i><b>6.2</b> Cairo type</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="efficient-performance.html"><a href="efficient-performance.html"><i class="fa fa-check"></i><b>7</b> Efficient performance</a><ul>
<li class="chapter" data-level="7.1" data-path="efficient-base-r.html"><a href="efficient-base-r.html"><i class="fa fa-check"></i><b>7.1</b> Efficient base R</a><ul>
<li><a href="efficient-base-r.html#the-if-vs-ifelse-functions">The <code>if</code> vs <code>ifelse</code> functions</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#sorting-and-ordering"><i class="fa fa-check"></i>Sorting and ordering</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#reversing-elements"><i class="fa fa-check"></i>Reversing elements</a></li>
<li><a href="efficient-base-r.html#which-indices-are-true">Which indices are <code>TRUE</code>  </a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#converting-factors-to-numerics"><i class="fa fa-check"></i>Converting factors to numerics</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#string-concatenation"><i class="fa fa-check"></i>String concatenation</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#logical-and-and-or"><i class="fa fa-check"></i>Logical AND and OR</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#row-and-column-operations"><i class="fa fa-check"></i>Row and column operations</a></li>
<li class="chapter" data-level="7.1.1" data-path="efficient-base-r.html"><a href="efficient-base-r.html#is.na-and-anyna"><i class="fa fa-check"></i><b>7.1.1</b> <code>is.na</code> and <code class="unnumbered">anyNA</code></a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#matrices"><i class="fa fa-check"></i>Matrices</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#efficient-data-structures"><i class="fa fa-check"></i>Efficient data structures</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#the-integer-data-type"><i class="fa fa-check"></i>The integer data type</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="code-profiling.html"><a href="code-profiling.html"><i class="fa fa-check"></i><b>7.2</b> Code profiling</a><ul>
<li class="chapter" data-level="7.2.1" data-path="code-profiling.html"><a href="code-profiling.html#getting-started-with-profvis"><i class="fa fa-check"></i><b>7.2.1</b> Getting started with <strong>profvis</strong></a></li>
<li class="chapter" data-level="7.2.2" data-path="code-profiling.html"><a href="code-profiling.html#example-monopoly-simulation"><i class="fa fa-check"></i><b>7.2.2</b> Example: Monopoly Simulation</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>7.3</b> Rcpp</a><ul>
<li class="chapter" data-level="7.3.1" data-path="rcpp.html"><a href="rcpp.html#pre-requisites"><i class="fa fa-check"></i><b>7.3.1</b> Pre-requisites</a></li>
<li class="chapter" data-level="7.3.2" data-path="rcpp.html"><a href="rcpp.html#simple-c"><i class="fa fa-check"></i><b>7.3.2</b> A simple C++ function</a></li>
<li class="chapter" data-level="7.3.3" data-path="rcpp.html"><a href="rcpp.html#cppfunction"><i class="fa fa-check"></i><b>7.3.3</b> The cppFunction command</a></li>
<li class="chapter" data-level="7.3.4" data-path="rcpp.html"><a href="rcpp.html#c-types"><i class="fa fa-check"></i><b>7.3.4</b> C++ data types</a></li>
<li class="chapter" data-level="7.3.5" data-path="rcpp.html"><a href="rcpp.html#sourcecpp"><i class="fa fa-check"></i><b>7.3.5</b> The <code>sourceCpp</code> function</a></li>
<li class="chapter" data-level="7.3.6" data-path="rcpp.html"><a href="rcpp.html#vectors-and-loops"><i class="fa fa-check"></i><b>7.3.6</b> Vectors and loops</a></li>
<li class="chapter" data-level="7.3.7" data-path="rcpp.html"><a href="rcpp.html#sugar"><i class="fa fa-check"></i><b>7.3.7</b> C++ with sugar on top</a></li>
<li class="chapter" data-level="7.3.8" data-path="rcpp.html"><a href="rcpp.html#rcpp-resources"><i class="fa fa-check"></i><b>7.3.8</b> Rcpp resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="efficient-hardware.html"><a href="efficient-hardware.html"><i class="fa fa-check"></i><b>8</b> Efficient hardware</a><ul>
<li class="chapter" data-level="8.1" data-path="background-what-is-a-byte.html"><a href="background-what-is-a-byte.html"><i class="fa fa-check"></i><b>8.1</b> Background: what is a byte?</a></li>
<li class="chapter" data-level="8.2" data-path="ram.html"><a href="ram.html"><i class="fa fa-check"></i><b>8.2</b> Random access memory: RAM</a></li>
<li class="chapter" data-level="8.3" data-path="hard-drives-hdd-vs-ssd.html"><a href="hard-drives-hdd-vs-ssd.html"><i class="fa fa-check"></i><b>8.3</b> Hard drives: HDD vs SSD</a></li>
<li class="chapter" data-level="8.4" data-path="operating-systems-32-bit-or-64-bit.html"><a href="operating-systems-32-bit-or-64-bit.html"><i class="fa fa-check"></i><b>8.4</b> Operating systems: 32-bit or 64-bit</a></li>
<li class="chapter" data-level="8.5" data-path="central-processing-unit-cpu.html"><a href="central-processing-unit-cpu.html"><i class="fa fa-check"></i><b>8.5</b> Central processing unit (CPU)</a></li>
<li class="chapter" data-level="8.6" data-path="cloud-computing.html"><a href="cloud-computing.html"><i class="fa fa-check"></i><b>8.6</b> Cloud computing</a><ul>
<li class="chapter" data-level="8.6.1" data-path="cloud-computing.html"><a href="cloud-computing.html#amazon-ec2"><i class="fa fa-check"></i><b>8.6.1</b> Amazon EC2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html"><i class="fa fa-check"></i><b>9</b> Efficient Collaboration</a><ul>
<li class="chapter" data-level="9.1" data-path="coding-style.html"><a href="coding-style.html"><i class="fa fa-check"></i><b>9.1</b> Coding style</a><ul>
<li class="chapter" data-level="9.1.1" data-path="coding-style.html"><a href="coding-style.html#reformatting-code-with-rstudio"><i class="fa fa-check"></i><b>9.1.1</b> Reformatting code with RStudio</a></li>
<li class="chapter" data-level="9.1.2" data-path="coding-style.html"><a href="coding-style.html#file-names"><i class="fa fa-check"></i><b>9.1.2</b> File names</a></li>
<li class="chapter" data-level="9.1.3" data-path="coding-style.html"><a href="coding-style.html#loading-packages"><i class="fa fa-check"></i><b>9.1.3</b> Loading packages</a></li>
<li class="chapter" data-level="9.1.4" data-path="coding-style.html"><a href="coding-style.html#commenting"><i class="fa fa-check"></i><b>9.1.4</b> Commenting</a></li>
<li class="chapter" data-level="9.1.5" data-path="coding-style.html"><a href="coding-style.html#object-names"><i class="fa fa-check"></i><b>9.1.5</b> Object names</a></li>
<li class="chapter" data-level="9.1.6" data-path="coding-style.html"><a href="coding-style.html#example-package"><i class="fa fa-check"></i><b>9.1.6</b> Example package</a></li>
<li class="chapter" data-level="9.1.7" data-path="coding-style.html"><a href="coding-style.html#assignment"><i class="fa fa-check"></i><b>9.1.7</b> Assignment</a></li>
<li class="chapter" data-level="9.1.8" data-path="coding-style.html"><a href="coding-style.html#spacing"><i class="fa fa-check"></i><b>9.1.8</b> Spacing</a></li>
<li class="chapter" data-level="9.1.9" data-path="coding-style.html"><a href="coding-style.html#indentation"><i class="fa fa-check"></i><b>9.1.9</b> Indentation</a></li>
<li class="chapter" data-level="9.1.10" data-path="coding-style.html"><a href="coding-style.html#curly-braces"><i class="fa fa-check"></i><b>9.1.10</b> Curly braces</a></li>
<li class="chapter" data-level="9.1.11" data-path="coding-style.html"><a href="coding-style.html#exercises-17"><i class="fa fa-check"></i><b>9.1.11</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="efficient-learning.html"><a href="efficient-learning.html"><i class="fa fa-check"></i><b>10</b> Efficient Learning</a><ul>
<li class="chapter" data-level="10.1" data-path="using-r-help.html"><a href="using-r-help.html"><i class="fa fa-check"></i><b>10.1</b> Using R Help</a></li>
<li class="chapter" data-level="10.2" data-path="reading-r-source-code.html"><a href="reading-r-source-code.html"><i class="fa fa-check"></i><b>10.2</b> Reading R source code</a></li>
<li class="chapter" data-level="10.3" data-path="learning-online.html"><a href="learning-online.html"><i class="fa fa-check"></i><b>10.3</b> Learning online</a><ul>
<li class="chapter" data-level="10.3.1" data-path="learning-online.html"><a href="learning-online.html#reproducible-example"><i class="fa fa-check"></i><b>10.3.1</b> Reproducible example</a></li>
<li class="chapter" data-level="10.3.2" data-path="learning-online.html"><a href="learning-online.html#minimal-data-set"><i class="fa fa-check"></i><b>10.3.2</b> Minimal data set</a></li>
<li class="chapter" data-level="10.3.3" data-path="learning-online.html"><a href="learning-online.html#minimal-example"><i class="fa fa-check"></i><b>10.3.3</b> Minimal example</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="online-resources.html"><a href="online-resources.html"><i class="fa fa-check"></i><b>10.4</b> Online resources</a><ul>
<li class="chapter" data-level="10.4.1" data-path="online-resources.html"><a href="online-resources.html#stackoverflow"><i class="fa fa-check"></i><b>10.4.1</b> Stackoverflow</a></li>
<li class="chapter" data-level="10.4.2" data-path="online-resources.html"><a href="online-resources.html#mailing-lists-help-dev-package"><i class="fa fa-check"></i><b>10.4.2</b> Mailing lists: help, dev, package</a></li>
<li class="chapter" data-level="10.4.3" data-path="online-resources.html"><a href="online-resources.html#r-bloggers"><i class="fa fa-check"></i><b>10.4.3</b> r-bloggers</a></li>
<li class="chapter" data-level="10.4.4" data-path="online-resources.html"><a href="online-resources.html#twitter-rstats"><i class="fa fa-check"></i><b>10.4.4</b> twitter: <code>#rstats</code></a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="conferences.html"><a href="conferences.html"><i class="fa fa-check"></i><b>10.5</b> Conferences</a><ul>
<li class="chapter" data-level="10.5.1" data-path="conferences.html"><a href="conferences.html#user"><i class="fa fa-check"></i><b>10.5.1</b> useR!</a></li>
<li class="chapter" data-level="10.5.2" data-path="conferences.html"><a href="conferences.html#local-groups"><i class="fa fa-check"></i><b>10.5.2</b> Local groups</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="code.html"><a href="code.html"><i class="fa fa-check"></i><b>10.6</b> Code</a></li>
<li class="chapter" data-level="10.7" data-path="look-at-the-source-code.html"><a href="look-at-the-source-code.html"><i class="fa fa-check"></i><b>10.7</b> Look at the source code</a><ul>
<li class="chapter" data-level="10.7.1" data-path="look-at-the-source-code.html"><a href="look-at-the-source-code.html#r-journal-and-journal-of-statistical-software"><i class="fa fa-check"></i><b>10.7.1</b> R-journal and Journal of Statistical Software</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="http://www.mas.ncl.ac.uk/~ncsg3/">Colin Gillespie</a>, Robin Lovelace</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Efficient R programming</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="importing-data" class="section level2">
<h2><span class="header-section-number">4.3</span> Importing data</h2>
<p>Before reading in data, it is worth considering a general principle for reproducible data management: never modify raw data files. Raw data should be seen as read-only, and contain information about its provenance. Keeping the original file name and including a comment about its origin are a couple of ways to improve reproducibility, even when the data are not publicly available. This is illustrated below with functions <code>download.file</code><a href="#fn15" class="footnoteRef" id="fnref15"><sup>15</sup></a> and <code>unzip</code> to download and unzip the dataset. This illustrates how R can automate processes that are often performed manually, e.g. through the graphical user interface of a web browser. The result of the code below is data stored neatly in the <code>data</code> directory ready to be read-in (note part of the dataset is also stored in the <strong>efficient</strong> package).</p>
<div class="rmdnote">
<p>
The data downloaded below is a multi-table dataset on Dutch naval expeditions used with permission from the CWI Database Architectures Group and described more fully at <a href="https://www.monetdb.org/Documentation/UserGuide/MonetDB-R">monetdb.org</a>. From this dataset we primarily use the ‘voyages’ table with lists Dutch shipping expeditions by their date of departure.
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url =<span class="st"> &quot;https://www.monetdb.org/sites/default/files/voc_tsvs.zip&quot;</span>
<span class="kw">download.file</span>(url, <span class="st">&quot;voc_tsvs.zip&quot;</span>) <span class="co"># download file</span>
<span class="kw">unzip</span>(<span class="st">&quot;voc_tsvs.zip&quot;</span>, <span class="dt">exdir =</span> <span class="st">&quot;data&quot;</span>) <span class="co"># unzip files</span>
<span class="kw">file.remove</span>(<span class="st">&quot;voc_tsvs.zip&quot;</span>) <span class="co"># tidy up by removing the zip file</span></code></pre></div>
<div class="rmdtip">
<p>
To avoid the file download stage, many functions for reading in data can accept urls and read directly from the internet. This is illustrated below for <code>read.csv()</code>:
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url =<span class="st"> &quot;https://www.osha.gov/dep/fatcat/FatalitiesFY10.csv&quot;</span>
df =<span class="st"> </span><span class="kw">read.csv</span>(url)</code></pre></div>
<p>There are now many R packages to assist with the download and import of data. The organisation <a href="https://ropensci.org/">ROpenSci</a> supports a number of these. The example below illustrates this using the WDI package (not supported by ROpenSci) which accesses the World Bank’s World Development Indicators:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;WDI&quot;</span>) <span class="co"># load the WDI library (must be installed)</span>
<span class="kw">WDIsearch</span>(<span class="st">&quot;CO2&quot;</span>) <span class="co"># search for data on a topic</span>
df =<span class="st"> </span><span class="kw">WDI</span>(<span class="dt">indicator =</span> <span class="st">&quot;EN.CO2.TRAN.ZS&quot;</span> ) <span class="co"># import data</span></code></pre></div>
<p>There will be situations where you cannot download the data directly or when the data cannot be made available. In this case, simply providing a comment relating to the data’s origin (e.g. <code># Downloaded from http://example.com</code>) before referring to the dataset can greatly improve the utility of the code to yourself and others.</p>
<div id="fread" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Fast data reading</h3>
<p>There is often more than one way to read data into R. Even a simple <code>.csv</code> file can be imported using a range of methods, with implications for computational efficiency. This section looks at three approaches: base R’s plain text reading functions such as <code>read.delim</code>, which are derived from <code>read.table</code>; the <strong>data.table</strong> approach, which uses the function <code>fread</code>; and the newer <strong>readr</strong> package which provides <code>read_csv</code> and other <code>read_</code> functions such as <code>read_tsv</code>.</p>
<div class="rmdnote">
<p>
Note that a function ‘derived from’ another in this context means that it calls another function. The functions such as <code>read.csv</code> and <code>read.delim</code> in fact are <em>wrappers</em> for the more generic function <code>read.table</code>. This can be seen in the source code of <code>read.csv</code>, for example, which shows that the function is roughly the equivalent of <code>read.table(file, header = TRUE, sep = “,”</code>.
</p>
</div>
<p>Although this section is focussed on reading text files, it demonstrate the wider principle that the speed and flexibility advantages of additional read functions can be offset by the disadvantages of addition package dependency (in terms of complexity and maintaining the code) for small datasets. The real benefits kick in on large datasets. Of course, there are some data types that <em>require</em> a certain package to load in R: the readstata13 package, for example, was developed solely to read in <code>.dta</code> files generated by versions of Stata 13 and above.</p>
<p>Figure <a href="importing-data.html#fig:readr-vs-base">4.3</a> demonstrates that the relative performance gains of the <strong>data.table</strong> and <strong>readr</strong> approaches increase with data size, especially so for data with many rows. Below around 1 MB <code>read.delim</code> is actually <em>faster</em> than <code>read_csv</code> while <code>fread</code> is much faster than both, although these savings are likely to be inconsequential for such small datasets.</p>
<p>For files beyond 100 MB in size <code>fread</code> and <code>read_csv</code> can be expected to be around <em>5 times faster</em> than <code>read.delim</code>. This efficiency gain may be inconsequential for a one-off file of 100 MB running on a fast computer (which still take less than a minute with <code>read.csv</code>), but could represent an important speed-up if you frequently load large text files.</p>
<div class="figure"><span id="fig:readr-vs-base"></span>
<img src="_main_files/figure-html/readr-vs-base-1.png" alt="TODO: Rerun. Benchmarks of base, data.table and readr functions for reading csv files. The facets ranging from 2 to 200 represent the number of columns." width="672" />
<p class="caption">
Figure 4.3: TODO: Rerun. Benchmarks of base, data.table and readr functions for reading csv files. The facets ranging from 2 to 200 represent the number of columns.
</p>
</div>
<p>When tested on a large (4 GB) .csv file it was found that <code>fread</code> and <code>read_csv</code> were almost identical in load times and that <code>read.csv</code> took around 5 times longer. This consumed more than 10 GB of RAM, making it unsuitable to run on many computers (see Section <a href="ram.html#ram">8.2</a> for more on memory). Note that both <strong>readr</strong> and base methods can be made faster by pre-specifying the column types at the outset, as illustrated in <a href="importing-data.html#fig:readr-vs-base">4.3</a> and described in the help files.</p>
<!-- Idea: test the functions on text data -->
<p>In some cases with R programming there is a trade-off between speed and robustness. This is illustrated below with reference to differences in how <strong>readr</strong>, <strong>data.table</strong> and base R approaches handle unexpected values. Table <a href="importing-data.html#tab:voyages">4.1</a> shows that <code>read_tsv</code> is around 3 times faster, re-enforcing the point that the benefits of efficient functions increase with dataset size (made with Figure <a href="importing-data.html#fig:readr-vs-base">4.3</a>). This is a small (1 MB) dataset: the relative difference between <code>fread</code> and <code>read_</code> functions will tend to decrease as dataset size increases.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;microbenchmark&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;readr&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;data.table&quot;</span>)
fname =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/voc_voyages.tsv&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;efficient&quot;</span>)
res_v =<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="dt">times =</span> <span class="dv">10</span>,
  <span class="dt">base_read =</span> voyages_base &lt;-<span class="st"> </span><span class="kw">read.delim</span>(fname),
  <span class="dt">readr_read =</span> voyages_readr &lt;-<span class="st"> </span><span class="kw">read_tsv</span>(fname),
  <span class="dt">dt_fread =</span> voyages_dt &lt;-<span class="st"> </span><span class="kw">fread</span>(fname))</code></pre></div>
<table>
<caption><span id="tab:voyages">Table 4.1: </span>Execution time of base, <strong>readr</strong> and <strong>data.table</strong> functions for reading in a 1 MB dataset relative to the mean execution time of <code>fread</code>, around 0.02 seconds on a modern computer.</caption>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="right">min</th>
<th align="right">mean</th>
<th align="right">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">base_read</td>
<td align="right">10.7</td>
<td align="right">11.1</td>
<td align="right">11.4</td>
</tr>
<tr class="even">
<td align="left">readr_read</td>
<td align="right">3.4</td>
<td align="right">4.7</td>
<td align="right">13.5</td>
</tr>
<tr class="odd">
<td align="left">dt_fread</td>
<td align="right">1.0</td>
<td align="right">1.0</td>
<td align="right">1.0</td>
</tr>
</tbody>
</table>
<p>The benchmark above produces warning messages (not shown) for the <code>read_tsv</code> and <code>fread</code> functions but not the slowest base function <code>read.delim</code>. An exploration of these functions can shed light on the speed/robustness trade-off.</p>
<ul>
<li>The <strong>readr</strong> function <code>read_csv</code> generates a warning for row 2841 in the <code>built</code> variable. This is because <code>read_*()</code> decides what class each variable is based on the first 1000 rows, rather than all rows, as base <code>read.*</code> functions do.</li>
</ul>
<p>As illustrated by printing the result for the row which generated a warning, the <code>read_tsv</code> output is more sensible than the <code>read.delim</code> output: <code>read.delim</code> coerced the date field into a factor based on a single entry which is a text. <code>read_tsv</code> coerced the variable into a numeric vector, as illustrated below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(voyages_base$built) <span class="co"># coerced to a factor</span>
<span class="co">#&gt; [1] &quot;factor&quot;</span>
<span class="kw">class</span>(voyages_readr$built) <span class="co"># numeric based on first 1000 rows</span>
<span class="co">#&gt; [1] &quot;numeric&quot;</span>
voyages_base$built[<span class="dv">2841</span>] <span class="co"># contains the text responsible for coercion</span>
<span class="co">#&gt; [1] 1721-01-01</span>
<span class="co">#&gt; 182 Levels:  1 784 1,86 1135 1594 1600 1612 1613 1614 1615 1619 ... taken 1672</span>
voyages_readr$built[<span class="dv">2841</span>] <span class="co"># an NA: text cannot be converted to numeric</span>
<span class="co">#&gt; [1] NA</span></code></pre></div>
<ul>
<li>The <strong>data.table</strong> function <code>fread</code> generates 5 warning messages stating that columns 2, 4, 9, 10 and 11 were <code>Bumped to type character on data row ...</code>, with the offending rows printed in place of <code>...</code>. Instead of changing the offending values to <code>NA</code>, as <strong>readr</strong> does for the <code>built</code> column (9), <code>fread</code> automatically converts any columns it thought of as numeric into characters.</li>
</ul>
<p>To summarise, the differences between base, <strong>readr</strong> and <strong>data.table</strong> functions for reading in data go beyond code execution times. The functions <code>read_csv</code> and <code>fread</code> boost speed partially at the expense of robustness because they decide column classes based on a small sample of available data. The similarities and differences between the approaches are summarised for the Dutch shipping data (described in a note at the beginning of this section) in Table <a href="importing-data.html#tab:colclasses">4.2</a>.</p>
<table>
<caption><span id="tab:colclasses">Table 4.2: </span>Execution time of base, <strong>readr</strong> and <strong>data.table</strong> functions for reading in a 1 MB dataset</caption>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">number</th>
<th align="left">boatname</th>
<th align="left">built</th>
<th align="left">departure_date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">base_read</td>
<td align="left">integer</td>
<td align="left">factor</td>
<td align="left">factor</td>
<td align="left">factor</td>
</tr>
<tr class="even">
<td align="left">readr_read</td>
<td align="left">integer</td>
<td align="left">character</td>
<td align="left">numeric</td>
<td align="left">Date</td>
</tr>
<tr class="odd">
<td align="left">dt_fread</td>
<td align="left">integer</td>
<td align="left">character</td>
<td align="left">character</td>
<td align="left">character</td>
</tr>
</tbody>
</table>
<p>Table <a href="importing-data.html#tab:colclasses">4.2</a> shows 4 main similarities and differences between the three read types of read function:</p>
<ul>
<li>For uniform data such as the ‘number’ variable in Table <a href="importing-data.html#tab:colclasses">4.2</a>, all reading methods yield the same result (integer in this case).</li>
<li>For columns that are obviously characters such as ‘boatname’, the base method results in factors (unless <code>stringsAsFactors</code> is set to <code>TRUE</code>) whereas <code>fread</code> and <code>read_csv</code> functions return characters.</li>
<li>For columns in which the first 1000 rows are of one type but which contain anomalies, such as ‘built’ and ‘departure_data’ in the shipping example, <code>fread</code> coerces the result to characters. <code>read_csv</code> and siblings, by contrast, keep the class that is correct for the first 1000 rows and sets the anomalous records to <code>NA</code>. This is illustrated in <a href="importing-data.html#tab:colclasses">4.2</a>, where <code>read_tsv</code> produces a <code>numeric</code> class for the ‘built’ variable, ignoring the non numeric text in row 2841.</li>
<li><code>read_*</code> functions generate objects of class <code>tbl_df</code>, an extension of the <code>data.frame</code>, as discussed in Section <a href="dplyr.html#dplyr">4.5</a>. <code>fread</code> generates objects of class <code>data.table</code>. These can be used as standard data frames but differ subtly in their behaviour.</li>
</ul>
<p>The wider point associated with these tests is that functions that save time can also lead to additional considerations or complexities your workflow. Taking a look at what is going on ‘under the hood’ of fast functions to increase speed, as we have done in this section, can help understand the knock-on consequences of choosing fast functions over slower functions from base R.</p>
</div>
<div id="preprocessing-outside-r" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Preprocessing outside R</h3>
<p>There are circumstances when datasets become too large to read directly into R. Reading in 4 GB text file using the functions tested above, for example, consumed all available RAM on an 16 GB machine! To overcome the limitation that R reads all data directly into RAM, external <em>stream processing</em> tools can be used to preprocess large text files. The following command, using the shell command <code>split</code>, for example, would break a large multi GB file many one GB chunks, each of which is more manageable for R:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">split</span> -b100m bigfile.csv</code></pre></div>
<p>The result is a series of files, set to 100 MB each with the <code>-b100m</code> argument in the above code. By default these will be called <code>xaa</code>, <code>xab</code> and which could be read in <em>one chunk at a time</em> (e.g. using <code>read.csv</code>, <code>fread</code> or <code>read_csv</code>, described in the previous section) without crashing most modern computers.</p>
<p>Splitting a large file into individual chunks may allow it to be read into R. This is not an efficient way to import large datasets, however, because it results in a non-random sample of the data this way. A more efficient way to work with very large datasets is via databases.</p>
</div>
<div id="working-with-databases" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Working with databases</h3>
<p>Instead of loading all the data into RAM, as R does, databases query data from the hard-disk. This can allow a subset of a very large dataset to be defined and read into R quickly, without having to load it first.</p>
<p>R can connect to databases in a number of ways. The most mature of these is via the <strong>RODBC</strong> package, which sets up links to external databases using the Open Database Connectivity (ODBC) API. The functionality of <strong>RODBC</strong> is described in the package’s vignette, accessed with <code>vignette(&quot;RODBC&quot;)</code>. <strong>RODBC</strong> connects to ‘traditional’ databases such as MySQL, PostgreSQL, Oracle and SQLite.</p>
<p>The function used to set-up a connection to an external database with RODBC is <code>odbcConnect</code>, which takes Data Source Name (<code>dsn =</code>), User ID (<code>uid =</code>) and password (<code>pwd</code>) as required arguments.</p>
<div class="rmdtip">
<p>
Be sure never to release your password by entering it directly into the command. Instead, we recommend saving sensitive information such as database passwords and API keys in <code>.Renviron</code>, described in <span class="citation">(<span class="citeproc-not-found" data-reference-id="ref"><strong>???</strong></span>)</span>(renviron). Assuming you had saved your password as the environment variable <code>PSWRD</code>, you could enter <code>pwd = Sys.getenv(“PSWRD”)</code> to minimise the risk of exposing your password through accidentally releasing the code or your session history.
</p>
</div>
<p>Recently there has been a shift to the ‘noSQL’ approach for storing large datasets. This is illustrated by the emergence and uptake of software such as MongoDB and Apache Cassandra, which have R interfaces via packages <a href="https://cran.r-project.org/web/packages/mongolite/index.html">mongolite</a> and <a href="https://cran.r-project.org/web/packages/RJDBC/index.html">RJDBC</a>, which can connect to Apache Cassandra data stores and any source compliant with the Java Database Connectivity (JDBC) API.</p>
<p>MonetDB is a recent alternative to traditional and noSQL approaches which offers substantial efficiency advantages for handling large datasets <span class="citation">(Kersten et al. <a href="#ref-kersten2011researcher">2011</a>)</span>. A tutorial on the <a href="https://www.monetdb.org/Documentation/UserGuide/MonetDB-R">MonetDB website</a> provides an excellent introduction to handling databases from within R. A new development showcased in this tutorial is the ability to interact with databases using exactly the same syntax used to interact with R objects stored in RAM. This innovation was made possible by <strong>dplyr</strong>, an R library for data processing that aims to provide a unified ‘front end’ to perform a wide range of analysis task on datasets using a variety of ‘back ends’ which do the number crunching. This is one of the main advantages of <strong>dplyr</strong> (see Section <a href="dplyr.html#dplyr">4.5</a>).</p>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-kersten2011researcher">
<p>Kersten, Martin L, Stratos Idreos, Stefan Manegold, Erietta Liarou, and others. 2011. “The Researcher’s Guide to the Data Deluge: Querying a Scientific Database in Just a Few Seconds.” <em>PVLDB Challenges and Visions</em> 3.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="15">
<li id="fn15"><p>Since R 3.2.3 the base function <code>download.file()</code> can be used to download from secure (<code>https://</code>) connections on any operating system.<a href="importing-data.html#fnref15">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="pkgs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tidying-data-with-tidyr.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/csgillespie/efficientR/edit/master/04-workflow.Rmd",
"text": "Edit"
},
"download": ["_main.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
