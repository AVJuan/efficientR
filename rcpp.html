<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Efficient R programming</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Efficient R programming">
  <meta name="generator" content="bookdown 0.0.70 and GitBook 2.6.7">

  <meta property="og:title" content="Efficient R programming" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="figures/full.png" />
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Efficient R programming" />
  
  
  <meta name="twitter:image" content="figures/full.png" />

<meta name="author" content="Colin Gillespie and Robin Lovelace">

<meta name="date" content="2016-05-04">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="code-profiling.html">
<link rel="next" href="efficient-hardware.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Efficient R programming</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction (Place holder page for preface)</a><ul>
<li class="chapter" data-level="1.1" data-path="package-dependencies.html"><a href="package-dependencies.html"><i class="fa fa-check"></i><b>1.1</b> Package Dependencies</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="efficient-set-up.html"><a href="efficient-set-up.html"><i class="fa fa-check"></i><b>2</b> Efficient set-up</a><ul>
<li class="chapter" data-level="2.1" data-path="top-5-tips-for-an-efficient-r-set-up.html"><a href="top-5-tips-for-an-efficient-r-set-up.html"><i class="fa fa-check"></i><b>2.1</b> Top 5 tips for an efficient R set-up</a></li>
<li class="chapter" data-level="2.2" data-path="operating-system.html"><a href="operating-system.html"><i class="fa fa-check"></i><b>2.2</b> Operating system</a><ul>
<li class="chapter" data-level="2.2.1" data-path="operating-system.html"><a href="operating-system.html#operating-system-and-resource-monitoring"><i class="fa fa-check"></i><b>2.2.1</b> Operating system and resource monitoring</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="r-version.html"><a href="r-version.html"><i class="fa fa-check"></i><b>2.3</b> R version</a><ul>
<li class="chapter" data-level="2.3.1" data-path="r-version.html"><a href="r-version.html#installing-r"><i class="fa fa-check"></i><b>2.3.1</b> Installing R</a></li>
<li class="chapter" data-level="2.3.2" data-path="r-version.html"><a href="r-version.html#updating-r"><i class="fa fa-check"></i><b>2.3.2</b> Updating R</a></li>
<li class="chapter" data-level="2.3.3" data-path="r-version.html"><a href="r-version.html#installing-r-packages"><i class="fa fa-check"></i><b>2.3.3</b> Installing R packages</a></li>
<li class="chapter" data-level="2.3.4" data-path="r-version.html"><a href="r-version.html#deps"><i class="fa fa-check"></i><b>2.3.4</b> Installing R packages with dependencies</a></li>
<li class="chapter" data-level="2.3.5" data-path="r-version.html"><a href="r-version.html#updating-r-packages"><i class="fa fa-check"></i><b>2.3.5</b> Updating R packages</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="r-startup.html"><a href="r-startup.html"><i class="fa fa-check"></i><b>2.4</b> R startup</a><ul>
<li class="chapter" data-level="2.4.1" data-path="r-startup.html"><a href="r-startup.html#r-startup-arguments"><i class="fa fa-check"></i><b>2.4.1</b> R startup arguments</a></li>
<li class="chapter" data-level="2.4.2" data-path="r-startup.html"><a href="r-startup.html#an-overview-of-rs-startup-files"><i class="fa fa-check"></i><b>2.4.2</b> An overview of R’s startup files</a></li>
<li class="chapter" data-level="2.4.3" data-path="r-startup.html"><a href="r-startup.html#the-location-of-startup-files"><i class="fa fa-check"></i><b>2.4.3</b> The location of startup files</a></li>
<li class="chapter" data-level="2.4.4" data-path="r-startup.html"><a href="r-startup.html#rprofile"><i class="fa fa-check"></i><b>2.4.4</b> The <code>.Rprofile</code> file</a></li>
<li class="chapter" data-level="2.4.5" data-path="r-startup.html"><a href="r-startup.html#example-.rprofile-settings"><i class="fa fa-check"></i><b>2.4.5</b> Example <code>.Rprofile</code> settings</a></li>
<li class="chapter" data-level="2.4.6" data-path="r-startup.html"><a href="r-startup.html#renviron"><i class="fa fa-check"></i><b>2.4.6</b> The <code>.Renviron</code> file</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="rstudio.html"><a href="rstudio.html"><i class="fa fa-check"></i><b>2.5</b> RStudio</a><ul>
<li class="chapter" data-level="2.5.1" data-path="rstudio.html"><a href="rstudio.html#install-rstudio"><i class="fa fa-check"></i><b>2.5.1</b> Installing and updating RStudio</a></li>
<li class="chapter" data-level="2.5.2" data-path="rstudio.html"><a href="rstudio.html#window-pane-layout"><i class="fa fa-check"></i><b>2.5.2</b> Window pane layout</a></li>
<li class="chapter" data-level="2.5.3" data-path="rstudio.html"><a href="rstudio.html#exercises-3"><i class="fa fa-check"></i><b>2.5.3</b> Exercises</a></li>
<li class="chapter" data-level="2.5.4" data-path="rstudio.html"><a href="rstudio.html#rstudio-options"><i class="fa fa-check"></i><b>2.5.4</b> RStudio options</a></li>
<li class="chapter" data-level="2.5.5" data-path="rstudio.html"><a href="rstudio.html#auto-completion"><i class="fa fa-check"></i><b>2.5.5</b> Auto-completion</a></li>
<li class="chapter" data-level="2.5.6" data-path="rstudio.html"><a href="rstudio.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>2.5.6</b> Keyboard shortcuts</a></li>
<li class="chapter" data-level="2.5.7" data-path="rstudio.html"><a href="rstudio.html#object-display-and-output-table"><i class="fa fa-check"></i><b>2.5.7</b> Object display and output table</a></li>
<li class="chapter" data-level="2.5.8" data-path="rstudio.html"><a href="rstudio.html#project-management"><i class="fa fa-check"></i><b>2.5.8</b> Project management</a></li>
<li class="chapter" data-level="2.5.9" data-path="rstudio.html"><a href="rstudio.html#exercises-4"><i class="fa fa-check"></i><b>2.5.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html"><i class="fa fa-check"></i><b>2.6</b> BLAS and alternative R interpreters</a><ul>
<li class="chapter" data-level="2.6.1" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#testing-performance-gains-from-blas"><i class="fa fa-check"></i><b>2.6.1</b> Testing performance gains from BLAS</a></li>
<li class="chapter" data-level="2.6.2" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#revolution-r"><i class="fa fa-check"></i><b>2.6.2</b> Revolution R</a></li>
<li class="chapter" data-level="2.6.3" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#other-interpreters"><i class="fa fa-check"></i><b>2.6.3</b> Other interpreters</a></li>
<li class="chapter" data-level="2.6.4" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#useful-blasbenchmarking-resources"><i class="fa fa-check"></i><b>2.6.4</b> Useful BLAS/benchmarking resources</a></li>
<li class="chapter" data-level="2.6.5" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#exercises-5"><i class="fa fa-check"></i><b>2.6.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>3</b> Efficient programming</a><ul>
<li class="chapter" data-level="3.1" data-path="general-advice.html"><a href="general-advice.html"><i class="fa fa-check"></i><b>3.1</b> General advice</a><ul>
<li class="chapter" data-level="3.1.1" data-path="general-advice.html"><a href="general-advice.html#memory-allocation"><i class="fa fa-check"></i><b>3.1.1</b> Memory allocation</a></li>
<li class="chapter" data-level="3.1.2" data-path="general-advice.html"><a href="general-advice.html#vectorised-code"><i class="fa fa-check"></i><b>3.1.2</b> Vectorised code</a></li>
<li class="chapter" data-level="" data-path="general-advice.html"><a href="general-advice.html#exercise-1"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="3.1.3" data-path="general-advice.html"><a href="general-advice.html#type-consistency"><i class="fa fa-check"></i><b>3.1.3</b> Type consistency</a></li>
<li class="chapter" data-level="3.1.4" data-path="general-advice.html"><a href="general-advice.html#invisible-returns"><i class="fa fa-check"></i><b>3.1.4</b> Invisible returns</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i><b>3.2</b> Factors</a><ul>
<li class="chapter" data-level="3.2.1" data-path="factors.html"><a href="factors.html#example-months-of-the-year"><i class="fa fa-check"></i><b>3.2.1</b> Example: Months of the year</a></li>
<li class="chapter" data-level="3.2.2" data-path="factors.html"><a href="factors.html#example-graphics"><i class="fa fa-check"></i><b>3.2.2</b> Example: Graphics</a></li>
<li class="chapter" data-level="3.2.3" data-path="factors.html"><a href="factors.html#example-analysis-of-variance"><i class="fa fa-check"></i><b>3.2.3</b> Example: Analysis of variance</a></li>
<li class="chapter" data-level="3.2.4" data-path="factors.html"><a href="factors.html#example-data-input"><i class="fa fa-check"></i><b>3.2.4</b> Example: data input</a></li>
<li class="chapter" data-level="3.2.5" data-path="factors.html"><a href="factors.html#example-factors-are-not-character-vectors"><i class="fa fa-check"></i><b>3.2.5</b> Example: Factors are not character vectors</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="S3.html"><a href="S3.html"><i class="fa fa-check"></i><b>3.3</b> S3 objects</a></li>
<li class="chapter" data-level="3.4" data-path="caching-variables.html"><a href="caching-variables.html"><i class="fa fa-check"></i><b>3.4</b> Caching variables</a><ul>
<li class="chapter" data-level="3.4.1" data-path="caching-variables.html"><a href="caching-variables.html#function-closures"><i class="fa fa-check"></i><b>3.4.1</b> Function closures</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="the-byte-compiler.html"><a href="the-byte-compiler.html"><i class="fa fa-check"></i><b>3.5</b> The byte compiler</a><ul>
<li class="chapter" data-level="3.5.1" data-path="the-byte-compiler.html"><a href="the-byte-compiler.html#example-the-mean-function"><i class="fa fa-check"></i><b>3.5.1</b> Example: the mean function</a></li>
<li class="chapter" data-level="3.5.2" data-path="the-byte-compiler.html"><a href="the-byte-compiler.html#compiling-code"><i class="fa fa-check"></i><b>3.5.2</b> Compiling code</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="parallel-computing.html"><a href="parallel-computing.html"><i class="fa fa-check"></i><b>3.6</b> Parallel computing</a><ul>
<li class="chapter" data-level="3.6.1" data-path="parallel-computing.html"><a href="parallel-computing.html#parallel-versions-of-apply-functions"><i class="fa fa-check"></i><b>3.6.1</b> Parallel versions of apply functions</a></li>
<li class="chapter" data-level="3.6.2" data-path="parallel-computing.html"><a href="parallel-computing.html#example-snakes-and-ladders"><i class="fa fa-check"></i><b>3.6.2</b> Example: Snakes and Ladders</a></li>
<li class="chapter" data-level="3.6.3" data-path="parallel-computing.html"><a href="parallel-computing.html#exit-functions-with-care"><i class="fa fa-check"></i><b>3.6.3</b> Exit functions with care</a></li>
<li class="chapter" data-level="3.6.4" data-path="parallel-computing.html"><a href="parallel-computing.html#process-forking"><i class="fa fa-check"></i><b>3.6.4</b> Process forking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="efficient-workflow.html"><a href="efficient-workflow.html"><i class="fa fa-check"></i><b>4</b> Efficient workflow</a><ul>
<li class="chapter" data-level="4.1" data-path="project-planning.html"><a href="project-planning.html"><i class="fa fa-check"></i><b>4.1</b> Project planning</a><ul>
<li class="chapter" data-level="4.1.1" data-path="project-planning.html"><a href="project-planning.html#chunking-your-work"><i class="fa fa-check"></i><b>4.1.1</b> ‘Chunking’ your work</a></li>
<li class="chapter" data-level="4.1.2" data-path="project-planning.html"><a href="project-planning.html#smart"><i class="fa fa-check"></i><b>4.1.2</b> Making your workflow SMART</a></li>
<li class="chapter" data-level="4.1.3" data-path="project-planning.html"><a href="project-planning.html#r-packages-for-planning"><i class="fa fa-check"></i><b>4.1.3</b> R packages for planning</a></li>
<li class="chapter" data-level="4.1.4" data-path="project-planning.html"><a href="project-planning.html#exercises-9"><i class="fa fa-check"></i><b>4.1.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="pkgs.html"><a href="pkgs.html"><i class="fa fa-check"></i><b>4.2</b> Package selection</a></li>
<li class="chapter" data-level="4.3" data-path="importing-data.html"><a href="importing-data.html"><i class="fa fa-check"></i><b>4.3</b> Importing data</a><ul>
<li class="chapter" data-level="4.3.1" data-path="importing-data.html"><a href="importing-data.html#fread"><i class="fa fa-check"></i><b>4.3.1</b> Fast data reading</a></li>
<li class="chapter" data-level="4.3.2" data-path="importing-data.html"><a href="importing-data.html#preprocessing-outside-r"><i class="fa fa-check"></i><b>4.3.2</b> Preprocessing outside R</a></li>
<li class="chapter" data-level="4.3.3" data-path="importing-data.html"><a href="importing-data.html#working-with-databases"><i class="fa fa-check"></i><b>4.3.3</b> Working with databases</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="tidying-data-with-tidyr.html"><a href="tidying-data-with-tidyr.html"><i class="fa fa-check"></i><b>4.4</b> Tidying data with tidyr</a></li>
<li class="chapter" data-level="4.5" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>4.5</b> Data processing with dplyr</a><ul>
<li class="chapter" data-level="4.5.1" data-path="dplyr.html"><a href="dplyr.html#renaming-columns"><i class="fa fa-check"></i><b>4.5.1</b> Renaming columns</a></li>
<li class="chapter" data-level="4.5.2" data-path="dplyr.html"><a href="dplyr.html#changing-column-classes"><i class="fa fa-check"></i><b>4.5.2</b> Changing column classes</a></li>
<li class="chapter" data-level="4.5.3" data-path="dplyr.html"><a href="dplyr.html#filtering-rows"><i class="fa fa-check"></i><b>4.5.3</b> Filtering rows</a></li>
<li class="chapter" data-level="4.5.4" data-path="dplyr.html"><a href="dplyr.html#filtering-columns"><i class="fa fa-check"></i><b>4.5.4</b> Filtering columns</a></li>
<li class="chapter" data-level="4.5.5" data-path="dplyr.html"><a href="dplyr.html#data-aggregation"><i class="fa fa-check"></i><b>4.5.5</b> Data aggregation</a></li>
<li class="chapter" data-level="4.5.6" data-path="dplyr.html"><a href="dplyr.html#chaining-operations"><i class="fa fa-check"></i><b>4.5.6</b> Chaining operations</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="data-processing-with-data-table.html"><a href="data-processing-with-data-table.html"><i class="fa fa-check"></i><b>4.6</b> Data processing with data.table</a></li>
<li class="chapter" data-level="4.7" data-path="publication.html"><a href="publication.html"><i class="fa fa-check"></i><b>4.7</b> Publication</a><ul>
<li class="chapter" data-level="4.7.1" data-path="publication.html"><a href="publication.html#dynamic-documents-with-knitr"><i class="fa fa-check"></i><b>4.7.1</b> Dynamic documents with knitr</a></li>
<li class="chapter" data-level="4.7.2" data-path="publication.html"><a href="publication.html#r-packages"><i class="fa fa-check"></i><b>4.7.2</b> R packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="efficient-data-capentry.html"><a href="efficient-data-capentry.html"><i class="fa fa-check"></i><b>5</b> Efficient data capentry</a></li>
<li class="chapter" data-level="6" data-path="efficient-visualisation.html"><a href="efficient-visualisation.html"><i class="fa fa-check"></i><b>6</b> Efficient visualisation</a><ul>
<li class="chapter" data-level="6.1" data-path="rough-outline.html"><a href="rough-outline.html"><i class="fa fa-check"></i><b>6.1</b> Rough outline</a></li>
<li class="chapter" data-level="6.2" data-path="cario-type.html"><a href="cario-type.html"><i class="fa fa-check"></i><b>6.2</b> Cario type</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="efficient-performance.html"><a href="efficient-performance.html"><i class="fa fa-check"></i><b>7</b> Efficient performance</a><ul>
<li class="chapter" data-level="7.1" data-path="efficient-base-r.html"><a href="efficient-base-r.html"><i class="fa fa-check"></i><b>7.1</b> Efficient base R</a><ul>
<li><a href="efficient-base-r.html#the-if-vs-ifelse-functions">The <code>if</code> vs <code>ifelse</code> functions</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#sorting-and-ordering"><i class="fa fa-check"></i>Sorting and ordering</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#reversing-elements"><i class="fa fa-check"></i>Reversing elements</a></li>
<li><a href="efficient-base-r.html#which-indices-are-true">Which indices are <code>TRUE</code>  </a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#converting-factors-to-numerics"><i class="fa fa-check"></i>Converting factors to numerics</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#string-concatenation"><i class="fa fa-check"></i>String concatenation</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#logical-and-and-or"><i class="fa fa-check"></i>Logical AND and OR</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#row-and-column-operations"><i class="fa fa-check"></i>Row and column operations</a></li>
<li class="chapter" data-level="7.1.1" data-path="efficient-base-r.html"><a href="efficient-base-r.html#is.na-and-anyna"><i class="fa fa-check"></i><b>7.1.1</b> <code>is.na</code> and <code class="unnumbered">anyNA</code></a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#matrices"><i class="fa fa-check"></i>Matrices</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#efficient-data-structures"><i class="fa fa-check"></i>Efficient data structures</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#the-integer-data-type"><i class="fa fa-check"></i>The integer data type</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="code-profiling.html"><a href="code-profiling.html"><i class="fa fa-check"></i><b>7.2</b> Code profiling</a><ul>
<li class="chapter" data-level="7.2.1" data-path="code-profiling.html"><a href="code-profiling.html#getting-started-with-profvis"><i class="fa fa-check"></i><b>7.2.1</b> Getting started with <strong>profvis</strong></a></li>
<li class="chapter" data-level="7.2.2" data-path="code-profiling.html"><a href="code-profiling.html#example-monopoly-simulation"><i class="fa fa-check"></i><b>7.2.2</b> Example: Monopoly Simulation</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>7.3</b> Rcpp</a><ul>
<li class="chapter" data-level="7.3.1" data-path="rcpp.html"><a href="rcpp.html#pre-requisites"><i class="fa fa-check"></i><b>7.3.1</b> Pre-requisites</a></li>
<li class="chapter" data-level="7.3.2" data-path="rcpp.html"><a href="rcpp.html#simple-c"><i class="fa fa-check"></i><b>7.3.2</b> A simple C++ function</a></li>
<li class="chapter" data-level="7.3.3" data-path="rcpp.html"><a href="rcpp.html#cppfunction"><i class="fa fa-check"></i><b>7.3.3</b> The cppFunction command</a></li>
<li class="chapter" data-level="7.3.4" data-path="rcpp.html"><a href="rcpp.html#c-types"><i class="fa fa-check"></i><b>7.3.4</b> C++ data types</a></li>
<li class="chapter" data-level="7.3.5" data-path="rcpp.html"><a href="rcpp.html#sourcecpp"><i class="fa fa-check"></i><b>7.3.5</b> The <code>sourceCpp</code> function</a></li>
<li class="chapter" data-level="7.3.6" data-path="rcpp.html"><a href="rcpp.html#vectors-and-loops"><i class="fa fa-check"></i><b>7.3.6</b> Vectors and loops</a></li>
<li class="chapter" data-level="7.3.7" data-path="rcpp.html"><a href="rcpp.html#sugar"><i class="fa fa-check"></i><b>7.3.7</b> C++ with sugar on top</a></li>
<li class="chapter" data-level="7.3.8" data-path="rcpp.html"><a href="rcpp.html#rcpp-resources"><i class="fa fa-check"></i><b>7.3.8</b> Rcpp resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="efficient-hardware.html"><a href="efficient-hardware.html"><i class="fa fa-check"></i><b>8</b> Efficient hardware</a><ul>
<li class="chapter" data-level="8.1" data-path="background-what-is-a-byte.html"><a href="background-what-is-a-byte.html"><i class="fa fa-check"></i><b>8.1</b> Background: what is a byte?</a></li>
<li class="chapter" data-level="8.2" data-path="ram.html"><a href="ram.html"><i class="fa fa-check"></i><b>8.2</b> Random access memory: RAM</a></li>
<li class="chapter" data-level="8.3" data-path="hard-drives-hdd-vs-ssd.html"><a href="hard-drives-hdd-vs-ssd.html"><i class="fa fa-check"></i><b>8.3</b> Hard drives: HDD vs SSD</a></li>
<li class="chapter" data-level="8.4" data-path="operating-systems-32-bit-or-64-bit.html"><a href="operating-systems-32-bit-or-64-bit.html"><i class="fa fa-check"></i><b>8.4</b> Operating systems: 32-bit or 64-bit</a></li>
<li class="chapter" data-level="8.5" data-path="central-processing-unit-cpu.html"><a href="central-processing-unit-cpu.html"><i class="fa fa-check"></i><b>8.5</b> Central processing unit (CPU)</a></li>
<li class="chapter" data-level="8.6" data-path="cloud-computing.html"><a href="cloud-computing.html"><i class="fa fa-check"></i><b>8.6</b> Cloud computing</a><ul>
<li class="chapter" data-level="8.6.1" data-path="cloud-computing.html"><a href="cloud-computing.html#amazon-ec2"><i class="fa fa-check"></i><b>8.6.1</b> Amazon EC2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html"><i class="fa fa-check"></i><b>9</b> Efficient Collaboration</a><ul>
<li class="chapter" data-level="9.1" data-path="coding-style.html"><a href="coding-style.html"><i class="fa fa-check"></i><b>9.1</b> Coding style</a><ul>
<li class="chapter" data-level="9.1.1" data-path="coding-style.html"><a href="coding-style.html#reformatting-code-with-rstudio"><i class="fa fa-check"></i><b>9.1.1</b> Reformatting code with RStudio</a></li>
<li class="chapter" data-level="9.1.2" data-path="coding-style.html"><a href="coding-style.html#file-names"><i class="fa fa-check"></i><b>9.1.2</b> File names</a></li>
<li class="chapter" data-level="9.1.3" data-path="coding-style.html"><a href="coding-style.html#loading-packages"><i class="fa fa-check"></i><b>9.1.3</b> Loading packages</a></li>
<li class="chapter" data-level="9.1.4" data-path="coding-style.html"><a href="coding-style.html#commenting"><i class="fa fa-check"></i><b>9.1.4</b> Commenting</a></li>
<li class="chapter" data-level="9.1.5" data-path="coding-style.html"><a href="coding-style.html#object-names"><i class="fa fa-check"></i><b>9.1.5</b> Object names</a></li>
<li class="chapter" data-level="9.1.6" data-path="coding-style.html"><a href="coding-style.html#example-package"><i class="fa fa-check"></i><b>9.1.6</b> Example package</a></li>
<li class="chapter" data-level="9.1.7" data-path="coding-style.html"><a href="coding-style.html#assignment"><i class="fa fa-check"></i><b>9.1.7</b> Assignment</a></li>
<li class="chapter" data-level="9.1.8" data-path="coding-style.html"><a href="coding-style.html#spacing"><i class="fa fa-check"></i><b>9.1.8</b> Spacing</a></li>
<li class="chapter" data-level="9.1.9" data-path="coding-style.html"><a href="coding-style.html#indentation"><i class="fa fa-check"></i><b>9.1.9</b> Indentation</a></li>
<li class="chapter" data-level="9.1.10" data-path="coding-style.html"><a href="coding-style.html#curly-braces"><i class="fa fa-check"></i><b>9.1.10</b> Curly braces</a></li>
<li class="chapter" data-level="9.1.11" data-path="coding-style.html"><a href="coding-style.html#exercises-17"><i class="fa fa-check"></i><b>9.1.11</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="efficient-learning.html"><a href="efficient-learning.html"><i class="fa fa-check"></i><b>10</b> Efficient Learning</a><ul>
<li class="chapter" data-level="10.1" data-path="using-r-help.html"><a href="using-r-help.html"><i class="fa fa-check"></i><b>10.1</b> Using R Help</a></li>
<li class="chapter" data-level="10.2" data-path="reading-r-source-code.html"><a href="reading-r-source-code.html"><i class="fa fa-check"></i><b>10.2</b> Reading R source code</a></li>
<li class="chapter" data-level="10.3" data-path="learning-online.html"><a href="learning-online.html"><i class="fa fa-check"></i><b>10.3</b> Learning online</a><ul>
<li class="chapter" data-level="10.3.1" data-path="learning-online.html"><a href="learning-online.html#reproducible-example"><i class="fa fa-check"></i><b>10.3.1</b> Reproducible example</a></li>
<li class="chapter" data-level="10.3.2" data-path="learning-online.html"><a href="learning-online.html#minimal-data-set"><i class="fa fa-check"></i><b>10.3.2</b> Minimal data set</a></li>
<li class="chapter" data-level="10.3.3" data-path="learning-online.html"><a href="learning-online.html#minimal-example"><i class="fa fa-check"></i><b>10.3.3</b> Minimal example</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="online-resources.html"><a href="online-resources.html"><i class="fa fa-check"></i><b>10.4</b> Online resources</a><ul>
<li class="chapter" data-level="10.4.1" data-path="online-resources.html"><a href="online-resources.html#stackoverflow"><i class="fa fa-check"></i><b>10.4.1</b> Stackoverflow</a></li>
<li class="chapter" data-level="10.4.2" data-path="online-resources.html"><a href="online-resources.html#mailing-lists-help-dev-package"><i class="fa fa-check"></i><b>10.4.2</b> Mailing lists: help, dev, package</a></li>
<li class="chapter" data-level="10.4.3" data-path="online-resources.html"><a href="online-resources.html#r-bloggers"><i class="fa fa-check"></i><b>10.4.3</b> r-bloggers</a></li>
<li class="chapter" data-level="10.4.4" data-path="online-resources.html"><a href="online-resources.html#twitter-rstats"><i class="fa fa-check"></i><b>10.4.4</b> twitter: <code>#rstats</code></a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="conferences.html"><a href="conferences.html"><i class="fa fa-check"></i><b>10.5</b> Conferences</a><ul>
<li class="chapter" data-level="10.5.1" data-path="conferences.html"><a href="conferences.html#user"><i class="fa fa-check"></i><b>10.5.1</b> useR!</a></li>
<li class="chapter" data-level="10.5.2" data-path="conferences.html"><a href="conferences.html#local-groups"><i class="fa fa-check"></i><b>10.5.2</b> Local groups</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="code.html"><a href="code.html"><i class="fa fa-check"></i><b>10.6</b> Code</a></li>
<li class="chapter" data-level="10.7" data-path="look-at-the-source-code.html"><a href="look-at-the-source-code.html"><i class="fa fa-check"></i><b>10.7</b> Look at the source code</a><ul>
<li class="chapter" data-level="10.7.1" data-path="look-at-the-source-code.html"><a href="look-at-the-source-code.html#r-journal-and-journal-of-statistical-software"><i class="fa fa-check"></i><b>10.7.1</b> R-journal and Journal of Statistical Software</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="http://www.mas.ncl.ac.uk/~ncsg3/">Colin Gillespie</a>, Robin Lovelace</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Efficient R programming</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rcpp" class="section level2">
<h2><span class="header-section-number">7.3</span> Rcpp</h2>
<p>Sometimes R is just slow. You’ve tried every trick you know, and your code is still crawling along. At this point you could consider rewriting key parts of your code in another, faster language. R has interfaces to other languages via packages, such as <strong>Rcpp</strong>, <strong>rJava</strong>, <strong>rPython</strong> and recently <strong>V8</strong>. These provide R interfaces to C++, Java, Python and JavaScript respectively. <strong>Rcpp</strong> is the most popular of these (Figure <a href="rcpp.html#fig:cranlog">7.2</a>).</p>
<div class="figure"><span id="fig:cranlog"></span>
<img src="_main_files/figure-html/cranlog-1.png" alt="Downloads per day from the RStudio CRAN mirror of packages that provide R interfaces to other languages." width="576" />
<p class="caption">
Figure 7.2: Downloads per day from the RStudio CRAN mirror of packages that provide R interfaces to other languages.
</p>
</div>
<p>C++ is a modern, fast and very well-supported language with libraries for performing many kinds of computational task. <strong>Rcpp</strong> makes incorporating C++ code into your R workflow easily.</p>
<p>Although C/Fortran routines can be used using the <code>.Call</code> function this is not recommended: using <code>.Call</code> can be a painful experience. <strong>Rcpp</strong> provides a friendly API (Application Program Interface) that lets you write high-performance code, bypassing R’s tricky C API. Typical bottlenecks that C++ addresses are loops and recursive functions.</p>
<p>C++ is a powerful programming language about which entire books have been written. This chapter therefore is focussed on getting started and provide a flavour of what is possible. It is structured as follows. After ensuring that your computer is set-up for <strong>Rcpp</strong> in Section <a href="rcpp.html#pre-requisites">7.3.1</a>, we proceed by creating a simple C++ function, to show how C++ compares with R (Section <a href="rcpp.html#simple-c">7.3.2</a>). This is converted into an R function using <code>cppFunction()</code> in Section <a href="rcpp.html#cppfunction">7.3.3</a>. The remainder of the chapter explains C++ data types (Section <a href="rcpp.html#c-types">7.3.4</a>), illustrates how to source C++ code directly (Section <a href="rcpp.html#sourcecpp">7.3.5</a>) and explains vectors (Section <a href="rcpp.html#vectors-and-loops">7.3.6</a>) <strong>Rcpp</strong> sugar (Section <a href="rcpp.html#sugar">7.3.7</a>) and finally provides guidance on further resources on the subject (Section <a href="rcpp.html#rcpp-resources">7.3.8</a>).</p>
<div id="pre-requisites" class="section level3">
<h3><span class="header-section-number">7.3.1</span> Pre-requisites</h3>
<p>To write and compile C++ functions, you need a working C++ compiler. The installation method depends on your operating system:</p>
<ul>
<li>Linux: A compiler should already be installed. Otherwise, install <code>r-base</code> and a compiler will be installed as a dependency.</li>
<li>Macs: Install <code>Xcode</code>.</li>
<li>Windows: Install <a href="http://cran.r-project.org/bin/windows/">Rtools</a>. Make sure you select the version that corresponds to your version of R.</li>
</ul>
<p>The code in this chapter was generated using version 0.12.4 of <strong>Rcpp</strong>. The latest version can be installed from CRAN:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;Rcpp&quot;</span>)</code></pre></div>
<p><strong>Rcpp</strong> is well documented, as illustrated by package’s <a href="https://cran.r-project.org/web/packages/Rcpp/">CRAN</a> page. In addition to its popularity, many other packages depend on <strong>Rcpp</strong>, which can be seen by looking at the <code>Reverse Imports</code> section.</p>
<p>To check that you have everything needed for this chapter, run the following piece of code from the course R package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">efficient::<span class="kw">test_rcpp</span>()
<span class="co">#&gt; Everything seems fine</span></code></pre></div>
</div>
<div id="simple-c" class="section level3">
<h3><span class="header-section-number">7.3.2</span> A simple C++ function</h3>
<p>A C++ function is similar to an R function: you pass a set of inputs to function, some code is run, a single object is returned. However there are some key differences.</p>
<ol style="list-style-type: decimal">
<li>In the C++ function each line must be terminated with <code>;</code> In R, we use <code>;</code> only when we have multiple statements on the same line.</li>
<li>We must declare object types in the C++ version. In particular we need to declare the types of the function arguments, return value and any intermediate objects we create.</li>
<li>The function must have an explicit <code>return</code> statement. Similar to R, there can be multiple returns, but the function will terminate when it hits it’s first <code>return</code> statement.</li>
<li>You do not use assignment when creating a function.</li>
<li>Object assignment must use <code>=</code> sign. The <code>&lt;-</code> operator isn’t valid.</li>
<li>One line comments can be created using <code>//</code>. Multi-line comments are created using <code>/*...*/</code></li>
</ol>
<p>Suppose we want to create a function that adds two numbers together. In R this would be a simple one line affair:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">add_r =<span class="st"> </span>function(x, y) x +<span class="st"> </span>y</code></pre></div>
<p>In C++ it is a bit more long winded</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="co">/* Return type double</span>
<span class="co"> * Two arguments, also doubles</span>
<span class="co"> */</span>
  <span class="dt">double</span> add_c(<span class="dt">double</span> x, <span class="dt">double</span> y) { 
    <span class="dt">double</span> value = x + y;
    <span class="kw">return</span> value;
  }</code></pre></div>
<p>If we were writing a C++ programme we would also need another function called <code>main</code>. We would then compile the code to obtain an executable. The executable is platform dependent. The beauty of using <strong>Rcpp</strong> is that it makes it very easy to call C++ functions from R and the user doesn’t have to worry about the platform, or compilers or the R/C++ interface.</p>
</div>
<div id="cppfunction" class="section level3">
<h3><span class="header-section-number">7.3.3</span> The cppFunction command</h3>
<p>Load the <strong>Rcpp</strong> package using the usual <code>library</code> function call:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;Rcpp&quot;</span>) </code></pre></div>
<p>Pass the C++ function created in the previous section as a text string argument to <code>cppFunction</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cppFunction</span>(<span class="st">&#39;</span>
<span class="st">  double add_c(double x, double y) {</span>
<span class="st">    double value = x + y;</span>
<span class="st">    return value;</span>
<span class="st">  }</span>
<span class="st">&#39;</span>)</code></pre></div>
<p><strong>Rcpp</strong> will magically compile the C++ code and construct a function that bridges the gap between R and C++. After running the above code, we now have access to the <code>add_c</code> function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">add_c
<span class="co">#&gt; function (x, y) </span>
<span class="co">#&gt; .Primitive(&quot;.Call&quot;)(&lt;pointer: 0x2b5daec978a0&gt;, x, y)</span></code></pre></div>
<p>We can call the <code>add_c</code> function in the usual way</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add_c</span>(<span class="dv">1</span>, <span class="dv">2</span>)
<span class="co">#&gt; [1] 3</span></code></pre></div>
<p>and we don’t have to worry about compilers. Also, if you include this function in a package, users don’t have to worry about any of the <strong>Rcpp</strong> magic. It just works.</p>
</div>
<div id="c-types" class="section level3">
<h3><span class="header-section-number">7.3.4</span> C++ data types</h3>
<p>The most basic type of variable is an integer, <code>int</code>. An <code>int</code> variable can store a value in the range <span class="math inline">\(-32768\)</span> to <span class="math inline">\(+32767\)</span>. (There is also something called an unsigned int, which goes from <span class="math inline">\(0\)</span> to <span class="math inline">\(65,535\)</span>). There are also <code>long int</code> data types, which range from <span class="math inline">\(0\)</span> to <span class="math inline">\(2^{31}-1\)</span>.}. To store floating point numbers, there are single precision numbers, <code>float</code> and double precision numbers, <code>double</code>. A <code>double</code> takes twice as much memory as a <code>float</code>. For <strong>single</strong> characters, we use the <code>char</code> data type.</p>
<table>
<caption><span id="tab:cpptypes">Table 7.1: </span>Overview of key C++ object types.</caption>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">char</td>
<td align="left">A single character.</td>
</tr>
<tr class="even">
<td align="left">int</td>
<td align="left">An integer.</td>
</tr>
<tr class="odd">
<td align="left">float</td>
<td align="left">A single precision floating point number.</td>
</tr>
<tr class="even">
<td align="left">double</td>
<td align="left">A double-precision floating point number.</td>
</tr>
<tr class="odd">
<td align="left">void</td>
<td align="left">A valueless quantity.</td>
</tr>
</tbody>
</table>
<p>A pointer object is a variable that points to an area of memory that has been given a name. Pointers are a very powerful, but primitive facility contained in the C++ language. They are very useful since rather than passing large objects around, we pass a pointer to the memory location; rather than pass the house, we just give the address. We won’t use pointers in this chapter, but mention them for completeness. Table @ref{tab:cpptypes} gives an overview.</p>
</div>
<div id="sourcecpp" class="section level3">
<h3><span class="header-section-number">7.3.5</span> The <code>sourceCpp</code> function</h3>
<p>The <code>cppFunction</code> is great for getting small examples up and running. But it is better practice to put your C++ code in a separate file (with file extension <code>cpp</code>) and use the function call <code>sourceCpp(&quot;path/to/file.cpp&quot;)</code> to compile them. However we need to include a few headers at the top of the file. The first line we add gives us access to the <strong>Rcpp</strong> functions. The file <code>Rcpp.h</code> contains a list of function and class definitions supplied by <strong>Rcpp</strong>. This file will be located where <strong>Rcpp</strong> is installed. Alternatively you can view it <a href="https://github.com/RcppCore/Rcpp">online</a>. The <code>include</code> line</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="ot">#include &lt;Rcpp.h&gt;</span></code></pre></div>
<p>causes the compiler to replace that lines with the contents of the named source file. This means that we can access the functions defined by <strong>Rcpp</strong>. To access the <strong>Rcpp</strong> functions we would have to type <code>Rcpp::function_1</code>. To avoid typing <code>Rcpp::</code>, we use the namespace facility</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</code></pre></div>
<p>Now we can just type <code>function_1</code>; this is the same concept that R uses for managing function name collisions when loading packages. Above each function we want to export/use in R, we add the tag</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="co">// [[Rcpp::export]]</span></code></pre></div>
<p>This would give the complete file</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="ot">#include &lt;Rcpp.h&gt;</span>
<span class="kw">using</span> <span class="kw">namespace</span> Rcpp;

<span class="co">// [[Rcpp::export]]</span>
<span class="dt">double</span> add_c(<span class="dt">double</span> x, <span class="dt">double</span> y) {
  <span class="dt">double</span> value = x + y;
  <span class="kw">return</span> value;
}</code></pre></div>
<p>There are two main benefits with putting your C++ functions in separate files. First, we have the benefit of syntax highlighting (RStudio has great support for C++ editing). Second, it’s easier to make syntax errors when the switching between R and C++ in the same file. To save space, we we’ll omit the headers for the remainder of the chapter.</p>
</div>
<div id="vectors-and-loops" class="section level3">
<h3><span class="header-section-number">7.3.6</span> Vectors and loops</h3>
<p>Let’s now consider a slightly more complicated example. Here we want to write our own function that calculates the mean. This is just an illustrative example: R’s version is much better and more robust to scale differences in our data. For comparison, let’s create a corresponding R function - this is the same function we used in chapter @ref{programming}. The function takes a single vector <code>x</code> as input, and returns the mean value, <code>m</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean_r =<span class="st"> </span>function(x) {
  m =<span class="st"> </span><span class="dv">0</span>
  n =<span class="st"> </span><span class="kw">length</span>(x)
  for(i in <span class="dv">1</span>:n)
    m =<span class="st"> </span>m +<span class="st"> </span>x[i]/n
  m
}</code></pre></div>
<p>This is a very bad R function. We should just use the base function <code>mean</code> for real world applications. However the purpose of <code>mean_r</code> is to provide a comparison for the C++ version, which we will write in a similar way.</p>
<p>In this example, we will let <strong>Rcpp</strong> smooth the interface between C++ and R by using the <code>NumericVector</code> data type. This <strong>Rcpp</strong> data type mirrors the R vector object type. Other common classes are: <code>IntegerVector</code>, <code>CharacterVector</code>, and <code>LogicalVector</code>.</p>
<p>In the C++ version of the mean function, we specify the arguments types: <code>x</code> (<code>NumericVector</code>) and the return value (<code>double</code>). The C++ version of the <code>mean</code> function is a few lines longer. Almost always, the corresponding C++ version will be, possibly much, longer.</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">double</span> mean_c(NumericVector x) {
  <span class="dt">int</span> i;
  <span class="dt">int</span> n = x.size();
  <span class="dt">double</span> mean = <span class="dv">0</span>;

  <span class="kw">for</span>(i=<span class="dv">0</span>; i&lt;n; i++) {
    mean = mean + x[i]/n;
  }
  <span class="kw">return</span> mean;
}</code></pre></div>
<p>To use the C++ function we need to source the file (remember to put the necessary headers in).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sourceCpp</span>(<span class="st">&quot;src/mean_c.cpp&quot;</span>)</code></pre></div>
<p>Although the C++ version is similar, there are a few crucial differences.</p>
<ol style="list-style-type: decimal">
<li>We use the <code>.size()</code> method to find the length of <code>x</code></li>
<li><p>The <code>for</code> loop has a more complicated syntax.</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">for</span> (variable initialization; condition; variable update ) {
  <span class="co">// Code to execute</span>
}</code></pre></div></li>
<li><p>C++ provides operators to modify variables in place. So <code>i++</code> increases the value of <code>i</code> by <code>1</code>. Similarly, we could rewrite part of the loop as</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">mean += x[i]/n;</code></pre></div>
The above code adds <code>x[i]/n</code> to the value of <code>mean</code>. Other similar operators are <code>-=</code>, <code>*=</code>, <code>/=</code> and <code>i--</code>.</li>
<li><p>A C++ vector starts at <code>0</code> <strong>not</strong> <code>1</code></p></li>
</ol>
<p>To compare the C++ and R functions, we’ll generate some normal random numbers for the comparison</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="fl">1e4</span>)</code></pre></div>
<p>Then call the <code>microbenchmark</code> function (results plotted in figure <a href="rcpp.html#fig:rcppcomp">7.3</a>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## com_mean_r is the compiled version of mean_r
z =<span class="st"> </span><span class="kw">microbenchmark</span>(
  <span class="kw">mean</span>(x), <span class="kw">mean_r</span>(x),
  <span class="kw">com_mean_r</span>(x), <span class="kw">mean_c</span>(x),
  <span class="dt">times=</span><span class="dv">1000</span>
)</code></pre></div>
<p>In this simple example, the Rcpp variant is around <span class="math inline">\(100\)</span> times faster than the corresponding R version. This sort of speed-up is not uncommon when switching to an Rcpp solution.</p>
<div class="figure"><span id="fig:rcppcomp"></span>
<img src="_main_files/figure-html/rcppcomp-1.png" alt="Comparison of mean functions." width="576" />
<p class="caption">
Figure 7.3: Comparison of mean functions.
</p>
</div>
<div id="exercises-13" class="section level4 unnumbered">
<h4>Exercises</h4>
<p>Consider the following piece of code</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">double</span> test1() {
  <span class="dt">double</span> a = <span class="fl">1.</span><span class="dv">0</span> / <span class="dv">81</span>;
  <span class="dt">double</span> b = <span class="dv">0</span>;
  <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">729</span>; ++ i)
    b = b + a;
  <span class="kw">return</span> b;
}</code></pre></div>
<ol style="list-style-type: decimal">
<li>Save the function <code>test1</code> in a separate file. Make sure it works.</li>
<li>Write a similar function in R and compare the speed of the C++ and R versions.</li>
<li>Create a function called <code>test2</code> where the <code>double</code> variables have been replaced by <code>float</code>. Do you still get the correct answer?</li>
<li>Change <code>b = b + a</code> to <code>b += a</code> to make you code more <code>C</code> like.</li>
<li>(Hard) What’s the difference between <code>i++</code> and <code>++i</code>?</li>
</ol>
</div>
<div id="matrices-1" class="section level4">
<h4><span class="header-section-number">7.3.6.1</span> Matrices</h4>
<p>Each vector type has a corresponding matrix equivalent: <code>NumericMatrix</code>, <code>IntegerMatrix</code>, <code>CharacterMatrix</code> and <code>LogicalMatrix</code>. We use these types in a similar way to how we used <code>NumericVector</code>’s. The main differences are:</p>
<ul>
<li><p>When we initialise, we need specify the number of rows and columns</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="co">// 10 rows, 5 columns</span>
NumericMatrix mat(<span class="dv">10</span>, <span class="dv">5</span>);
<span class="co">// Length 10</span>
NumericVector v(<span class="dv">10</span>);</code></pre></div></li>
<li>We subset using <code>()</code>, i.e. <code>mat(5, 4)</code>.</li>
<li>The first view in a matrix is <code>mat(0, 0)</code> - remember indexes start with <code>0</code>.</li>
<li><p>To determine the number of rows and columns, we use the <code>.nrow()</code> and <code>.ncol()</code> methods.</p></li>
</ul>
</div>
</div>
<div id="sugar" class="section level3">
<h3><span class="header-section-number">7.3.7</span> C++ with sugar on top</h3>
<p><strong>Rcpp</strong> sugar brings a higher-level of abstraction to C++ code written using the <strong>Rcpp</strong> API. What this means in practice is that we can write C++ code in the style of R. For example, suppose we wanted to find the squared difference of two vectors; a residual in regression. In R, we would we would use</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sq_diff_r =<span class="st"> </span>function(x, y) (x -<span class="st"> </span>y)^<span class="dv">2</span></code></pre></div>
<p>Rewriting the function in standard C++, we would more effort. Assuming we have the correct headers, we would try something like</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">NumericVector res_c(NumericVector x, NumericVector y) {
  <span class="dt">int</span> i;
  <span class="dt">int</span> n = x.size();
  NumericVector residuals(n);
  <span class="kw">for</span>(i=<span class="dv">0</span>; i&lt;n; i++) {
    residuals[i] = pow(x[i] - y[i], <span class="dv">2</span>);
  }
  <span class="kw">return</span> residuals;
}</code></pre></div>
<p>With <strong>Rcpp</strong> sugar we can rewrite this code to be more succinct and have more of an R feel:</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">NumericVector res_sugar(NumericVector x, NumericVector y) {
  <span class="kw">return</span> pow(x-y, <span class="dv">2</span>);
}</code></pre></div>
<p>In the above C++ code, the <code>pow</code> function and <code>x-y</code> are valid due to <strong>Rcpp</strong> sugar. Other functions that are available include the d/q/p/r statistical functions, such as <code>rnorm</code> and <code>pnorm</code>. The sweetened versions aren’t usually faster than the C++ version, but typically there’s very little difference between the two. However with the sugared variety, the code is shorter and is constantly being improved.</p>
<div id="exercises-14" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li>Construct an R version, <code>res_r</code> and compare the three function variants.</li>
<li>In the above example, <code>res_sugar</code> is faster than <code>res_c</code>. Do you know why?</li>
</ol>
</div>
</div>
<div id="rcpp-resources" class="section level3">
<h3><span class="header-section-number">7.3.8</span> Rcpp resources</h3>
<p>The aim of this section was to provide an introduction to <code>Rcpp</code>. One of the selling features of <code>Rcpp</code> is that there is a great deal of documentation available.</p>
<ul>
<li>The Rcpp <a href="http://www.rcpp.org/">website</a>;</li>
<li>The original Journal of Statistical Software paper describing <code>Rcpp</code> (<span class="citation">Eddelbuettel and François (<a href="#ref-Eddelbuettel2011">2011</a>)</span>) and the follow-up book (<span class="citation">Eddelbuettel (<a href="#ref-Eddelbuettel2013">2013</a>)</span>);</li>
<li>A very readable chapter on <code>Rcpp</code> that goes into a bit more detail than this section (<span class="citation">Wickham (<a href="#ref-Wickham2014">2014</a><a href="#ref-Wickham2014">a</a>)</span>);</li>
<li>The <code>Rcpp</code> section on the <a href="https://stackoverflow.com/questions/tagged/rcpp">stackoverflow</a> website. Questions are often answered by the <code>Rcpp</code> authors.</li>
</ul>

</div>
</div>
<!-- </div> -->
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Eddelbuettel2011">
<p>Eddelbuettel, Dirk, and Romain François. 2011. “Rcpp: Seamless R and C++ Integration.” <em>Journal of Statistical Software</em> 40 (8): 1–18.</p>
</div>
<div id="ref-Eddelbuettel2013">
<p>Eddelbuettel, Dirk. 2013. <em>Seamless R and C++ Integration with Rcpp</em>. Springer.</p>
</div>
<div id="ref-Wickham2014">
<p>Wickham, Hadley. 2014a. <em>Advanced R</em>. CRC Press.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="code-profiling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="efficient-hardware.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/csgillespie/efficientR/edit/master/07-performance.Rmd",
"text": "Edit"
},
"download": ["_main.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
