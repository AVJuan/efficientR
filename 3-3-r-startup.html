<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Colin Gillespie and Robin Lovelace" />

<meta name="date" content="2016-02-16" />

  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<title>Efficient R programming</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#building-the-book"><span class="toc-section-number">1</span> Building the book</a><ul>
<li><a href="1-1-dependencies-for-this-book.html#dependencies-for-this-book"><span class="toc-section-number">1.1</span> Dependencies for this book</a></li>
</ul></li>
<li><a href="2-introduction.html#introduction"><span class="toc-section-number">2</span> Introduction</a></li>
<li class="has-sub"><a href="3-efficient-set-up.html#efficient-set-up"><span class="toc-section-number">3</span> Efficient set-up</a><ul>
<li class="has-sub"><a href="3-1-operating-system.html#operating-system"><span class="toc-section-number">3.1</span> Operating system</a><ul>
<li><a href="3-1-operating-system.html#operating-system-and-resource-monitoring"><span class="toc-section-number">3.1.1</span> Operating system and resource monitoring</a></li>
<li><a href="3-1-operating-system.html#exercises"><span class="toc-section-number">3.1.2</span> Exercises</a></li>
</ul></li>
<li class="has-sub"><a href="3-2-r-version.html#r-version"><span class="toc-section-number">3.2</span> R version</a><ul>
<li><a href="3-2-r-version.html#installing-r"><span class="toc-section-number">3.2.1</span> Installing R</a></li>
<li><a href="3-2-r-version.html#updating-r"><span class="toc-section-number">3.2.2</span> Updating R</a></li>
<li><a href="3-2-r-version.html#installing-r-packages"><span class="toc-section-number">3.2.3</span> Installing R packages</a></li>
<li><a href="3-2-r-version.html#deps"><span class="toc-section-number">3.2.4</span> Installing R packages with dependencies</a></li>
<li><a href="3-2-r-version.html#updating-r-packages"><span class="toc-section-number">3.2.5</span> Updating R packages</a></li>
<li><a href="3-2-r-version.html#exercises-1"><span class="toc-section-number">3.2.6</span> Exercises</a></li>
</ul></li>
<li class="has-sub"><a href="3-3-r-startup.html#r-startup"><span class="toc-section-number">3.3</span> R startup</a><ul>
<li><a href="3-3-r-startup.html#rprofile"><span class="toc-section-number">3.3.1</span> The <code>.Rprofile</code> file</a></li>
<li><a href="3-3-r-startup.html#example-.rprofile-settings"><span class="toc-section-number">3.3.2</span> Example <code>.Rprofile</code> settings</a></li>
<li><a href="3-3-r-startup.html#renviron"><span class="toc-section-number">3.3.3</span> The <code>.Renviron</code> file</a></li>
<li><a href="3-3-r-startup.html#exercises-2"><span class="toc-section-number">3.3.4</span> Exercises</a></li>
</ul></li>
<li class="has-sub"><a href="3-4-rstudio.html#rstudio"><span class="toc-section-number">3.4</span> RStudio</a><ul>
<li><a href="3-4-rstudio.html#install-rstudio"><span class="toc-section-number">3.4.1</span> Installing and updating RStudio</a></li>
<li><a href="3-4-rstudio.html#window-pane-layout"><span class="toc-section-number">3.4.2</span> Window pane layout</a></li>
<li><a href="3-4-rstudio.html#exercises-3"><span class="toc-section-number">3.4.3</span> Exercises</a></li>
<li><a href="3-4-rstudio.html#rstudio-options"><span class="toc-section-number">3.4.4</span> RStudio options</a></li>
<li><a href="3-4-rstudio.html#auto-completion"><span class="toc-section-number">3.4.5</span> Auto-completion</a></li>
<li><a href="3-4-rstudio.html#keyboard-shortcuts"><span class="toc-section-number">3.4.6</span> Keyboard shortcuts</a></li>
<li><a href="3-4-rstudio.html#object-display-and-output-table"><span class="toc-section-number">3.4.7</span> Object display and output table</a></li>
<li><a href="3-4-rstudio.html#project-management"><span class="toc-section-number">3.4.8</span> Project management</a></li>
<li><a href="3-4-rstudio.html#exercises-4"><span class="toc-section-number">3.4.9</span> Exercises</a></li>
</ul></li>
<li class="has-sub"><a href="3-5-blas-and-alternative-r-interpreters.html#blas-and-alternative-r-interpreters"><span class="toc-section-number">3.5</span> BLAS and alternative R interpreters</a><ul>
<li><a href="3-5-blas-and-alternative-r-interpreters.html#revolution-r"><span class="toc-section-number">3.5.1</span> Revolution R</a></li>
<li><a href="3-5-blas-and-alternative-r-interpreters.html#other-interpreters"><span class="toc-section-number">3.5.2</span> Other interpreters</a></li>
<li><a href="3-5-blas-and-alternative-r-interpreters.html#useful-blasbenchmarking-resources"><span class="toc-section-number">3.5.3</span> Useful BLAS/benchmarking resources</a></li>
<li><a href="3-5-blas-and-alternative-r-interpreters.html#exercises-5"><span class="toc-section-number">3.5.4</span> Exercises</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="4-efficient-hardware.html#efficient-hardware"><span class="toc-section-number">4</span> Efficient hardware</a><ul>
<li><a href="4-1-introduction-what-is-a-byte.html#introduction-what-is-a-byte"><span class="toc-section-number">4.1</span> Introduction: what is a byte?</a></li>
<li class="has-sub"><a href="4-2-ram.html#ram"><span class="toc-section-number">4.2</span> Random access memory: RAM</a><ul>
<li><a href="4-2-ram.html#exercises-6"><span class="toc-section-number">4.2.1</span> Exercises</a></li>
</ul></li>
<li><a href="4-3-hard-drives-hdd-vs-ssd.html#hard-drives-hdd-vs-ssd"><span class="toc-section-number">4.3</span> Hard drives: HDD vs SSD</a></li>
<li class="has-sub"><a href="4-4-operating-systems-32-bit-or-64-bit.html#operating-systems-32-bit-or-64-bit"><span class="toc-section-number">4.4</span> Operating systems: 32-bit or 64-bit</a><ul>
<li><a href="4-4-operating-systems-32-bit-or-64-bit.html#exercises-7"><span class="toc-section-number">4.4.1</span> Exercises</a></li>
</ul></li>
<li><a href="4-5-central-processing-unit-cpu.html#central-processing-unit-cpu"><span class="toc-section-number">4.5</span> Central processing unit (CPU)</a></li>
<li class="has-sub"><a href="4-6-cloud-computing.html#cloud-computing"><span class="toc-section-number">4.6</span> Cloud computing</a><ul>
<li><a href="4-6-cloud-computing.html#amazon-ec2"><span class="toc-section-number">4.6.1</span> Amazon EC2</a></li>
<li><a href="4-6-cloud-computing.html#exercise"><span class="toc-section-number">4.6.2</span> Exercise</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="5-efficient-workflow.html#efficient-workflow"><span class="toc-section-number">5</span> Efficient workflow</a><ul>
<li class="has-sub"><a href="5-1-project-planning.html#project-planning"><span class="toc-section-number">5.1</span> Project planning</a><ul>
<li><a href="5-1-project-planning.html#exercises-8"><span class="toc-section-number">5.1.1</span> Exercises</a></li>
</ul></li>
<li><a href="5-2-pkgs.html#pkgs"><span class="toc-section-number">5.2</span> Package selection</a></li>
<li class="has-sub"><a href="5-3-importing-data.html#importing-data"><span class="toc-section-number">5.3</span> Importing data</a><ul>
<li><a href="5-3-importing-data.html#fast-data-reading"><span class="toc-section-number">5.3.1</span> Fast data reading</a></li>
<li><a href="5-3-importing-data.html#preprocessing-outside-r"><span class="toc-section-number">5.3.2</span> Preprocessing outside R</a></li>
<li><a href="5-3-importing-data.html#working-with-databases"><span class="toc-section-number">5.3.3</span> Working with databases</a></li>
</ul></li>
<li><a href="5-4-tidying-data-with-tidyr.html#tidying-data-with-tidyr"><span class="toc-section-number">5.4</span> Tidying data with <strong>tidyr</strong></a></li>
<li class="has-sub"><a href="5-5-dplyr.html#dplyr"><span class="toc-section-number">5.5</span> Data processing</a><ul>
<li><a href="5-5-dplyr.html#renaming-columns"><span class="toc-section-number">5.5.1</span> Renaming columns</a></li>
<li><a href="5-5-dplyr.html#filtering-rows"><span class="toc-section-number">5.5.2</span> Filtering rows</a></li>
<li><a href="5-5-dplyr.html#filtering-columns"><span class="toc-section-number">5.5.3</span> Filtering columns</a></li>
<li><a href="5-5-dplyr.html#data-aggregation"><span class="toc-section-number">5.5.4</span> Data aggregation</a></li>
</ul></li>
<li class="has-sub"><a href="5-6-updating-column-classes.html#updating-column-classes"><span class="toc-section-number">5.6</span> Updating column classes</a><ul>
<li><a href="5-6-updating-column-classes.html#chaining-operations-with-dplyr"><span class="toc-section-number">5.6.1</span> Chaining operations with <strong>dplyr</strong></a></li>
<li><a href="5-6-updating-column-classes.html#data.table"><span class="toc-section-number">5.6.2</span> <strong>data.table</strong></a></li>
</ul></li>
<li><a href="5-7-publication.html#publication"><span class="toc-section-number">5.7</span> Publication</a></li>
</ul></li>
<li><a href="6-efficient-collaboration.html#efficient-collaboration"><span class="toc-section-number">6</span> Efficient collaboration</a></li>
<li class="has-sub"><a href="7-efficient-programming.html#efficient-programming"><span class="toc-section-number">7</span> Efficient programming</a><ul>
<li class="has-sub"><a href="7-1-data-types.html#data-types"><span class="toc-section-number">7.1</span> Data types</a><ul>
<li><a href="7-1-data-types.html#vectors"><span class="toc-section-number">7.1.1</span> Vectors</a></li>
<li><a href="7-1-data-types.html#factors"><span class="toc-section-number">7.1.2</span> Factors</a></li>
<li><a href="7-1-data-types.html#data-frames"><span class="toc-section-number">7.1.3</span> Data frames</a></li>
<li><a href="7-1-data-types.html#matrix"><span class="toc-section-number">7.1.4</span> Matrix</a></li>
<li><a href="7-1-data-types.html#S3"><span class="toc-section-number">7.1.5</span> S3 objects</a></li>
<li><a href="7-1-data-types.html#efficient-data-structures"><span class="toc-section-number">7.1.6</span> Efficient data structures</a></li>
</ul></li>
<li class="has-sub"><a href="7-2-good-programming-techniques.html#good-programming-techniques"><span class="toc-section-number">7.2</span> Good programming techniques</a><ul>
<li><a href="7-2-good-programming-techniques.html#general-tips"><span class="toc-section-number">7.2.1</span> General tips</a></li>
<li><a href="7-2-good-programming-techniques.html#caching-variables"><span class="toc-section-number">7.2.2</span> Caching variables</a></li>
<li><a href="7-2-good-programming-techniques.html#function-closures"><span class="toc-section-number">7.2.3</span> Function closures</a></li>
<li><a href="7-2-good-programming-techniques.html#vectorised-code"><span class="toc-section-number">7.2.4</span> Vectorised code</a></li>
</ul></li>
<li class="has-sub"><a href="7-3-parallel-computing.html#parallel-computing"><span class="toc-section-number">7.3</span> Parallel computing</a><ul>
<li><a href="7-3-parallel-computing.html#parallel-versions-of-apply-functions"><span class="toc-section-number">7.3.1</span> Parallel versions of apply functions</a></li>
<li><a href="7-3-parallel-computing.html#example-parallel-bootstraping"><span class="toc-section-number">7.3.2</span> Example: parallel bootstraping</a></li>
<li><a href="7-3-parallel-computing.html#process-forking"><span class="toc-section-number">7.3.3</span> Process forking</a></li>
</ul></li>
<li class="has-sub"><a href="7-4-the-byte-compiler.html#the-byte-compiler"><span class="toc-section-number">7.4</span> The byte compiler</a><ul>
<li><a href="7-4-the-byte-compiler.html#example-the-mean-function"><span class="toc-section-number">7.4.1</span> Example: the mean function</a></li>
<li><a href="7-4-the-byte-compiler.html#compiling-code"><span class="toc-section-number">7.4.2</span> Compiling code</a></li>
</ul></li>
</ul></li>
<li><a href="8-efficient-rcpp.html#efficient-rcpp"><span class="toc-section-number">8</span> Efficient Rcpp</a></li>
<li><a href="9-efficient-memory.html#efficient-memory"><span class="toc-section-number">9</span> Efficient Memory</a></li>
<li><a href="10-efficient-learning.html#efficient-learning"><span class="toc-section-number">10</span> Efficient Learning</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="r-startup" class="section level2">
<h2><span class="header-section-number">3.3</span> R startup</h2>
<p>Every time R starts, a number of files are read, in a particular order. The contents of these files determine how R performs for the duration of the session. Note that these files should only be changed with caution, as they may make your R version behave differently to other R installations. This could reduce the reproducibility of your code.</p>
<p>Files in three folders are important in this process:</p>
<ul>
<li><p><code>R_HOME</code>, the directory in which R is installed. The <code>etc</code> sub-directory can contain start-up files read early on in the start-up process. Find out where your <code>R_HOME</code> is with the <code>R.home()</code> command.</p></li>
<li><p><code>HOME</code>, the user’s home directory. Typically this is <code>/home/username</code> on Unix machines or <code>C:\Users\username</code> on Windows (since Windows 7). Ask R where your home directory with, <code>path.expand(&quot;~&quot;)</code> (note the use of the Unix-like tilde to represent the home directory).</p></li>
<li><p>R’s current working directory. This is reported by <code>getwd()</code>.</p></li>
</ul>
<p>It is important to know the location of the <code>.Rprofile</code> and <code>.Renviron</code> set-up files that are being used out of these three options. R only uses one <code>.Rprofile</code> and one <code>.Renviron</code> in any session: if you have a <code>.Rprofile</code> file in your current project, R will ignore <code>.Rprofile</code> in <code>R_HOME</code> and <code>HOME</code>. Likewise, <code>.Rprofile</code> in <code>HOME</code> overrides <code>.Rprofile</code> in <code>R_HOME</code>. The same applies to <code>.Renviron</code>: you should remember that adding project specific environment variables with <code>.Renviron</code> will de-activate other <code>.Renviron</code> files.</p>
<p>To create a project-specific start-up script, simply create a <code>.Rprofile</code> file in the project’s root directory and start adding R code, e.g. via <code>file.edit(&quot;.Rprofile&quot;)</code>. Remember that this will make <code>.Rprofile</code> in the home directory be ignored. The following commands will open your <code>.Rprofile</code> from within an R editor:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">file.edit</span>(<span class="kw">file.path</span>(<span class="st">&quot;~&quot;</span>, <span class="st">&quot;.Rprofile&quot;</span>)) <span class="co"># edit .Rprofile in HOME</span>
<span class="kw">file.edit</span>(<span class="st">&quot;.Rprofile&quot;</span>) <span class="co"># edit project specific .Rprofile</span></code></pre></div>
<p>Note that editing the <code>.Renviron</code> file in the same locations will have the same effect. The following code will create a user specific <code>.Renviron</code> file (where API keys and other cross-project environment variables can be stored), without overwriting any existing file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">user_renviron =<span class="st"> </span><span class="kw">path.expand</span>(<span class="kw">file.path</span>(<span class="st">&quot;~&quot;</span>, <span class="st">&quot;.Renviron&quot;</span>))
if(!<span class="kw">file.exists</span>(user_renviron)) <span class="co"># check to see if the file already exists</span>
  <span class="kw">file.create</span>(user_renviron)
<span class="kw">file.edit</span>(user_renviron) <span class="co"># open with another text editor if this fails</span></code></pre></div>
<p>The location, contents and uses of each is outlined in more detail below.</p>
<div id="rprofile" class="section level3">
<h3><span class="header-section-number">3.3.1</span> The <code>.Rprofile</code> file</h3>
<p>By default R looks for and runs <code>.Rprofile</code> files in the three locations described above, in a specific order. <code>.Rprofile</code> files are simply R scripts that run each time R runs and they can be found within <code>R_HOME</code>, <code>HOME</code> and the project’s home directory, found with <code>getwd()</code>. To check if you have a site-wide <code>.Rprofile</code>, which will run for all users on start-up, run:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">site_path =<span class="st"> </span><span class="kw">R.home</span>(<span class="dt">component =</span> <span class="st">&quot;home&quot;</span>)
fname =<span class="st"> </span><span class="kw">file.path</span>(site_path, <span class="st">&quot;etc&quot;</span>, <span class="st">&quot;Rprofile.site&quot;</span>)
<span class="kw">file.exists</span>(fname)</code></pre></div>
<p>The above code checks for the presence of <code>Rprofile.site</code> in that directory. As outlined above, the <code>.Rprofile</code> located in your home directory is user-specific. Again, we can test whether this file exists using</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">file.exists</span>(<span class="st">&quot;~/.Rprofile&quot;</span>)</code></pre></div>
<p>We can use R to create and edit <code>.Rprofile</code> (warning: do not overwrite your previous <code>.Rprofile</code> - we suggest you try project-specific <code>.Rprofile</code> first):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if(!<span class="kw">file.exists</span>(<span class="st">&quot;~/.Rprofile&quot;</span>)) <span class="co"># only create if not already there</span>
  <span class="kw">file.create</span>(<span class="st">&quot;~/.Rprofile&quot;</span>)    <span class="co"># (don&#39;t overwrite it)</span>
<span class="kw">file.edit</span>(<span class="st">&quot;~/.Rprofile&quot;</span>)</code></pre></div>
</div>
<div id="example-.rprofile-settings" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Example <code>.Rprofile</code> settings</h3>
<p>An <code>.Rprofile</code> file is just an R script that is run at start-up. The examples at the bottom of the <code>.Rprofile</code> help file</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">help</span>(<span class="st">&quot;Rprofile&quot;</span>)</code></pre></div>
<p>give clues as to the types of things we could place in our profile.</p>
<div id="setting-options" class="section level4">
<h4><span class="header-section-number">3.3.2.1</span> Setting options</h4>
<p>The function <code>options</code> is a list that contains a number of default options. See <code>help(&quot;options&quot;)</code> or simply type <code>options()</code> to get an idea of what we can configure. In my <code>.Rprofile</code> file, we have the line</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">prompt=</span><span class="st">&quot;R&gt; &quot;</span>, <span class="dt">digits=</span><span class="dv">4</span>, <span class="dt">show.signif.stars=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>This changes three features.</p>
<ul>
<li>The R prompt, from the boring <code>&gt;</code> to the exciting <code>R&gt;</code>.</li>
<li>The number of digits displayed.</li>
<li>Removing the stars after significant <span class="math inline">\(p\)</span>-values.</li>
</ul>
<p>Typically we want to avoid adding options to the start-up file that make our code non-portable. For example, adding</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>to your start-up script has knock-on effects for <code>read.table</code> and related functions including <code>read.csv</code>, making them convert text strings into characters rather than into factors as is default. This may be useful for you, but it is dangerous as it may make your code less portable.</p>
</div>
<div id="setting-the-cran-mirror" class="section level4">
<h4><span class="header-section-number">3.3.2.2</span> Setting the CRAN mirror</h4>
<p>To avoid setting the CRAN mirror each time you run <code>install.packages</code> you can permanently set the mirror in your <code>.Rprofile</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## local creates a new, empty environment
## This avoids polluting the global environment with
## the object r
<span class="kw">local</span>({
  r =<span class="st"> </span><span class="kw">getOption</span>(<span class="st">&quot;repos&quot;</span>)             
  r[<span class="st">&quot;CRAN&quot;</span>] =<span class="st"> &quot;https://cran.rstudio.com/&quot;</span>
  <span class="kw">options</span>(<span class="dt">repos =</span> r)
})</code></pre></div>
<p>The RStudio mirror is a virtual machine run by Amazon’s EC2 service, and it syncs with the main CRAN mirror in Austria once per day. Since RStudio is using Amazon’s CloudFront, the repository is automatically distributed around the world, so no matter where you are in the world, the data doesn’t need to travel very far, and is therefore fast to download.</p>
</div>
<div id="the-fortunes-package" class="section level4">
<h4><span class="header-section-number">3.3.2.3</span> The <strong>fortunes</strong> package</h4>
<p>This section illustrate what <code>.Rprofile</code> does with reference to a package that was developed for fun. The code below could easily be altered to automatically connect to a database, or ensure that the latest packages have been downloaded.</p>
<p>The <strong>fortunes</strong> package contains a number of memorable quotes that the community has collected over many years, called R fortunes. Each fortune has a number. To get fortune number <span class="math inline">\(50\)</span>, for example, enter</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fortunes::<span class="kw">fortune</span>(<span class="dv">50</span>)</code></pre></div>
<p>It is easy to make R print out one of these nuggets of truth each time you start a session, by adding the following to <code>~/.Rprofile</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if(<span class="kw">interactive</span>()) 
  <span class="kw">try</span>(fortunes::<span class="kw">fortune</span>(), <span class="dt">silent=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>The <code>interactive</code> function tests whether R is being used interactively in a terminal. The <code>fortune</code> function is called within <code>try</code>. If the <strong>fortunes</strong> package is not available, we avoid raising an error and move on. By using <code>::</code> we avoid adding the <strong>fortunes</strong> package to our list of attached packages..</p>
<p>The function <code>.Last</code>, if it exists in the <code>.Rprofile</code>, is always run at the end of the session. We can use it to install the <strong>fortunes</strong> package if needed. To load the package, we use <code>require</code>, since if the package isn’t installed, the <code>require</code> function returns <code>FALSE</code> and raises a warning.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.Last =<span class="st"> </span>function() {
  cond =<span class="st"> </span><span class="kw">suppressWarnings</span>(!<span class="kw">require</span>(fortunes, <span class="dt">quietly=</span><span class="ot">TRUE</span>))
  if(cond) 
    <span class="kw">try</span>(<span class="kw">install.packages</span>(<span class="st">&quot;fortunes&quot;</span>), <span class="dt">silent=</span><span class="ot">TRUE</span>)
  <span class="kw">message</span>(<span class="st">&quot;Goodbye at &quot;</span>, <span class="kw">date</span>(), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
}</code></pre></div>
</div>
<div id="useful-functions" class="section level4">
<h4><span class="header-section-number">3.3.2.4</span> Useful functions</h4>
<p>You can also load useful functions in <code>.Rprofile</code>. For example, we could load the following two functions for examining data frames:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## ht == headtail
ht =<span class="st"> </span>function(d, <span class="dt">n=</span><span class="dv">6</span>) <span class="kw">rbind</span>(<span class="kw">head</span>(d, n), <span class="kw">tail</span>(d, n))
  
## Show the first 5 rows &amp; first 5 columns of a data frame
hh =<span class="st"> </span>function(d) d[<span class="dv">1</span>:<span class="dv">5</span>, <span class="dv">1</span>:<span class="dv">5</span>]</code></pre></div>
<p>and a function for setting a nice plotting window:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">setnicepar =<span class="st"> </span>function(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="fl">0.4</span>, <span class="dv">0</span>), 
                      <span class="dt">tck =</span> -.<span class="dv">01</span>, <span class="dt">cex.axis =</span> <span class="fl">0.9</span>, 
                      <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), ...) {
    <span class="kw">par</span>(<span class="dt">mar =</span> mar, <span class="dt">mgp =</span> mgp, <span class="dt">tck =</span> tck,
        <span class="dt">cex.axis =</span> cex.axis, <span class="dt">las =</span> las, 
        <span class="dt">mfrow =</span> mfrow, ...)
}</code></pre></div>
<p>Note that these functions are for personal use and are unlikely to interfere with code from other people. For this reason even if you use a certain package every day, we don’t recommend loading it in your <code>.Rprofile</code>. Also beware the dangers of loading many functions by default: it may make your code less portable. Another downside of putting functions in your <code>.Rprofile</code> is that it can clutter-up your work space: when you run the <code>ls()</code> command, your <code>.Rprofile</code> functions will appear. Also if you run <code>rm(list=ls())</code>, your functions will be deleted.</p>
<p>One neat trick to overcome this issue is to use hidden objects and environments. When an object name starts with <code>.</code>, by default it doesn’t appear in the output of the <code>ls()</code> function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.obj =<span class="st"> </span><span class="dv">1</span>
<span class="st">&quot;.obj&quot;</span> %in%<span class="st"> </span><span class="kw">ls</span>()</code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>This concept also works with environments. In the <code>.Rprofile</code> file we can create a <em>hidden</em> environment</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.env =<span class="st"> </span><span class="kw">new.env</span>()</code></pre></div>
<p>and then add functions to this environment</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.env$ht =<span class="st"> </span>function(d, <span class="dt">n =</span> <span class="dv">6</span>) <span class="kw">rbind</span>(<span class="kw">head</span>(d, n), <span class="kw">tail</span>(d, n))</code></pre></div>
<p>At the end of the <code>.Rprofile</code> file, we use <code>attach</code>, which makes it possible to refer to objects in the environment by their names alone.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">attach</span>(.env)</code></pre></div>
<!--
\sidenote{I also have a function that shows the size of
  objects in my R session (\url{http://stackoverflow.com/q/1358003/203420}).}-->
</div>
</div>
<div id="renviron" class="section level3">
<h3><span class="header-section-number">3.3.3</span> The <code>.Renviron</code> file</h3>
<p>The <code>.Renviron</code> file is used to store system variables. It follows a similar start up routine to the <code>.Rprofile</code> file: R first looks for a global <code>.Renviron</code> file, then for local versions. A typical use of the <code>.Renviron</code> file is to specify the <code>R_LIBS</code> path</p>
<pre><code>## Linux
R_LIBS=~/R/library

## Windows
R_LIBS=C:/R/library</code></pre>
<p>This variable points to a directory where R packages will be installed. When <code>install.packages</code> is called, new packages will be stored in <code>R_LIBS</code>.</p>
<p>Another common use of <code>.Renviron</code> is to store API keys that will be available from one session to another.<a href="10-efficient-learning.html#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a> The following line in <code>.Renviron</code>, for example, sets the <code>ZEIT_KEY</code> environment variable which is used in the package <a href="https://cran.r-project.org/web/packages/diezeit/">diezeit</a> package:</p>
<pre><code>ZEIT_KEY=PUT_YOUR_KEY_HERE</code></pre>
<p>You will need to sign-in and start a new R session for the environment variable (accessed by <code>Sys.getenv</code>) to be visible. To test if the example API key has been successfully added as an environment variable, run the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Sys.getenv</span>(<span class="st">&quot;ZEIT_KEY&quot;</span>)</code></pre></div>
<p>Use of the <code>.Renviron</code> file for storing settings such as library paths and API keys is efficient because it reduces the need to update your settings for every R session. Furthermore, the same <code>.Renviron</code> file will work across different platforms so keep it stored safely.</p>
</div>
<div id="exercises-2" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>What are the three locations where they are stored? Where are these locations on your computer?</li>
<li>For each location, does a <code>.Rprofile</code> or <code>.Renviron</code> file exist?</li>
<li>Create a <code>.Rprofile</code> file in your current working directory that prints the message <code>Happy efficient R programming</code> each time you start R at this location.</li>
</ol>
</div>
</div>
<p style="text-align: center;">
<button class="btn btn-default"><a href="3-2-r-version.html">Previous</a></button>
<button class="btn btn-default"><a href="3-4-rstudio.html">Next</a></button>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
