<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Efficient R programming</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Efficient R Programming is about increasing the amount of work you can do with R in a given amount of time. It’s about both computational and programmer efficiency.">
  <meta name="generator" content="bookdown 0.0.74 and GitBook 2.6.7">

  <meta property="og:title" content="Efficient R programming" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://csgillespie.github.io/efficientR/" />
  <meta property="og:image" content="https://csgillespie.github.io/efficientR/figures/full.png" />
  <meta property="og:description" content="Efficient R Programming is about increasing the amount of work you can do with R in a given amount of time. It’s about both computational and programmer efficiency." />
  <meta name="github-repo" content="csgillespie/efficientR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Efficient R programming" />
  <meta name="twitter:site" content="@csgillespie" />
  <meta name="twitter:description" content="Efficient R Programming is about increasing the amount of work you can do with R in a given amount of time. It’s about both computational and programmer efficiency." />
  <meta name="twitter:image" content="https://csgillespie.github.io/efficientR/figures/full.png" />

<meta name="author" content="Colin Gillespie">
<meta name="author" content="Robin Lovelace">

<meta name="date" content="2016-07-05">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="efficient-visualisation.html">
<link rel="next" href="hardware.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Efficient R programming</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to Efficient R Programming</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#who-this-book-is-for"><i class="fa fa-check"></i><b>1.1</b> Who this book is for</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-is-efficiency"><i class="fa fa-check"></i><b>1.2</b> What is efficiency?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#why-efficiency"><i class="fa fa-check"></i><b>1.3</b> Why efficiency?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-is-efficient-r-programming"><i class="fa fa-check"></i><b>1.4</b> What is efficient R programming?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#touch-typing"><i class="fa fa-check"></i><b>1.5</b> Touch typing</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#benchmarking"><i class="fa fa-check"></i><b>1.6</b> Benchmarking</a><ul>
<li class="chapter" data-level="1.6.1" data-path="introduction.html"><a href="introduction.html#benchmarking-example"><i class="fa fa-check"></i><b>1.6.1</b> Benchmarking example</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#profiling"><i class="fa fa-check"></i><b>1.7</b> Profiling</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="efficient-set-up.html"><a href="efficient-set-up.html"><i class="fa fa-check"></i><b>2</b> Efficient set-up</a><ul>
<li class="chapter" data-level="2.1" data-path="efficient-set-up.html"><a href="efficient-set-up.html#top-5-tips-for-an-efficient-r-set-up"><i class="fa fa-check"></i><b>2.1</b> Top 5 tips for an efficient R set-up</a></li>
<li class="chapter" data-level="2.2" data-path="efficient-set-up.html"><a href="efficient-set-up.html#operating-system"><i class="fa fa-check"></i><b>2.2</b> Operating system</a><ul>
<li class="chapter" data-level="2.2.1" data-path="efficient-set-up.html"><a href="efficient-set-up.html#operating-system-and-resource-monitoring"><i class="fa fa-check"></i><b>2.2.1</b> Operating system and resource monitoring</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="efficient-set-up.html"><a href="efficient-set-up.html#r-version"><i class="fa fa-check"></i><b>2.3</b> R version</a><ul>
<li class="chapter" data-level="2.3.1" data-path="efficient-set-up.html"><a href="efficient-set-up.html#installing-r"><i class="fa fa-check"></i><b>2.3.1</b> Installing R</a></li>
<li class="chapter" data-level="2.3.2" data-path="efficient-set-up.html"><a href="efficient-set-up.html#updating-r"><i class="fa fa-check"></i><b>2.3.2</b> Updating R</a></li>
<li class="chapter" data-level="2.3.3" data-path="efficient-set-up.html"><a href="efficient-set-up.html#installing-r-packages"><i class="fa fa-check"></i><b>2.3.3</b> Installing R packages</a></li>
<li class="chapter" data-level="2.3.4" data-path="efficient-set-up.html"><a href="efficient-set-up.html#deps"><i class="fa fa-check"></i><b>2.3.4</b> Installing R packages with dependencies</a></li>
<li class="chapter" data-level="2.3.5" data-path="efficient-set-up.html"><a href="efficient-set-up.html#updating-r-packages"><i class="fa fa-check"></i><b>2.3.5</b> Updating R packages</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="efficient-set-up.html"><a href="efficient-set-up.html#r-startup"><i class="fa fa-check"></i><b>2.4</b> R startup</a><ul>
<li class="chapter" data-level="2.4.1" data-path="efficient-set-up.html"><a href="efficient-set-up.html#r-startup-arguments"><i class="fa fa-check"></i><b>2.4.1</b> R startup arguments</a></li>
<li class="chapter" data-level="2.4.2" data-path="efficient-set-up.html"><a href="efficient-set-up.html#an-overview-of-rs-startup-files"><i class="fa fa-check"></i><b>2.4.2</b> An overview of R’s startup files</a></li>
<li class="chapter" data-level="2.4.3" data-path="efficient-set-up.html"><a href="efficient-set-up.html#the-location-of-startup-files"><i class="fa fa-check"></i><b>2.4.3</b> The location of startup files</a></li>
<li class="chapter" data-level="2.4.4" data-path="efficient-set-up.html"><a href="efficient-set-up.html#rprofile"><i class="fa fa-check"></i><b>2.4.4</b> The <code>.Rprofile</code> file</a></li>
<li class="chapter" data-level="2.4.5" data-path="efficient-set-up.html"><a href="efficient-set-up.html#an-example-.rprofile-file"><i class="fa fa-check"></i><b>2.4.5</b> An example <code>.Rprofile</code> file</a></li>
<li class="chapter" data-level="2.4.6" data-path="efficient-set-up.html"><a href="efficient-set-up.html#renviron"><i class="fa fa-check"></i><b>2.4.6</b> The <code>.Renviron</code> file</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="efficient-set-up.html"><a href="efficient-set-up.html#rstudio"><i class="fa fa-check"></i><b>2.5</b> RStudio</a><ul>
<li class="chapter" data-level="2.5.1" data-path="efficient-set-up.html"><a href="efficient-set-up.html#install-rstudio"><i class="fa fa-check"></i><b>2.5.1</b> Installing and updating RStudio</a></li>
<li class="chapter" data-level="2.5.2" data-path="efficient-set-up.html"><a href="efficient-set-up.html#window-pane-layout"><i class="fa fa-check"></i><b>2.5.2</b> Window pane layout</a></li>
<li class="chapter" data-level="2.5.3" data-path="efficient-set-up.html"><a href="efficient-set-up.html#rstudio-options"><i class="fa fa-check"></i><b>2.5.3</b> RStudio options</a></li>
<li class="chapter" data-level="2.5.4" data-path="efficient-set-up.html"><a href="efficient-set-up.html#autocompletion"><i class="fa fa-check"></i><b>2.5.4</b> Autocompletion</a></li>
<li class="chapter" data-level="2.5.5" data-path="efficient-set-up.html"><a href="efficient-set-up.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>2.5.5</b> Keyboard shortcuts</a></li>
<li class="chapter" data-level="2.5.6" data-path="efficient-set-up.html"><a href="efficient-set-up.html#object-display-and-output-table"><i class="fa fa-check"></i><b>2.5.6</b> Object display and output table</a></li>
<li class="chapter" data-level="2.5.7" data-path="efficient-set-up.html"><a href="efficient-set-up.html#project-management"><i class="fa fa-check"></i><b>2.5.7</b> Project management</a></li>
<li class="chapter" data-level="" data-path="efficient-set-up.html"><a href="efficient-set-up.html#exercises-4"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="efficient-set-up.html"><a href="efficient-set-up.html#blas-and-alternative-r-interpreters"><i class="fa fa-check"></i><b>2.6</b> BLAS and alternative R interpreters</a><ul>
<li class="chapter" data-level="2.6.1" data-path="efficient-set-up.html"><a href="efficient-set-up.html#testing-performance-gains-from-blas"><i class="fa fa-check"></i><b>2.6.1</b> Testing performance gains from BLAS</a></li>
<li class="chapter" data-level="2.6.2" data-path="efficient-set-up.html"><a href="efficient-set-up.html#other-interpreters"><i class="fa fa-check"></i><b>2.6.2</b> Other interpreters</a></li>
<li class="chapter" data-level="2.6.3" data-path="efficient-set-up.html"><a href="efficient-set-up.html#useful-blasbenchmarking-resources"><i class="fa fa-check"></i><b>2.6.3</b> Useful BLAS/benchmarking resources</a></li>
<li class="chapter" data-level="" data-path="efficient-set-up.html"><a href="efficient-set-up.html#exercises-5"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>3</b> Efficient programming</a><ul>
<li class="chapter" data-level="3.1" data-path="programming.html"><a href="programming.html#top-5-tips-for-efficient-programming"><i class="fa fa-check"></i><b>3.1</b> Top 5 tips for efficient programming</a></li>
<li class="chapter" data-level="3.2" data-path="programming.html"><a href="programming.html#general-advice"><i class="fa fa-check"></i><b>3.2</b> General advice</a><ul>
<li class="chapter" data-level="3.2.1" data-path="programming.html"><a href="programming.html#memory-allocation"><i class="fa fa-check"></i><b>3.2.1</b> Memory allocation</a></li>
<li class="chapter" data-level="3.2.2" data-path="programming.html"><a href="programming.html#vectorised-code"><i class="fa fa-check"></i><b>3.2.2</b> Vectorised code</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#exercise-1"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="3.2.3" data-path="programming.html"><a href="programming.html#type-consistency"><i class="fa fa-check"></i><b>3.2.3</b> Type consistency</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="programming.html"><a href="programming.html#communicating-with-the-user"><i class="fa fa-check"></i><b>3.3</b> Communicating with the user</a><ul>
<li class="chapter" data-level="3.3.1" data-path="programming.html"><a href="programming.html#fatal-errors-stop"><i class="fa fa-check"></i><b>3.3.1</b> Fatal errors: <code class="unnumbered">stop</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="programming.html"><a href="programming.html#warnings-warning"><i class="fa fa-check"></i><b>3.3.2</b> Warnings: <code class="unnumbered">warning</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="programming.html"><a href="programming.html#informative-output-message-and-cat"><i class="fa fa-check"></i><b>3.3.3</b> Informative output: <code>message</code> and <code class="unnumbered">cat</code></a></li>
<li class="chapter" data-level="3.3.4" data-path="programming.html"><a href="programming.html#example-retrieving-a-web-resource"><i class="fa fa-check"></i><b>3.3.4</b> Example: Retrieving a web resource</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#exercises-8"><i class="fa fa-check"></i>Exercises</a></li>
<li class="chapter" data-level="3.3.5" data-path="programming.html"><a href="programming.html#invisible-returns"><i class="fa fa-check"></i><b>3.3.5</b> Invisible returns</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="programming.html"><a href="programming.html#factors"><i class="fa fa-check"></i><b>3.4</b> Factors</a><ul>
<li class="chapter" data-level="3.4.1" data-path="programming.html"><a href="programming.html#example-months-of-the-year"><i class="fa fa-check"></i><b>3.4.1</b> Example: Months of the year</a></li>
<li class="chapter" data-level="3.4.2" data-path="programming.html"><a href="programming.html#example-graphics"><i class="fa fa-check"></i><b>3.4.2</b> Example: Graphics</a></li>
<li class="chapter" data-level="3.4.3" data-path="programming.html"><a href="programming.html#example-analysis-of-variance"><i class="fa fa-check"></i><b>3.4.3</b> Example: Analysis of variance</a></li>
<li class="chapter" data-level="3.4.4" data-path="programming.html"><a href="programming.html#example-data-input"><i class="fa fa-check"></i><b>3.4.4</b> Example: data input</a></li>
<li class="chapter" data-level="3.4.5" data-path="programming.html"><a href="programming.html#example-factors-are-not-character-vectors"><i class="fa fa-check"></i><b>3.4.5</b> Example: Factors are not character vectors</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="programming.html"><a href="programming.html#S3"><i class="fa fa-check"></i><b>3.5</b> S3 objects</a></li>
<li class="chapter" data-level="3.6" data-path="programming.html"><a href="programming.html#caching-variables"><i class="fa fa-check"></i><b>3.6</b> Caching variables</a><ul>
<li class="chapter" data-level="3.6.1" data-path="programming.html"><a href="programming.html#function-closures"><i class="fa fa-check"></i><b>3.6.1</b> Function closures</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="programming.html"><a href="programming.html#the-byte-compiler"><i class="fa fa-check"></i><b>3.7</b> The byte compiler</a><ul>
<li class="chapter" data-level="3.7.1" data-path="programming.html"><a href="programming.html#example-the-mean-function"><i class="fa fa-check"></i><b>3.7.1</b> Example: the mean function</a></li>
<li class="chapter" data-level="3.7.2" data-path="programming.html"><a href="programming.html#compiling-code"><i class="fa fa-check"></i><b>3.7.2</b> Compiling code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="efficient-workflow.html"><a href="efficient-workflow.html"><i class="fa fa-check"></i><b>4</b> Efficient workflow</a><ul>
<li class="chapter" data-level="4.1" data-path="efficient-workflow.html"><a href="efficient-workflow.html#top-5-tips-for-efficient-workflow"><i class="fa fa-check"></i><b>4.1</b> Top 5 tips for efficient workflow</a></li>
<li class="chapter" data-level="4.2" data-path="efficient-workflow.html"><a href="efficient-workflow.html#a-project-planning-typology"><i class="fa fa-check"></i><b>4.2</b> A project planning typology</a></li>
<li class="chapter" data-level="4.3" data-path="efficient-workflow.html"><a href="efficient-workflow.html#project-planning-and-management"><i class="fa fa-check"></i><b>4.3</b> Project planning and management</a><ul>
<li class="chapter" data-level="4.3.1" data-path="efficient-workflow.html"><a href="efficient-workflow.html#chunking-your-work"><i class="fa fa-check"></i><b>4.3.1</b> ‘Chunking’ your work</a></li>
<li class="chapter" data-level="4.3.2" data-path="efficient-workflow.html"><a href="efficient-workflow.html#smart"><i class="fa fa-check"></i><b>4.3.2</b> Making your workflow SMART</a></li>
<li class="chapter" data-level="4.3.3" data-path="efficient-workflow.html"><a href="efficient-workflow.html#visualising-plans-with-r"><i class="fa fa-check"></i><b>4.3.3</b> Visualising plans with R</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="efficient-workflow.html"><a href="efficient-workflow.html#package-selection"><i class="fa fa-check"></i><b>4.4</b> Package selection</a><ul>
<li class="chapter" data-level="4.4.1" data-path="efficient-workflow.html"><a href="efficient-workflow.html#searching-for-r-packages"><i class="fa fa-check"></i><b>4.4.1</b> Searching for R packages</a></li>
<li class="chapter" data-level="4.4.2" data-path="efficient-workflow.html"><a href="efficient-workflow.html#how-to-select-a-package"><i class="fa fa-check"></i><b>4.4.2</b> How to select a package</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="efficient-workflow.html"><a href="efficient-workflow.html#publication"><i class="fa fa-check"></i><b>4.5</b> Publication</a><ul>
<li class="chapter" data-level="4.5.1" data-path="efficient-workflow.html"><a href="efficient-workflow.html#dynamic-documents-with-knitr"><i class="fa fa-check"></i><b>4.5.1</b> Dynamic documents with knitr</a></li>
<li class="chapter" data-level="4.5.2" data-path="efficient-workflow.html"><a href="efficient-workflow.html#r-packages"><i class="fa fa-check"></i><b>4.5.2</b> R packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="efficient-inputoutput.html"><a href="efficient-inputoutput.html"><i class="fa fa-check"></i><b>5</b> Efficient input/output</a><ul>
<li class="chapter" data-level="5.1" data-path="efficient-inputoutput.html"><a href="efficient-inputoutput.html#top-5-tips-for-efficient-data-io"><i class="fa fa-check"></i><b>5.1</b> Top 5 tips for efficient data I/O</a></li>
<li class="chapter" data-level="5.2" data-path="efficient-inputoutput.html"><a href="efficient-inputoutput.html#getting-data-from-the-internet"><i class="fa fa-check"></i><b>5.2</b> Getting data from the internet</a></li>
<li class="chapter" data-level="5.3" data-path="efficient-inputoutput.html"><a href="efficient-inputoutput.html#versatile-data-import-with-rio"><i class="fa fa-check"></i><b>5.3</b> Versatile data import with rio</a><ul>
<li class="chapter" data-level="" data-path="efficient-inputoutput.html"><a href="efficient-inputoutput.html#exercises-11"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="efficient-inputoutput.html"><a href="efficient-inputoutput.html#accessing-data-stored-in-packages"><i class="fa fa-check"></i><b>5.4</b> Accessing data stored in packages</a></li>
<li class="chapter" data-level="5.5" data-path="efficient-inputoutput.html"><a href="efficient-inputoutput.html#the-feather-file-format"><i class="fa fa-check"></i><b>5.5</b> The feather file format</a></li>
<li class="chapter" data-level="5.6" data-path="efficient-inputoutput.html"><a href="efficient-inputoutput.html#efficient-data-export-.rdata-or-.rds"><i class="fa fa-check"></i><b>5.6</b> Efficient data export: .Rdata or .Rds?</a></li>
<li class="chapter" data-level="5.7" data-path="efficient-inputoutput.html"><a href="efficient-inputoutput.html#a-benchmark-of-methods-for-file-import-and-export"><i class="fa fa-check"></i><b>5.7</b> A benchmark of methods for file import and export</a></li>
<li class="chapter" data-level="5.8" data-path="efficient-inputoutput.html"><a href="efficient-inputoutput.html#fread"><i class="fa fa-check"></i><b>5.8</b> Fast import of plain text formats</a><ul>
<li class="chapter" data-level="5.8.1" data-path="efficient-inputoutput.html"><a href="efficient-inputoutput.html#preprocessing-outside-r"><i class="fa fa-check"></i><b>5.8.1</b> Preprocessing outside R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html"><i class="fa fa-check"></i><b>6</b> Efficient data carpentry</a><ul>
<li class="chapter" data-level="6.1" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#top-5-tips-for-efficient-data-carpentry"><i class="fa fa-check"></i><b>6.1</b> Top 5 tips for efficient data carpentry</a></li>
<li class="chapter" data-level="6.2" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#tidying-data-with-tidyr"><i class="fa fa-check"></i><b>6.2</b> Tidying data with tidyr</a></li>
<li class="chapter" data-level="6.3" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#efficient-data-frames-with-tibble"><i class="fa fa-check"></i><b>6.3</b> Efficient data frames with tibble</a></li>
<li class="chapter" data-level="6.4" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#dplyr"><i class="fa fa-check"></i><b>6.4</b> Efficient data processing with dplyr</a><ul>
<li class="chapter" data-level="6.4.1" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#renaming-columns"><i class="fa fa-check"></i><b>6.4.1</b> Renaming columns</a></li>
<li class="chapter" data-level="6.4.2" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#changing-column-classes"><i class="fa fa-check"></i><b>6.4.2</b> Changing column classes</a></li>
<li class="chapter" data-level="6.4.3" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#filtering-rows"><i class="fa fa-check"></i><b>6.4.3</b> Filtering rows</a></li>
<li class="chapter" data-level="6.4.4" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#filtering-columns"><i class="fa fa-check"></i><b>6.4.4</b> Filtering columns</a></li>
<li class="chapter" data-level="6.4.5" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#data-aggregation"><i class="fa fa-check"></i><b>6.4.5</b> Data aggregation</a></li>
<li class="chapter" data-level="6.4.6" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#chaining-operations"><i class="fa fa-check"></i><b>6.4.6</b> Chaining operations</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#combining-datasets"><i class="fa fa-check"></i><b>6.5</b> Combining datasets</a></li>
<li class="chapter" data-level="6.6" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#working-with-databases"><i class="fa fa-check"></i><b>6.6</b> Working with databases</a><ul>
<li class="chapter" data-level="6.6.1" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#databases-and-dplyr"><i class="fa fa-check"></i><b>6.6.1</b> Databases and <strong>dplyr</strong></a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="efficient-data-carpentry.html"><a href="efficient-data-carpentry.html#data-processing-with-data.table"><i class="fa fa-check"></i><b>6.7</b> Data processing with data.table</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="efficient-visualisation.html"><a href="efficient-visualisation.html"><i class="fa fa-check"></i><b>7</b> Efficient visualisation</a><ul>
<li class="chapter" data-level="7.1" data-path="efficient-visualisation.html"><a href="efficient-visualisation.html#rough-outline"><i class="fa fa-check"></i><b>7.1</b> Rough outline</a></li>
<li class="chapter" data-level="7.2" data-path="efficient-visualisation.html"><a href="efficient-visualisation.html#cairo-type"><i class="fa fa-check"></i><b>7.2</b> Cairo type</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="efficient-performance.html"><a href="efficient-performance.html"><i class="fa fa-check"></i><b>8</b> Efficient performance</a><ul>
<li class="chapter" data-level="8.1" data-path="efficient-performance.html"><a href="efficient-performance.html#top-5-tips-for-efficient-performance"><i class="fa fa-check"></i><b>8.1</b> Top 5 tips for efficient performance</a></li>
<li class="chapter" data-level="8.2" data-path="efficient-performance.html"><a href="efficient-performance.html#efficient-base-r"><i class="fa fa-check"></i><b>8.2</b> Efficient base R</a><ul>
<li><a href="efficient-performance.html#the-if-vs-ifelse-functions">The <code>if</code> vs <code>ifelse</code> functions</a></li>
<li class="chapter" data-level="" data-path="efficient-performance.html"><a href="efficient-performance.html#sorting-and-ordering"><i class="fa fa-check"></i>Sorting and ordering</a></li>
<li class="chapter" data-level="" data-path="efficient-performance.html"><a href="efficient-performance.html#reversing-elements"><i class="fa fa-check"></i>Reversing elements</a></li>
<li><a href="efficient-performance.html#which-indices-are-true">Which indices are <code>TRUE</code>  </a></li>
<li class="chapter" data-level="" data-path="efficient-performance.html"><a href="efficient-performance.html#converting-factors-to-numerics"><i class="fa fa-check"></i>Converting factors to numerics</a></li>
<li class="chapter" data-level="" data-path="efficient-performance.html"><a href="efficient-performance.html#string-concatenation"><i class="fa fa-check"></i>String concatenation</a></li>
<li class="chapter" data-level="" data-path="efficient-performance.html"><a href="efficient-performance.html#logical-and-and-or"><i class="fa fa-check"></i>Logical AND and OR</a></li>
<li class="chapter" data-level="" data-path="efficient-performance.html"><a href="efficient-performance.html#row-and-column-operations"><i class="fa fa-check"></i>Row and column operations</a></li>
<li><a href="efficient-performance.html#is.na-and-anyna"><code>is.na</code> and <code>anyNA</code>  </a></li>
<li class="chapter" data-level="" data-path="efficient-performance.html"><a href="efficient-performance.html#matrices"><i class="fa fa-check"></i>Matrices</a></li>
<li class="chapter" data-level="" data-path="efficient-performance.html"><a href="efficient-performance.html#the-integer-data-type"><i class="fa fa-check"></i>The integer data type</a></li>
<li class="chapter" data-level="" data-path="efficient-performance.html"><a href="efficient-performance.html#sparse-matrices"><i class="fa fa-check"></i>Sparse matrices</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="efficient-performance.html"><a href="efficient-performance.html#code-profiling"><i class="fa fa-check"></i><b>8.3</b> Code profiling</a><ul>
<li class="chapter" data-level="8.3.1" data-path="efficient-performance.html"><a href="efficient-performance.html#getting-started-with-profvis"><i class="fa fa-check"></i><b>8.3.1</b> Getting started with <strong>profvis</strong></a></li>
<li class="chapter" data-level="8.3.2" data-path="efficient-performance.html"><a href="efficient-performance.html#example-monopoly-simulation"><i class="fa fa-check"></i><b>8.3.2</b> Example: Monopoly Simulation</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="efficient-performance.html"><a href="efficient-performance.html#parallel-computing"><i class="fa fa-check"></i><b>8.4</b> Parallel computing</a><ul>
<li class="chapter" data-level="8.4.1" data-path="efficient-performance.html"><a href="efficient-performance.html#parallel-versions-of-apply-functions"><i class="fa fa-check"></i><b>8.4.1</b> Parallel versions of apply functions</a></li>
<li class="chapter" data-level="8.4.2" data-path="efficient-performance.html"><a href="efficient-performance.html#example-snakes-and-ladders"><i class="fa fa-check"></i><b>8.4.2</b> Example: Snakes and Ladders</a></li>
<li class="chapter" data-level="8.4.3" data-path="efficient-performance.html"><a href="efficient-performance.html#exit-functions-with-care"><i class="fa fa-check"></i><b>8.4.3</b> Exit functions with care</a></li>
<li class="chapter" data-level="8.4.4" data-path="efficient-performance.html"><a href="efficient-performance.html#process-forking"><i class="fa fa-check"></i><b>8.4.4</b> Process forking</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="efficient-performance.html"><a href="efficient-performance.html#rcpp"><i class="fa fa-check"></i><b>8.5</b> Rcpp</a><ul>
<li class="chapter" data-level="8.5.1" data-path="efficient-performance.html"><a href="efficient-performance.html#pre-requisites"><i class="fa fa-check"></i><b>8.5.1</b> Pre-requisites</a></li>
<li class="chapter" data-level="8.5.2" data-path="efficient-performance.html"><a href="efficient-performance.html#simple-c"><i class="fa fa-check"></i><b>8.5.2</b> A simple C++ function</a></li>
<li class="chapter" data-level="8.5.3" data-path="efficient-performance.html"><a href="efficient-performance.html#cppfunction"><i class="fa fa-check"></i><b>8.5.3</b> The cppFunction command</a></li>
<li class="chapter" data-level="8.5.4" data-path="efficient-performance.html"><a href="efficient-performance.html#c-types"><i class="fa fa-check"></i><b>8.5.4</b> C++ data types</a></li>
<li class="chapter" data-level="8.5.5" data-path="efficient-performance.html"><a href="efficient-performance.html#sourcecpp"><i class="fa fa-check"></i><b>8.5.5</b> The <code>sourceCpp</code> function</a></li>
<li class="chapter" data-level="8.5.6" data-path="efficient-performance.html"><a href="efficient-performance.html#vectors-and-loops"><i class="fa fa-check"></i><b>8.5.6</b> Vectors and loops</a></li>
<li class="chapter" data-level="8.5.7" data-path="efficient-performance.html"><a href="efficient-performance.html#sugar"><i class="fa fa-check"></i><b>8.5.7</b> C++ with sugar on top</a></li>
<li class="chapter" data-level="8.5.8" data-path="efficient-performance.html"><a href="efficient-performance.html#rcpp-resources"><i class="fa fa-check"></i><b>8.5.8</b> Rcpp resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="hardware.html"><a href="hardware.html"><i class="fa fa-check"></i><b>9</b> Efficient hardware</a><ul>
<li class="chapter" data-level="9.1" data-path="hardware.html"><a href="hardware.html#top-5-tips-for-efficient-hardware"><i class="fa fa-check"></i><b>9.1</b> Top 5 tips for efficient hardware</a></li>
<li class="chapter" data-level="9.2" data-path="hardware.html"><a href="hardware.html#background-what-is-a-byte"><i class="fa fa-check"></i><b>9.2</b> Background: what is a byte?</a></li>
<li class="chapter" data-level="9.3" data-path="hardware.html"><a href="hardware.html#ram"><i class="fa fa-check"></i><b>9.3</b> Random access memory: RAM</a></li>
<li class="chapter" data-level="9.4" data-path="hardware.html"><a href="hardware.html#hard-drives-hdd-vs-ssd"><i class="fa fa-check"></i><b>9.4</b> Hard drives: HDD vs SSD</a></li>
<li class="chapter" data-level="9.5" data-path="hardware.html"><a href="hardware.html#operating-systems-32-bit-or-64-bit"><i class="fa fa-check"></i><b>9.5</b> Operating systems: 32-bit or 64-bit</a></li>
<li class="chapter" data-level="9.6" data-path="hardware.html"><a href="hardware.html#central-processing-unit-cpu"><i class="fa fa-check"></i><b>9.6</b> Central processing unit (CPU)</a></li>
<li class="chapter" data-level="9.7" data-path="hardware.html"><a href="hardware.html#cloud-computing"><i class="fa fa-check"></i><b>9.7</b> Cloud computing</a><ul>
<li class="chapter" data-level="9.7.1" data-path="hardware.html"><a href="hardware.html#amazon-ec2"><i class="fa fa-check"></i><b>9.7.1</b> Amazon EC2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html"><i class="fa fa-check"></i><b>10</b> Efficient collaboration</a><ul>
<li class="chapter" data-level="10.1" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#top-5-tips-for-efficient-collaboration"><i class="fa fa-check"></i><b>10.1</b> Top 5 tips for efficient collaboration</a></li>
<li class="chapter" data-level="10.2" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#coding-style"><i class="fa fa-check"></i><b>10.2</b> Coding style</a><ul>
<li class="chapter" data-level="10.2.1" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#reformatting-code-with-rstudio"><i class="fa fa-check"></i><b>10.2.1</b> Reformatting code with RStudio</a></li>
<li class="chapter" data-level="10.2.2" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#file-names"><i class="fa fa-check"></i><b>10.2.2</b> File names</a></li>
<li class="chapter" data-level="10.2.3" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#loading-packages"><i class="fa fa-check"></i><b>10.2.3</b> Loading packages</a></li>
<li class="chapter" data-level="10.2.4" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#commenting"><i class="fa fa-check"></i><b>10.2.4</b> Commenting</a></li>
<li class="chapter" data-level="10.2.5" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#object-names"><i class="fa fa-check"></i><b>10.2.5</b> Object names</a></li>
<li class="chapter" data-level="10.2.6" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#example-package"><i class="fa fa-check"></i><b>10.2.6</b> Example package</a></li>
<li class="chapter" data-level="10.2.7" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#assignment"><i class="fa fa-check"></i><b>10.2.7</b> Assignment</a></li>
<li class="chapter" data-level="10.2.8" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#spacing"><i class="fa fa-check"></i><b>10.2.8</b> Spacing</a></li>
<li class="chapter" data-level="10.2.9" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#indentation"><i class="fa fa-check"></i><b>10.2.9</b> Indentation</a></li>
<li class="chapter" data-level="10.2.10" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#curly-braces"><i class="fa fa-check"></i><b>10.2.10</b> Curly braces</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#version-control"><i class="fa fa-check"></i><b>10.3</b> Version control</a><ul>
<li class="chapter" data-level="10.3.1" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#commits"><i class="fa fa-check"></i><b>10.3.1</b> Commits</a></li>
<li class="chapter" data-level="10.3.2" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#git-integration-in-rstudio"><i class="fa fa-check"></i><b>10.3.2</b> Git integration in RStudio</a></li>
<li class="chapter" data-level="10.3.3" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#github"><i class="fa fa-check"></i><b>10.3.3</b> GitHub</a></li>
<li class="chapter" data-level="10.3.4" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#branches-forks-pulls-and-clones"><i class="fa fa-check"></i><b>10.3.4</b> Branches, forks, pulls and clones</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html#refactoring"><i class="fa fa-check"></i><b>10.4</b> Refactoring code</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="efficient-learning.html"><a href="efficient-learning.html"><i class="fa fa-check"></i><b>11</b> Efficient learning</a><ul>
<li class="chapter" data-level="11.1" data-path="efficient-learning.html"><a href="efficient-learning.html#top-5-tips-for-efficient-learning"><i class="fa fa-check"></i><b>11.1</b> Top 5 tips for efficient learning</a></li>
<li class="chapter" data-level="11.2" data-path="efficient-learning.html"><a href="efficient-learning.html#using-r-help"><i class="fa fa-check"></i><b>11.2</b> Using R help</a><ul>
<li class="chapter" data-level="11.2.1" data-path="efficient-learning.html"><a href="efficient-learning.html#reading-r-source-code"><i class="fa fa-check"></i><b>11.2.1</b> Reading R source code</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="efficient-learning.html"><a href="efficient-learning.html#online-resources"><i class="fa fa-check"></i><b>11.3</b> Online resources</a><ul>
<li class="chapter" data-level="11.3.1" data-path="efficient-learning.html"><a href="efficient-learning.html#stackoverflow"><i class="fa fa-check"></i><b>11.3.1</b> Stackoverflow</a></li>
<li class="chapter" data-level="11.3.2" data-path="efficient-learning.html"><a href="efficient-learning.html#mailing-lists-and-groups."><i class="fa fa-check"></i><b>11.3.2</b> Mailing lists and groups.</a></li>
<li class="chapter" data-level="11.3.3" data-path="efficient-learning.html"><a href="efficient-learning.html#asking-a-question"><i class="fa fa-check"></i><b>11.3.3</b> Asking a question</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="package-dependencies.html"><a href="package-dependencies.html"><i class="fa fa-check"></i><b>A</b> Package Dependencies</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="http://www.mas.ncl.ac.uk/~ncsg3/">Colin Gillespie</a>, Robin Lovelace</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Efficient R programming</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="efficient-performance" class="section level1">
<h1><span class="header-section-number">8</span> Efficient performance</h1>
<p><a href="https://en.wikiquote.org/wiki/Donald_Knuth">Donald Knuth</a> is a famous American computer scientist who developed a number of the key alogorithms that we use today. On the subject of optimisation he give this advice.</p>
<blockquote>
<p>The real problem is that programmers have spent far too much time worrying about efficiency in the wrong places and at the wrong times; premature optimization is the root of all evil (or at least most of it) in programming.</p>
</blockquote>
<p>That’s why in the previous chapters we’ve focused on tools and your working environment to increase efficiency. These are (relatively) easy ways of saving time, that once implemented, work for future projects. In this chapter we are going to consider code optimisation. Simply stated, making your program run faster.</p>
<p>In many scernios, code is running slowly due to a couple of key bottlenecks. By specifically targetting these key areas, we may be able to speed up the entire program.</p>
<p>In this chapter we will consider a variety of code tweaks that can eke out an extra speed boost. We’ll begin with general hints and tips about using base R. Then look at code profiling to determine where our efforts should be focused. We conclude by looking at <code>Rcpp</code>, an efficient way of incorparting C++ code into an R analysis.</p>
<div id="top-5-tips-for-efficient-performance" class="section level2">
<h2><span class="header-section-number">8.1</span> Top 5 tips for efficient performance</h2>
<ul>
<li>Before you start to optimise you code, ensure you know where the bottleneck lies; use a code profiler.</li>
<li>The <code>ifelse</code> function is optimal for vectorised comparisons.</li>
<li>If the data in your data frame is all of the same type, consider converting it to a matrix for a speed boost.</li>
<li>The <strong>parallel</strong> package is ideal for Monte-Carlo simulations.</li>
<li>For optimal performance, consider re-writing key parts of your code in C++.</li>
</ul>
</div>
<div id="efficient-base-r" class="section level2">
<h2><span class="header-section-number">8.2</span> Efficient base R</h2>
<p>In R there is often more than one way to solve a problem. In this section we highlight standard tricks or alternative methods that may improve performance.</p>
<div id="the-if-vs-ifelse-functions" class="section level3 unnumbered">
<h3>The <code>if</code> vs <code>ifelse</code> functions</h3>
<p>The <code>ifelse</code> function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ifelse</span>(test, yes, no)</code></pre></div>
<p>is a vectorised version of the standard control-flow <code>if</code> function. The return value of <code>ifelse</code> is filled with elements from the <code>yes</code> and <code>no</code> arguments that are determined by whether the element of <code>test</code> is <code>TRUE</code> or <code>FALSE</code>.</p>
<p>If the length of <code>test</code> is equal to <span class="math inline">\(1\)</span>, i.e. <code>length(test) == 1</code>, then the standard <code>if(test) yes else no</code> is more efficient.</p>
</div>
<div id="sorting-and-ordering" class="section level3 unnumbered">
<h3>Sorting and ordering</h3>
<p>Sorting a vector a single vector is relatively quick; sorting a vector of length <span class="math inline">\(10^7\)</span> takes around <span class="math inline">\(0.01\)</span> seconds. If you only sort a vector once at the top of a script, then don’t worry too much about this. However if you are sorting inside a loop, or in a shiny application, then it can be worthwhile thinking about how to optimise this operation.</p>
<p>There are currently three sorting algorithms, <code>c(&quot;shell&quot;, &quot;quick&quot;, &quot;radix&quot;)</code> that can be specified in the <code>sort</code> function; with <code>radix</code> being a new addition to R 3.3. Typically the <code>radix</code> (the non-default option) is optimal for most situations.</p>
<p>Another useful trick is to partially order the results. For example, if you only want to display the top ten results, then use the <code>partial</code> argument, i.e. <code>sort(x, partial=1:10)</code>.</p>
</div>
<div id="reversing-elements" class="section level3 unnumbered">
<h3>Reversing elements</h3>
<p>The <code>rev</code> function provides a reversed version of its argument. If you wish to sort in increasing order, then use the more efficient <code>sort(x, decreasing=TRUE)</code> instead of <code>rev(sort(x))</code>.</p>
</div>
<div id="which-indices-are-true" class="section level3 unnumbered">
<h3>Which indices are <code>TRUE</code>  </h3>
<p>To determine which index of a vector or array are <code>TRUE</code>, we would typically use the <code>which</code> function. If we want to find the index of just the minimum or maximum value, i.e. <code>which(x == min(x))</code> then use the more efficient <code>which.min</code>/<code>which.max</code> variants.</p>
</div>
<div id="converting-factors-to-numerics" class="section level3 unnumbered">
<h3>Converting factors to numerics</h3>
<p>A factor is just a vector of integers with associated levels. Occasionally we want to convert a factor into its numerical equivalent. The most efficient way of doing this (especially for long factors) is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(<span class="kw">levels</span>(f))[f]</code></pre></div>
<p>where <code>f</code> is the factor.</p>
</div>
<div id="string-concatenation" class="section level3 unnumbered">
<h3>String concatenation</h3>
<p>To concatenate strings use the <code>paste</code> function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>)</code></pre></div>
<p>The separation character is specified via the <code>sep</code> argument. The function <code>paste0(..., collapse)</code> is equivalent to <code>paste(..., sep = &quot;&quot;, collapse)</code>, but is slightly more efficient.</p>
</div>
<div id="logical-and-and-or" class="section level3 unnumbered">
<h3>Logical AND and OR</h3>
<p>The logical AND (<code>&amp;</code>) and OR (<code>|</code>) operators are vectorised functions and are typically used whenever we perform subsetting operations. For example</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;<span class="st"> </span><span class="fl">0.4</span> |<span class="st"> </span>x &gt;<span class="st"> </span><span class="fl">0.6</span>
<span class="co">#&gt; [1]  TRUE FALSE  TRUE</span></code></pre></div>
<p>When R executes the above comparison, it will <strong>always</strong> calculate <code>x &gt; 0.6</code> regardless of the value of <code>x &lt; 0.4</code>. In contrast, the non-vectorised version, <code>&amp;&amp;</code>, only executes the second component if needed. This is efficient and leads to more neater code, e.g.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read.csv is only executed if the file exists</span>
<span class="kw">file.exists</span>(<span class="st">&quot;data.csv&quot;</span>) &amp;&amp;<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data.csv&quot;</span>)
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>However care must be taken not to use <code>&amp;&amp;</code> or <code>||</code> on vectors since it will give the incorrect answer</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;<span class="st"> </span><span class="fl">0.4</span> ||<span class="st"> </span>x &gt;<span class="st"> </span><span class="fl">0.6</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
<div id="row-and-column-operations" class="section level3 unnumbered">
<h3>Row and column operations</h3>
<p>In data analysis we often want to apply a function to each column or row of a data set. For example, we might want to calculation the column or row sums. The <code>apply</code> function makes this type of operation straightforward.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Second argument: 1 -&gt; rows. 2 -&gt; columns</span>
<span class="kw">apply</span>(data_set, <span class="dv">1</span>, function_name)</code></pre></div>
<p>There are optimised functions for calculating row and columns sums/means, <code>rowSums</code>, <code>colSums</code>, <code>rowMeans</code> and <code>colMeans</code> that should be used whenever possible.</p>
</div>
<div id="is.na-and-anyna" class="section level3 unnumbered">
<h3><code>is.na</code> and <code>anyNA</code>  </h3>
<p>To test whether a vector (or other obeject) contains missing values we use the <code>is.na</code> function. Often we are interested in whether a vector contains <em>any</em> missing values. In this case, <code>anyNA(x)</code> is usually more efficient than <code>any(is.na(x))</code>.</p>
</div>
<div id="matrices" class="section level3 unnumbered">
<h3>Matrices</h3>
<p>A matrix is similar to a data frame: it is a two dimensional object and sub-setting and other functions work in the expected way. However all matrix elements must have the same type. Matrices tend to be used during statistical calculations. Calculating the line of best fit using the <code>lm()</code> function, internally converts the data to a matrix before calculating the results; any characters are thus recoded as numeric dummy variables.</p>
<p>Matrices are generally faster than data frames. For example, the datasets <code>ex_mat</code> and <code>ex_df</code> from the <strong>efficient</strong> package each have <span class="math inline">\(1000\)</span> rows and <span class="math inline">\(100\)</span> columns and contain the same random numbers. However selecting rows from a data frame is around <span class="math inline">\(150\)</span> times slower than a matrix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(ex_mat, ex_df, <span class="dt">package=</span><span class="st">&quot;efficient&quot;</span>)
<span class="kw">microbenchmark</span>(<span class="dt">times=</span><span class="dv">100</span>, <span class="dt">unit=</span><span class="st">&quot;ms&quot;</span>, ex_mat[<span class="dv">1</span>,], ex_df[<span class="dv">1</span>,])
<span class="co">#&gt; Unit: milliseconds</span>
<span class="co">#&gt;         expr    min     lq   mean  median      uq  max neval</span>
<span class="co">#&gt;  ex_mat[1, ] 0.0022 0.0033 0.0514 0.00599 0.00671 4.61   100</span>
<span class="co">#&gt;   ex_df[1, ] 0.7360 0.8149 1.0465 0.86335 1.14765 5.61   100</span></code></pre></div>
<div class="rmdtip">
<p>
Use the <code>data.matrix</code> function to efficiently convert a data frame into a matrix.
</p>
</div>
</div>
<div id="the-integer-data-type" class="section level3 unnumbered">
<h3>The integer data type</h3>
<p>Numbers in R are usually stored in <a href="https://goo.gl/ZA5R8a">double-precision floating-point format</a> - see <span class="citation">Braun and Murdoch (<a href="#ref-Braun2007">2007</a>)</span> and <span class="citation">Goldberg (<a href="#ref-Goldberg1991">1991</a>)</span>. The term ‘double’ refers to the fact that on <span class="math inline">\(32\)</span> bit systems (for which the format was developed) two memory locations are used to store a single number. Each double-precision number is accurate to around <span class="math inline">\(17\)</span> decimal places.</p>
<div class="rmdnote">
<p>
When comparing floating point numbers we should be particularly careful, since <code>y = sqrt(2)*sqrt(2)</code> is not exactly <span class="math inline">2</span>, instead it’s <strong>almost</strong> <span class="math inline">2</span>. Using <code>sprintf(“%.17f”, y)</code> will give you the true value of <code>y</code> (to 17 decimal places).
</p>
</div>
<p>There is also another data type, called an integer. Integers primarily exist to be passed to C or Fortran code. Typically we don’t worry about creating integers, however they are occasionally used to optimise sub-setting operations. When we subset a data frame or matrix, we are interacting with C code. For example, if we look at the arguments for the <code>head</code> function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">args</span>(head.matrix)
<span class="co">#&gt; function (x, n = 6L, ...) </span>
<span class="co">#&gt; NULL</span></code></pre></div>
<div class="rmdtip">
<p>
Using the <code>:</code> operator automatically creates a vector of integers.
</p>
</div>
<p>The default argument for <code>n</code> is <code>6L</code> (the <code>L</code> is short for Literal and is used to create an integer). Since this function is being called by almost everyone that uses R, this low level optimisation is useful. To illustrate the speed increase, suppose we are selecting the first <span class="math inline">\(100\)</span> rows from a data frame (<code>clock_speed</code>, from the <strong>efficient</strong> package). The speed increase is illustrated below, using the <strong>microbenchmark</strong> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s_int =<span class="st"> </span><span class="dv">1</span>:<span class="dv">100</span>; s_double =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="fl">1.0</span>)
<span class="kw">microbenchmark</span>(clock_speed[s_int, 2L], clock_speed[s_double, <span class="fl">2.0</span>], <span class="dt">times=</span><span class="dv">1000000</span>)
<span class="co">#&gt; Unit: microseconds</span>
<span class="co">#&gt; expr   min    lq  mean median    uq   max neval cld</span>
<span class="co">#&gt; clock_speed[s_int, 2L] 11.79 13.43 15.30  13.81 14.22 87979 1e+06  a </span>
<span class="co">#&gt; clock_speed[s_double, 2] 12.79 14.37 16.04  14.76 15.18 21964 1e+06   b</span></code></pre></div>
<p>The above result shows that using integers is slightly faster, but probably not worth worrying about.</p>
<p>Integers are more space efficient. If we compare size of a integer vector to a standard numeric vector</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pryr::<span class="kw">object_size</span>(<span class="dv">1</span>:<span class="dv">10000</span>)
<span class="co">#&gt; 40 kB</span>
pryr::<span class="kw">object_size</span>(<span class="dt">y =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10000</span>, <span class="dt">by=</span><span class="fl">1.0</span>))
<span class="co">#&gt; 80 kB</span></code></pre></div>
<p>The integer version is (approximately) half the size. However most mathematical operations will convert the integer vector into a standard numerical vector, e.g.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.integer</span>(1L +<span class="st"> </span><span class="dv">1</span>)
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
</div>
<div id="sparse-matrices" class="section level3 unnumbered">
<h3>Sparse matrices</h3>
<p>Another efficient data structure is a sparse matrix. This is simply a matrix where most of the elements are zero. Conversely, if most elements are non-zero, the matrix is considered dense. The proportion of non-zero elements is called the sparsity. Large sparse matrices often crop up when performing numerical calculations. Typically, our data isn’t sparse but the resulting data structures we create may be sparse. There are a number of techniques/methods used to store sparse matrices. Methods for creating sparse matrices can be found in the <strong>Matrix</strong> package<a href="#fn19" class="footnoteRef" id="fnref19"><sup>19</sup></a>.</p>
<p>As an example, suppose we have a large matrix where the diagonial elements are non-zero</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;Matrix&quot;</span>)
N =<span class="st"> </span><span class="dv">10000</span>
sp =<span class="st"> </span><span class="kw">sparseMatrix</span>(<span class="dv">1</span>:N, <span class="dv">1</span>:N, <span class="dt">x =</span> <span class="dv">1</span>)
m =<span class="st"> </span><span class="kw">diag</span>(<span class="dv">1</span>, N, N)</code></pre></div>
<p>Both objects contain the same information, but the data is stored differently. The matrix object stores each individual element, while the sparse matrix object only stores the location of the non-zero elements. This is much more memory efficient</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pryr::<span class="kw">object_size</span>(sp)
<span class="co">#&gt; 161 kB</span>
pryr::<span class="kw">object_size</span>(m)
<span class="co">#&gt; 800 MB</span></code></pre></div>
<div id="exercises-14" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li><p>Create a vector <code>x</code>. Benchmark <code>any(is.na(x))</code> against <code>anyNA</code>. Do the results vary with the size of the vector.</p></li>
<li>Examine the following function definitions to give you an idea of how integers are used.
<ul>
<li><code>tail.matrix</code></li>
<li><code>lm</code>.</li>
</ul></li>
<li><p>Contruct a matrix of integers and a matrix of numerics. Using <code>pryr::object_size</code>, compare the objects.</p></li>
<li><p>How does the function <code>seq.int</code>, which was used in the <code>tail.matrix</code> function, differ to the standard <code>seq</code> function?</p></li>
</ol>
<div class="rmdnote">
<p>
A related memory saving idea is to replace <code>logical</code> vectors with vectors from the <strong>bit</strong> package which take up just over 16th of the space (but you can’t use <code>NA</code>s).
</p>
</div>
</div>
</div>
</div>
<div id="code-profiling" class="section level2">
<h2><span class="header-section-number">8.3</span> Code profiling</h2>
<p>A circumstance that happens all too often, is that we simply want our code to run faster. In some cases it’s obvious where the bottle neck lies. Other times we have to rely on our intuition. One major drawback of relying on our intuition is that we could be wrong and we end up pointlessly optimising the wrong piece of code. To make slow code run faster, we first need to determine where the slow code lives.</p>
<p>The <code>Rprof</code> function is built-in tool for profiling the execution of R expressions. At regular time intervals, the profiler stops the R interpreter, records the current function call stack, and saves the information to a file. The results from <code>Rprof</code> are stochastic. Each time we run a function R, the conditions have changed. Hence, each time you profile your code, the result will be slightly different.</p>
<p>Unfortunately <code>Rprof</code> is not user friendly. The <strong>profvis</strong> package provides an interactive graphical interface for visualising data data from <code>Rprof</code>.</p>
<div id="getting-started-with-profvis" class="section level3">
<h3><span class="header-section-number">8.3.1</span> Getting started with <strong>profvis</strong></h3>
<p>The <strong>profvis</strong> package can be installed in the usual way</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;profvis&quot;</span>)</code></pre></div>
<p>As a simple example, we will use the <code>movies</code> data set, which contain information on around 60,000 movies from the IMDB. First, we’ll select movies that are classed as comedies, then plot year vs movies rating, and draw a local polynomial regression line to pick out the trend. The main function from the <strong>profvis</strong> package, is <code>profvis</code> which profiles the code and creates an interactive HTML page. The first argument of <code>profvis</code> is the R expression of interest.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;profvis&quot;</span>)
<span class="kw">profvis</span>({
  <span class="kw">data</span>(movies, <span class="dt">package=</span><span class="st">&quot;ggplot2movies&quot;</span>) <span class="co"># Load data</span>
  movies =<span class="st"> </span>movies[movies$Comedy==<span class="dv">1</span>, ]
  <span class="kw">plot</span>(movies$year, movies$rating)
  model =<span class="st"> </span><span class="kw">loess</span>(rating ~<span class="st"> </span>year, <span class="dt">data=</span>movies) <span class="co"># loess regression line</span>
  j =<span class="st"> </span><span class="kw">order</span>(movies$year)
  <span class="kw">lines</span>(movies$year[j], model$fitted[j]) <span class="co"># Add line to the plot</span>
})</code></pre></div>
The above code provides an interactive HTML page (figure <a href="efficient-performance.html#fig:profvis1">8.1</a>). On the left side is the code and on the right is a flame graph (horizontal direction is time in milliseconds and the vertical direction is the call stack).
<div class="figure" style="text-align: center"><span id="fig:profvis1"></span>
<img src="images/profvis1.png" alt="Output from profvis" width="100%" />
<p class="caption">
Figure 8.1: Output from profvis
</p>
</div>
<p>The left hand panel gives the amount of time spent on each line of code. We see that majority of time is spent calculating the <code>loess</code> smoothing line. The bottom line of the right panel also highlights that most of the execution time is spent on the <code>loess</code> function. Travelling up the function, we see that <code>loess</code> calls <code>simpleLoess</code> which in turn calls <code>.C</code> function.</p>
<p>The conclusion from this graph is that if optimisation were required, it would make sense to focus on the <code>loess</code> and possibly the <code>order</code> function calls.</p>
<!-- http://rpubs.com/wch/123888 -->
</div>
<div id="example-monopoly-simulation" class="section level3">
<h3><span class="header-section-number">8.3.2</span> Example: Monopoly Simulation</h3>
<p>Monopoly is a board game that originated in the United States over <span class="math inline">\(100\)</span> years ago. The object of the game is to go round the board and purchase squares (properties). If other players land on your properties they have to pay a tax. The player with the most money at the end of the game, wins. To make things more interesting, there are Chance and Community Chest squares. If you land on one of these squares, you draw card, which may send to you to other parts of the board. The other special square, is Jail. One way of entering Jail is to roll three successive doubles.</p>
<p>The <strong>efficient</strong> package contains a Monte-Carlo function for simulating a simplified game of monopoly. By keeping track of where a person lands when going round the board, we obtain an estimate of the probability of landing on a certain square. The entire code is around 100 lines long. In order for <code>profvis</code> to fully profile the code, the <strong>efficient</strong> package needs to be installed from source</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># args is also a valid argument for install.packages</span>
devtools::<span class="kw">install_github</span>(<span class="st">&quot;csgillespie/efficient_pkg&quot;</span>, <span class="dt">args=</span><span class="st">&quot;--with-keep.source&quot;</span>)</code></pre></div>
<p>The function can then be profiled via</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;efficient&quot;</span>)
<span class="kw">profvis</span>(<span class="kw">SimulateMonopoly</span>(<span class="dv">10000</span>))</code></pre></div>
<p>to get</p>
<p><img src="images/profvis_monopoly.png" width="100%" style="display: block; margin: auto;" /></p>
<p>The output from <code>profvis</code> shows that the vast majority of time is spent in the <code>move</code> function. In Monopoly rolling a double (a pair of 1’s, 2’s, …, 6’s) is special:</p>
<ul>
<li>Roll two dice (<code>total1</code>): <code>total_score = total1</code>;</li>
<li>If you get a double, roll again (<code>total2</code>) and <code>total_score = total1 + total2</code>;</li>
<li>If you get a double, roll again (<code>total3</code>) and <code>total_score = total1 + total2 + total3</code>;</li>
<li>If roll three is a double, Go To Jail, otherwise move <code>total_score</code>.</li>
</ul>
<p>The <code>move</code> function spends around 50% of the time creating a data frame, 25% time calculating row sums, and the remainder on a comparison operations. This piece of code can be optimised fairly easily (will still retaining the same overall structure) by incorporating the following improvements<a href="#fn20" class="footnoteRef" id="fnref20"><sup>20</sup></a>:</p>
<ul>
<li>Use a matrix instead of a data frame;</li>
<li>Sample <span class="math inline">\(6\)</span> numbers at once, instead of two groups of three;</li>
<li>Switch from <code>apply</code> to <code>rowSums</code>;</li>
<li>Use <code>&amp;&amp;</code> in the <code>if</code> condition.</li>
</ul>
<p>Implementing this features, results in the following code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">move =<span class="st"> </span>function(current) {
  <span class="co"># data.frame -&gt; matrix</span>
  rolls =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">6</span>, <span class="dv">6</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>), <span class="dt">ncol=</span><span class="dv">2</span>)
  Total =<span class="st"> </span><span class="kw">rowSums</span>(rolls)    <span class="co"># apply -&gt; rowSums  </span>
  IsDouble =<span class="st"> </span>rolls[,<span class="dv">1</span>] ==<span class="st"> </span>rolls[,<span class="dv">2</span>]
  <span class="co"># &amp; -&gt; &amp;&amp;</span>
  if(IsDouble[<span class="dv">1</span>] &amp;&amp;<span class="st"> </span>IsDouble[<span class="dv">2</span>] &amp;&amp;<span class="st"> </span>IsDouble[<span class="dv">3</span>]) {
    current =<span class="st"> </span><span class="dv">11</span><span class="co">#Go To Jail</span>
  } else if(IsDouble[<span class="dv">1</span>] &amp;&amp;<span class="st"> </span>IsDouble[<span class="dv">2</span>]) {
    current =<span class="st"> </span>current +<span class="st"> </span><span class="kw">sum</span>(Total[<span class="dv">1</span>:<span class="dv">3</span>])
  } else if(IsDouble[<span class="dv">1</span>]) {
    current =<span class="st"> </span>current +<span class="st"> </span>Total[<span class="dv">1</span>:<span class="dv">2</span>]
  } else {
    current =<span class="st"> </span>Total[<span class="dv">1</span>]
  }
  current
}</code></pre></div>
<p>which gives a 25-fold speed improvement.</p>
<div id="exercise-5" class="section level4 unnumbered">
<h4>Exercise</h4>
<p>The <code>move</code> function above uses a vectorised solution. Whenever we move, we always roll six dice, then examine the outcome and determine the number of doubles. However, this is potentially wasteful, since the probability of getting one double is <span class="math inline">\(1/6\)</span> and two doubles is <span class="math inline">\(1/36\)</span>. Another method is too only roll additional dice if and when they are needed. Implement and time this solution.</p>
</div>
</div>
</div>
<div id="parallel-computing" class="section level2">
<h2><span class="header-section-number">8.4</span> Parallel computing</h2>
<p>This chapter provides a brief foray into the word of parallel computing and only looks at shared memory systems. The idea is to give a flavour of what is possible, instead of covering all possible varities. For a fuller account, see <span class="citation">McCallum and Weston (<a href="#ref-mccallum2011">2011</a>)</span>.</p>
<p>In recent R versions (since R 2.14.0) the <strong>parallel</strong> package comes pre-installed with base R. The <strong>parallel</strong> package must still be loaded before use however, and you must determine the number of available cores manually, as illustrated below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;parallel&quot;</span>)
no_of_cores =<span class="st"> </span><span class="kw">detectCores</span>()</code></pre></div>
<div id="parallel-versions-of-apply-functions" class="section level3">
<h3><span class="header-section-number">8.4.1</span> Parallel versions of apply functions</h3>
<p>The most commonly used parallel applications are parallelised replacements of <code>lapply</code>, <code>sapply</code> and <code>apply</code>. The parallel implementations and their arguments are shown below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">parLapply</span>(cl, x, FUN, ...)
<span class="kw">parApply</span>(<span class="dt">cl =</span> <span class="ot">NULL</span>, X, MARGIN, FUN, ...)
<span class="kw">parSapply</span>(<span class="dt">cl =</span> <span class="ot">NULL</span>, X, FUN, ..., <span class="dt">simplify =</span> <span class="ot">TRUE</span>, <span class="dt">USE.NAMES =</span> <span class="ot">TRUE</span>) </code></pre></div>
<p>The key point is that there is very little difference in arguments between <code>parLapply</code> and <code>apply</code>, so the barrier to using (this form) of parallel computing is low. Each function above has an argument <code>cl</code>, which is created by a <code>makeCluster</code> call. This function, amongst other things, specifies the number of processors to use.</p>
</div>
<div id="example-snakes-and-ladders" class="section level3">
<h3><span class="header-section-number">8.4.2</span> Example: Snakes and Ladders</h3>
<p>Parallel computing is ideal for Monte-Carlo simulations. Each core independently simulates a realisation from model. At the end, we gather up the results. In the <strong>efficient</strong> package, there is a function that simulates a single game of Snakes and Ladders - <code>snakes_ladders()</code><a href="#fn21" class="footnoteRef" id="fnref21"><sup>21</sup></a></p>
<p>If we wanted to simulate <code>N</code> games we could use <code>sapply</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N =<span class="st"> </span><span class="dv">10</span>^<span class="dv">4</span>
<span class="kw">sapply</span>(<span class="dv">1</span>:N, snakes_ladders)</code></pre></div>
<p>Rewriting this code to make use of the <strong>parallel</strong> package is straightforward. We begin by making a cluster object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;parallel&quot;</span>)
cl =<span class="st"> </span><span class="kw">makeCluster</span>(<span class="dv">4</span>)</code></pre></div>
<p>Then swap <code>sapply</code> for <code>parSapply</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">parSapply</span>(cl, <span class="dv">1</span>:N, snakes_ladders)</code></pre></div>
<p>before stopping the cluster</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stopCluster</span>(cl)</code></pre></div>
<p>On my computer I get a four-fold speed-up.</p>
</div>
<div id="exit-functions-with-care" class="section level3">
<h3><span class="header-section-number">8.4.3</span> Exit functions with care</h3>
<p>We should always call <code>stopCluster</code> to free resources when we are finished with the cluster object. However if the parallel code is within function, it’s possible that function ends as the results of an error and so <code>stopCluster</code> is ommitted.</p>
<p>The <code>on.exit</code> function handles this problem with the minimum of fuss; regardless how the function ends, <code>on.exit</code> is always called. In the context of parallel programming we will have something similar to</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">simulate =<span class="st"> </span>function(cores) {
  cl =<span class="st"> </span><span class="kw">makeCluster</span>(cores)
  <span class="kw">on.exit</span>(<span class="kw">stopCluster</span>(cl))
  <span class="co"># Do something  </span>
}</code></pre></div>
<div class="rmdtip">
<p>
Another common use of <code>on.exit</code> is with the <code>par</code> function. If you use <code>par</code> to change graphical parameters within a function, <code>on.exit</code> ensures these parameters are reset to their previous value when the function ends.
</p>
</div>
</div>
<div id="process-forking" class="section level3">
<h3><span class="header-section-number">8.4.4</span> Process forking</h3>
<p>Another way of running code in parallel is to use the <code>mclapply</code> and <code>mcmapply</code> functions, i.e.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This will run on Windows, but will only use 1 core</span>
<span class="kw">mclapply</span>(<span class="dv">1</span>:<span class="dv">2</span>, snakes_ladders)</code></pre></div>
<p>These functions use forking, that is creating a new copy of a process running on the CPU. However Windows does not support this low-level functionality in the way that Linux does. If I’m writing code that I don’t intend to share, I use <code>mclapply</code> since it is more efficient.</p>
</div>
</div>
<div id="rcpp" class="section level2">
<h2><span class="header-section-number">8.5</span> Rcpp</h2>
<p>Sometimes R is just slow. You’ve tried every trick you know, and your code is still crawling along. At this point you could consider rewriting key parts of your code in another, faster language. R has interfaces to other languages via packages, such as <strong>Rcpp</strong>, <strong>rJava</strong>, <strong>rPython</strong> and recently <strong>V8</strong>. These provide R interfaces to C++, Java, Python and JavaScript respectively. <strong>Rcpp</strong> is the most popular of these (Figure <a href="efficient-performance.html#fig:cranlog">8.2</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:cranlog"></span>
<img src="_main_files/figure-html/cranlog-1.png" alt="Downloads per day from the RStudio CRAN mirror of packages that provide R interfaces to other languages." width="70%" />
<p class="caption">
Figure 8.2: Downloads per day from the RStudio CRAN mirror of packages that provide R interfaces to other languages.
</p>
</div>
<p>C++ is a modern, fast and very well-supported language with libraries for performing many kinds of computational task. <strong>Rcpp</strong> makes incorporating C++ code into your R workflow easily.</p>
<p>Although C/Fortran routines can be used using the <code>.Call</code> function this is not recommended: using <code>.Call</code> can be a painful experience. <strong>Rcpp</strong> provides a friendly API (Application Program Interface) that lets you write high-performance code, bypassing R’s tricky C API. Typical bottlenecks that C++ addresses are loops and recursive functions.</p>
<p>C++ is a powerful programming language about which entire books have been written. This section therefore is focussed on getting started and provide a flavour of what is possible. It is structured as follows. After ensuring that your computer is set-up for <strong>Rcpp</strong> in Section <a href="efficient-performance.html#pre-requisites">8.5.1</a>, we proceed by creating a simple C++ function, to show how C++ compares with R (Section <a href="efficient-performance.html#simple-c">8.5.2</a>). This is converted into an R function using <code>cppFunction()</code> in Section <a href="efficient-performance.html#cppfunction">8.5.3</a>. The remainder of the chapter explains C++ data types (Section <a href="efficient-performance.html#c-types">8.5.4</a>), illustrates how to source C++ code directly (Section <a href="efficient-performance.html#sourcecpp">8.5.5</a>) and explains vectors (Section <a href="efficient-performance.html#vectors-and-loops">8.5.6</a>) <strong>Rcpp</strong> sugar (Section <a href="efficient-performance.html#sugar">8.5.7</a>) and finally provides guidance on further resources on the subject (Section <a href="efficient-performance.html#rcpp-resources">8.5.8</a>).</p>
<div id="pre-requisites" class="section level3">
<h3><span class="header-section-number">8.5.1</span> Pre-requisites</h3>
<p>To write and compile C++ functions, you need a working C++ compiler. The installation method depends on your operating system:</p>
<ul>
<li>Linux: A compiler should already be installed. Otherwise, install <code>r-base</code> and a compiler will be installed as a dependency.</li>
<li>Macs: Install <code>Xcode</code>.</li>
<li>Windows: Install <a href="http://cran.r-project.org/bin/windows/">Rtools</a>. Make sure you select the version that corresponds to your version of R.</li>
</ul>
<p>The code in this chapter was generated using version 0.12.5 of <strong>Rcpp</strong>. The latest version can be installed from CRAN:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;Rcpp&quot;</span>)</code></pre></div>
<p><strong>Rcpp</strong> is well documented, as illustrated by the number of vignettes on the package’s <a href="https://cran.r-project.org/web/packages/Rcpp/">CRAN</a> page. In addition to its popularity, many other packages depend on <strong>Rcpp</strong>, which can be seen by looking at the <code>Reverse Imports</code> section.</p>
<p>To check that you have everything needed for this chapter, run the following piece of code from the course R package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">efficient::<span class="kw">test_rcpp</span>()
<span class="co">#&gt; Everything seems fine</span></code></pre></div>
</div>
<div id="simple-c" class="section level3">
<h3><span class="header-section-number">8.5.2</span> A simple C++ function</h3>
<p>A C++ function is similar to an R function: you pass a set of inputs to function, some code is run, a single object is returned. However there are some key differences.</p>
<ol style="list-style-type: decimal">
<li>In the C++ function each line must be terminated with <code>;</code> In R, we use <code>;</code> only when we have multiple statements on the same line.</li>
<li>We must declare object types in the C++ version. In particular we need to declare the types of the function arguments, return value and any intermediate objects we create.</li>
<li>The function must have an explicit <code>return</code> statement. Similar to R, there can be multiple returns, but the function will terminate when it hits it’s first <code>return</code> statement.</li>
<li>You do not use assignment when creating a function.</li>
<li>Object assignment must use <code>=</code> sign. The <code>&lt;-</code> operator isn’t valid.</li>
<li>One line comments can be created using <code>//</code>. Multi-line comments are created using <code>/*...*/</code></li>
</ol>
<p>Suppose we want to create a function that adds two numbers together. In R this would be a simple one line affair:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">add_r =<span class="st"> </span>function(x, y) x +<span class="st"> </span>y</code></pre></div>
<p>In C++ it is a bit more long winded</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="co">/* Return type double</span>
<span class="co"> * Two arguments, also doubles</span>
<span class="co"> */</span>
<span class="dt">double</span> add_c(<span class="dt">double</span> x, <span class="dt">double</span> y) { 
  <span class="dt">double</span> value = x + y;
  <span class="kw">return</span> value;
}</code></pre></div>
<p>If we were writing a C++ programme we would also need another function called <code>main</code>. We would then compile the code to obtain an executable. The executable is platform dependent. The beauty of using <strong>Rcpp</strong> is that it makes it very easy to call C++ functions from R and the user doesn’t have to worry about the platform, or compilers or the R/C++ interface.</p>
</div>
<div id="cppfunction" class="section level3">
<h3><span class="header-section-number">8.5.3</span> The cppFunction command</h3>
<p>Load the <strong>Rcpp</strong> package using the usual <code>library</code> function call:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;Rcpp&quot;</span>) </code></pre></div>
<p>Pass the C++ function created in the previous section as a text string argument to <code>cppFunction</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cppFunction</span>(<span class="st">&#39;</span>
<span class="st">  double add_c(double x, double y) {</span>
<span class="st">    double value = x + y;</span>
<span class="st">    return value;</span>
<span class="st">  }</span>
<span class="st">&#39;</span>)</code></pre></div>
<p><strong>Rcpp</strong> will magically compile the C++ code and construct a function that bridges the gap between R and C++. After running the above code, we now have access to the <code>add_c</code> function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">add_c
<span class="co">#&gt; function (x, y) </span>
<span class="co">#&gt; .Primitive(&quot;.Call&quot;)(&lt;pointer: 0x2acf85eba8a0&gt;, x, y)</span></code></pre></div>
<p>and can call the <code>add_c</code> function in the usual way</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add_c</span>(<span class="dv">1</span>, <span class="dv">2</span>)
<span class="co">#&gt; [1] 3</span></code></pre></div>
<p>We don’t have to worry about compilers. Also, if you include this function in a package, users don’t have to worry about any of the <strong>Rcpp</strong> magic. It just works.</p>
</div>
<div id="c-types" class="section level3">
<h3><span class="header-section-number">8.5.4</span> C++ data types</h3>
<p>The most basic type of variable is an integer, <code>int</code>. An <code>int</code> variable can store a value in the range <span class="math inline">\(-32768\)</span> to <span class="math inline">\(+32767\)</span>. To store floating point numbers, there are single precision numbers, <code>float</code> and double precision numbers, <code>double</code>. A <code>double</code> takes twice as much memory as a <code>float</code>. For <strong>single</strong> characters, we use the <code>char</code> data type.</p>
<div class="rmdnote">
<p>
There is also something called an unsigned int, which goes from <span class="math inline">0</span> to <span class="math inline">65, 535</span> and a <code>long int</code> that ranges from <span class="math inline">0</span> to <span class="math inline">2<sup>31</sup> − 1</span>.
</p>
</div>
<table>
<caption><span id="tab:cpptypes">Table 8.1: </span>Overview of key C++ object types.</caption>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">char</td>
<td align="left">A single character.</td>
</tr>
<tr class="even">
<td align="left">int</td>
<td align="left">An integer.</td>
</tr>
<tr class="odd">
<td align="left">float</td>
<td align="left">A single precision floating point number.</td>
</tr>
<tr class="even">
<td align="left">double</td>
<td align="left">A double-precision floating point number.</td>
</tr>
<tr class="odd">
<td align="left">void</td>
<td align="left">A valueless quantity.</td>
</tr>
</tbody>
</table>
<p>A pointer object is a variable that points to an area of memory that has been given a name. Pointers are a very powerful, but primitive facility contained in the C++ language. They are very useful since rather than passing large objects around, we pass a pointer to the memory location; rather than pass the house, we just give the address. We won’t use pointers in this chapter, but mention them for completeness. Table @ref{tab:cpptypes} gives an overview.</p>
</div>
<div id="sourcecpp" class="section level3">
<h3><span class="header-section-number">8.5.5</span> The <code>sourceCpp</code> function</h3>
<p>The <code>cppFunction</code> is great for getting small examples up and running. But it is better practice to put your C++ code in a separate file (with file extension <code>cpp</code>) and use the function call <code>sourceCpp(&quot;path/to/file.cpp&quot;)</code> to compile them. However we need to include a few headers at the top of the file. The first line we add gives us access to the <strong>Rcpp</strong> functions. The file <code>Rcpp.h</code> contains a list of function and class definitions supplied by <strong>Rcpp</strong>. This file will be located where <strong>Rcpp</strong> is installed. The <code>include</code> line</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="ot">#include &lt;Rcpp.h&gt;</span></code></pre></div>
<p>causes the compiler to replace that lines with the contents of the named source file. This means that we can access the functions defined by <strong>Rcpp</strong>. To access the <strong>Rcpp</strong> functions we would have to type <code>Rcpp::function_1</code>. To avoid typing <code>Rcpp::</code>, we use the namespace facility</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</code></pre></div>
<p>Now we can just type <code>function_1</code>; this is the same concept that R uses for managing function name collisions when loading packages. Above each function we want to export/use in R, we add the tag</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="co">// [[Rcpp::export]]</span></code></pre></div>
<p>This would give the complete file</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="ot">#include &lt;Rcpp.h&gt;</span>
<span class="kw">using</span> <span class="kw">namespace</span> Rcpp;

<span class="co">// [[Rcpp::export]]</span>
<span class="dt">double</span> add_c(<span class="dt">double</span> x, <span class="dt">double</span> y) {
  <span class="dt">double</span> value = x + y;
  <span class="kw">return</span> value;
}</code></pre></div>
<p>There are two main benefits with putting your C++ functions in separate files. First, we have the benefit of syntax highlighting (RStudio has great support for C++ editing). Second, it’s easier to make syntax errors when the switching between R and C++ in the same file. To save space we we’ll omit the headers for the remainder of the chapter.</p>
</div>
<div id="vectors-and-loops" class="section level3">
<h3><span class="header-section-number">8.5.6</span> Vectors and loops</h3>
<p>Let’s now consider a slightly more complicated example. Here we want to write our own function that calculates the mean. This is just an illustrative example: R’s version is much better and more robust to scale differences in our data. For comparison, let’s create a corresponding R function - this is the same function we used in chapter <a href="programming.html#programming">3</a>. The function takes a single vector <code>x</code> as input, and returns the mean value, <code>m</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean_r =<span class="st"> </span>function(x) {
  m =<span class="st"> </span><span class="dv">0</span>
  n =<span class="st"> </span><span class="kw">length</span>(x)
  for(i in <span class="dv">1</span>:n)
    m =<span class="st"> </span>m +<span class="st"> </span>x[i]/n
  m
}</code></pre></div>
<p>This is a very bad R function; we should just use the base function <code>mean</code> for real world applications. However the purpose of <code>mean_r</code> is to provide a comparison for the C++ version, which we will write in a similar way.</p>
<p>In this example, we will let <strong>Rcpp</strong> smooth the interface between C++ and R by using the <code>NumericVector</code> data type. This <strong>Rcpp</strong> data type mirrors the R vector object type. Other common classes are: <code>IntegerVector</code>, <code>CharacterVector</code>, and <code>LogicalVector</code>.</p>
<p>In the C++ version of the mean function, we specify the arguments types: <code>x</code> (<code>NumericVector</code>) and the return value (<code>double</code>). The C++ version of the <code>mean</code> function is a few lines longer. Almost always, the corresponding C++ version will be, possibly much, longer.</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">double</span> mean_c(NumericVector x) {
  <span class="dt">int</span> i;
  <span class="dt">int</span> n = x.size();
  <span class="dt">double</span> mean = <span class="dv">0</span>;

  <span class="kw">for</span>(i=<span class="dv">0</span>; i&lt;n; i++) {
    mean = mean + x[i]/n;
  }
  <span class="kw">return</span> mean;
}</code></pre></div>
<p>To use the C++ function we need to source the file (remember to put the necessary headers in).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sourceCpp</span>(<span class="st">&quot;src/mean_c.cpp&quot;</span>)</code></pre></div>
<p>Although the C++ version is similar, there are a few crucial differences.</p>
<ol style="list-style-type: decimal">
<li>We use the <code>.size()</code> method to find the length of <code>x</code>.</li>
<li><p>The <code>for</code> loop has a more complicated syntax.</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="kw">for</span> (variable initialization; condition; variable update ) {
  <span class="co">// Code to execute</span>
}</code></pre></div></li>
<li><p>C++ provides operators to modify variables in place. So <code>i++</code> increases the value of <code>i</code> by <code>1</code>. Similarly, we could rewrite part of the loop as</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">mean += x[i]/n;</code></pre></div>
The above code adds <code>x[i]/n</code> to the value of <code>mean</code>. Other similar operators are <code>-=</code>, <code>*=</code>, <code>/=</code> and <code>i--</code>.</li>
<li><p>A C++ vector starts at <code>0</code> <strong>not</strong> <code>1</code></p></li>
</ol>
<p>To compare the C++ and R functions, we’ll generate some normal random numbers for the comparison</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="fl">1e4</span>)</code></pre></div>
<p>Then call the <code>microbenchmark</code> function (results plotted in figure <a href="efficient-performance.html#fig:rcppcomp">8.3</a>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># com_mean_r is the compiled version of mean_r</span>
z =<span class="st"> </span><span class="kw">microbenchmark</span>(
  <span class="kw">mean</span>(x), <span class="kw">mean_r</span>(x), <span class="kw">com_mean_r</span>(x), <span class="kw">mean_c</span>(x),
  <span class="dt">times=</span><span class="dv">1000</span>
)</code></pre></div>
<p>In this simple example, the Rcpp variant is around <span class="math inline">\(100\)</span> times faster than the corresponding R version. This sort of speed-up is not uncommon when switching to an Rcpp solution.</p>
<div class="figure" style="text-align: center"><span id="fig:rcppcomp"></span>
<img src="_main_files/figure-html/rcppcomp-1.png" alt="Comparison of mean functions." width="70%" />
<p class="caption">
Figure 8.3: Comparison of mean functions.
</p>
</div>
<div id="exercises-15" class="section level4 unnumbered">
<h4>Exercises</h4>
<p>Consider the following piece of code</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">double</span> test1() {
  <span class="dt">double</span> a = <span class="fl">1.</span><span class="dv">0</span> / <span class="dv">81</span>;
  <span class="dt">double</span> b = <span class="dv">0</span>;
  <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">729</span>; ++ i)
    b = b + a;
  <span class="kw">return</span> b;
}</code></pre></div>
<ol style="list-style-type: decimal">
<li>Save the function <code>test1</code> in a separate file. Make sure it works.</li>
<li>Write a similar function in R and compare the speed of the C++ and R versions.</li>
<li>Create a function called <code>test2</code> where the <code>double</code> variables have been replaced by <code>float</code>. Do you still get the correct answer?</li>
<li>Change <code>b = b + a</code> to <code>b += a</code> to make you code more <code>C</code> like.</li>
<li>(Hard) What’s the difference between <code>i++</code> and <code>++i</code>?</li>
</ol>
</div>
<div id="matrices-1" class="section level4 unnumbered">
<h4>Matrices</h4>
<p>Each vector type has a corresponding matrix equivalent: <code>NumericMatrix</code>, <code>IntegerMatrix</code>, <code>CharacterMatrix</code> and <code>LogicalMatrix</code>. We use these types in a similar way to how we used <code>NumericVector</code>’s. The main differences are:</p>
<ul>
<li><p>When we initialise, we need specify the number of rows and columns</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="co">// 10 rows, 5 columns</span>
NumericMatrix mat(<span class="dv">10</span>, <span class="dv">5</span>);
<span class="co">// Length 10</span>
NumericVector v(<span class="dv">10</span>);</code></pre></div></li>
<li>We subset using <code>()</code>, i.e. <code>mat(5, 4)</code>.</li>
<li>The first view in a matrix is <code>mat(0, 0)</code> - remember indexes start with <code>0</code>.</li>
<li><p>To determine the number of rows and columns, we use the <code>.nrow()</code> and <code>.ncol()</code> methods.</p></li>
</ul>
</div>
</div>
<div id="sugar" class="section level3">
<h3><span class="header-section-number">8.5.7</span> C++ with sugar on top</h3>
<p><strong>Rcpp</strong> sugar brings a higher-level of abstraction to C++ code written using the <strong>Rcpp</strong> API. What this means in practice is that we can write C++ code in the style of R. For example, suppose we wanted to find the squared difference of two vectors; a squared residual in regression. In R we would use</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sq_diff_r =<span class="st"> </span>function(x, y) (x -<span class="st"> </span>y)^<span class="dv">2</span></code></pre></div>
<p>Rewriting the function in standard C++ would give</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">NumericVector res_c(NumericVector x, NumericVector y) {
  <span class="dt">int</span> i;
  <span class="dt">int</span> n = x.size();
  NumericVector residuals(n);
  <span class="kw">for</span>(i=<span class="dv">0</span>; i&lt;n; i++) {
    residuals[i] = pow(x[i] - y[i], <span class="dv">2</span>);
  }
  <span class="kw">return</span> residuals;
}</code></pre></div>
<p>With <strong>Rcpp</strong> sugar we can rewrite this code to be more succinct and have more of an R feel:</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp">NumericVector res_sugar(NumericVector x, NumericVector y) {
  <span class="kw">return</span> pow(x-y, <span class="dv">2</span>);
}</code></pre></div>
<p>In the above C++ code, the <code>pow</code> function and <code>x-y</code> are valid due to <strong>Rcpp</strong> sugar. Other functions that are available include the d/q/p/r statistical functions, such as <code>rnorm</code> and <code>pnorm</code>. The sweetened versions aren’t usually faster than the C++ version, but typically there’s very little difference between the two. However with the sugared variety, the code is shorter and is constantly being improved.</p>
<div id="exercises-16" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li>Construct an R version, <code>res_r</code> and compare the three function variants.</li>
<li>In the above example, <code>res_sugar</code> is faster than <code>res_c</code>. Do you know why?</li>
</ol>
</div>
</div>
<div id="rcpp-resources" class="section level3">
<h3><span class="header-section-number">8.5.8</span> Rcpp resources</h3>
<p>The aim of this section was to provide an introduction to <code>Rcpp</code>. One of the selling features of <code>Rcpp</code> is that there is a great deal of documentation available.</p>
<ul>
<li>The Rcpp <a href="http://www.rcpp.org/">website</a>;</li>
<li>The original Journal of Statistical Software paper describing <code>Rcpp</code> and the follow-up book <span class="citation">(Eddelbuettel and François <a href="#ref-Eddelbuettel2011">2011</a>; Eddelbuettel <a href="#ref-Eddelbuettel2013">2013</a>)</span>;</li>
<li><span class="citation">H. Wickham (<a href="#ref-Wickham2014">2014</a><a href="#ref-Wickham2014">a</a>)</span> provides a very readable chapter on <code>Rcpp</code> that goes into a bit more detail than this section;</li>
<li>The <code>Rcpp</code> section on the <a href="https://stackoverflow.com/questions/tagged/rcpp">stackoverflow</a> website. Questions are often answered by the <code>Rcpp</code> authors.</li>
</ul>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Braun2007">
<p>Braun, John, and Duncan J Murdoch. 2007. <em>A First Course in Statistical Programming with R</em>. Vol. 25. Cambridge University Press Cambridge.</p>
</div>
<div id="ref-Goldberg1991">
<p>Goldberg, David. 1991. “What Every Computer Scientist Should Know About Floating-Point Arithmetic.” <em>ACM Computing Surveys (CSUR)</em> 23 (1). ACM: 5–48.</p>
</div>
<div id="ref-mccallum2011">
<p>McCallum, Ethan, and Stephen Weston. 2011. <em>Parallel R</em>. O’Reilly Media.</p>
</div>
<div id="ref-Eddelbuettel2011">
<p>Eddelbuettel, Dirk, and Romain François. 2011. “Rcpp: Seamless R and C++ Integration.” <em>Journal of Statistical Software</em> 40 (8): 1–18.</p>
</div>
<div id="ref-Eddelbuettel2013">
<p>Eddelbuettel, Dirk. 2013. <em>Seamless R and C++ Integration with Rcpp</em>. Springer.</p>
</div>
<div id="ref-Wickham2014">
<p>Wickham, Hadley. 2014a. <em>Advanced R</em>. CRC Press.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="19">
<li id="fn19"><p>Technically this isn’t in base R, it’s a recommend package.<a href="efficient-performance.html#fnref19">↩</a></p></li>
<li id="fn20"><p>Solutions are available in the <strong>efficient</strong> package vignette.<a href="efficient-performance.html#fnref20">↩</a></p></li>
<li id="fn21"><p>The idea for this example came to one of the authors after a particularly long and dull game of Snakes and Ladders with his son.<a href="efficient-performance.html#fnref21">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="efficient-visualisation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="hardware.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/csgillespie/efficientR/edit/master/08-performance.Rmd",
"text": "Edit"
},
"download": ["_main.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
