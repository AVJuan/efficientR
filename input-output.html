<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Efficient input/output | Efficient R programming</title>
  <meta name="description" content="Efficient R Programming is about increasing the amount of work you can do with R in a given amount of time. It’s about both computational and programmer efficiency." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Efficient input/output | Efficient R programming" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://csgillespie.github.io/efficientR/" />
  <meta property="og:image" content="https://csgillespie.github.io/efficientR/figures/f0_web.png" />
  <meta property="og:description" content="Efficient R Programming is about increasing the amount of work you can do with R in a given amount of time. It’s about both computational and programmer efficiency." />
  <meta name="github-repo" content="csgillespie/efficientR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Efficient input/output | Efficient R programming" />
  <meta name="twitter:site" content="@csgillespie" />
  <meta name="twitter:description" content="Efficient R Programming is about increasing the amount of work you can do with R in a given amount of time. It’s about both computational and programmer efficiency." />
  <meta name="twitter:image" content="https://csgillespie.github.io/efficientR/figures/f0_web.png" />

<meta name="author" content="Colin Gillespie" />
<meta name="author" content="Robin Lovelace" />


<meta name="date" content="2020-10-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="workflow.html"/>
<link rel="next" href="data-carpentry.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Efficient R programming</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to Efficient R Programming</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#who-this-book-is-for-and-how-to-use-it"><i class="fa fa-check"></i><b>1.1</b> Who this book is for and how to use it</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-is-efficiency"><i class="fa fa-check"></i><b>1.2</b> What is efficiency?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-is-efficient-r-programming"><i class="fa fa-check"></i><b>1.3</b> What is efficient R programming?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#why-efficiency"><i class="fa fa-check"></i><b>1.4</b> Why efficiency?</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#cross-transferable-skills-for-efficiency"><i class="fa fa-check"></i><b>1.5</b> Cross-transferable skills for efficiency</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="introduction.html"><a href="introduction.html#touch-typing"><i class="fa fa-check"></i><b>1.5.1</b> Touch typing</a></li>
<li class="chapter" data-level="1.5.2" data-path="introduction.html"><a href="introduction.html#consistent-style-and-code-conventions"><i class="fa fa-check"></i><b>1.5.2</b> Consistent style and code conventions</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#benchmarking-and-profiling"><i class="fa fa-check"></i><b>1.6</b> Benchmarking and profiling</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="introduction.html"><a href="introduction.html#benchmarking"><i class="fa fa-check"></i><b>1.6.1</b> Benchmarking</a></li>
<li class="chapter" data-level="1.6.2" data-path="introduction.html"><a href="introduction.html#benchmarking-example"><i class="fa fa-check"></i><b>1.6.2</b> Benchmarking example</a></li>
<li class="chapter" data-level="1.6.3" data-path="introduction.html"><a href="introduction.html#profiling"><i class="fa fa-check"></i><b>1.6.3</b> Profiling</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#book-resources"><i class="fa fa-check"></i><b>1.7</b> Book resources</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="introduction.html"><a href="introduction.html#r-package"><i class="fa fa-check"></i><b>1.7.1</b> R package</a></li>
<li class="chapter" data-level="1.7.2" data-path="introduction.html"><a href="introduction.html#online-version"><i class="fa fa-check"></i><b>1.7.2</b> Online version</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="set-up.html"><a href="set-up.html"><i class="fa fa-check"></i><b>2</b> Efficient set-up</a>
<ul>
<li class="chapter" data-level="" data-path="set-up.html"><a href="set-up.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="2.1" data-path="set-up.html"><a href="set-up.html#top-5-tips-for-an-efficient-r-set-up"><i class="fa fa-check"></i><b>2.1</b> Top 5 tips for an efficient R set-up</a></li>
<li class="chapter" data-level="2.2" data-path="set-up.html"><a href="set-up.html#operating-system"><i class="fa fa-check"></i><b>2.2</b> Operating system</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="set-up.html"><a href="set-up.html#operating-system-and-resource-monitoring"><i class="fa fa-check"></i><b>2.2.1</b> Operating system and resource monitoring</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="set-up.html"><a href="set-up.html#r-version"><i class="fa fa-check"></i><b>2.3</b> R version</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="set-up.html"><a href="set-up.html#installing-r"><i class="fa fa-check"></i><b>2.3.1</b> Installing R</a></li>
<li class="chapter" data-level="2.3.2" data-path="set-up.html"><a href="set-up.html#updating-r"><i class="fa fa-check"></i><b>2.3.2</b> Updating R</a></li>
<li class="chapter" data-level="2.3.3" data-path="set-up.html"><a href="set-up.html#installing-r-packages"><i class="fa fa-check"></i><b>2.3.3</b> Installing R packages</a></li>
<li class="chapter" data-level="2.3.4" data-path="set-up.html"><a href="set-up.html#deps"><i class="fa fa-check"></i><b>2.3.4</b> Installing R packages with dependencies</a></li>
<li class="chapter" data-level="2.3.5" data-path="set-up.html"><a href="set-up.html#updating-r-packages"><i class="fa fa-check"></i><b>2.3.5</b> Updating R packages</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="set-up.html"><a href="set-up.html#r-startup"><i class="fa fa-check"></i><b>2.4</b> R startup</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="set-up.html"><a href="set-up.html#r-startup-arguments"><i class="fa fa-check"></i><b>2.4.1</b> R startup arguments</a></li>
<li class="chapter" data-level="2.4.2" data-path="set-up.html"><a href="set-up.html#an-overview-of-rs-startup-files"><i class="fa fa-check"></i><b>2.4.2</b> An overview of R’s startup files</a></li>
<li class="chapter" data-level="2.4.3" data-path="set-up.html"><a href="set-up.html#location"><i class="fa fa-check"></i><b>2.4.3</b> The location of startup files</a></li>
<li class="chapter" data-level="2.4.4" data-path="set-up.html"><a href="set-up.html#rprofile"><i class="fa fa-check"></i><b>2.4.4</b> The <code>.Rprofile</code> file</a></li>
<li class="chapter" data-level="2.4.5" data-path="set-up.html"><a href="set-up.html#an-example-.rprofile-file"><i class="fa fa-check"></i><b>2.4.5</b> An example <code>.Rprofile</code> file</a></li>
<li class="chapter" data-level="2.4.6" data-path="set-up.html"><a href="set-up.html#renviron"><i class="fa fa-check"></i><b>2.4.6</b> The <code>.Renviron</code> file</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="set-up.html"><a href="set-up.html#rstudio"><i class="fa fa-check"></i><b>2.5</b> RStudio</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="set-up.html"><a href="set-up.html#install-rstudio"><i class="fa fa-check"></i><b>2.5.1</b> Installing and updating RStudio</a></li>
<li class="chapter" data-level="2.5.2" data-path="set-up.html"><a href="set-up.html#window-pane-layout"><i class="fa fa-check"></i><b>2.5.2</b> Window pane layout</a></li>
<li class="chapter" data-level="2.5.3" data-path="set-up.html"><a href="set-up.html#rstudio-options"><i class="fa fa-check"></i><b>2.5.3</b> RStudio options</a></li>
<li class="chapter" data-level="2.5.4" data-path="set-up.html"><a href="set-up.html#autocompletion"><i class="fa fa-check"></i><b>2.5.4</b> Autocompletion</a></li>
<li class="chapter" data-level="2.5.5" data-path="set-up.html"><a href="set-up.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>2.5.5</b> Keyboard shortcuts</a></li>
<li class="chapter" data-level="2.5.6" data-path="set-up.html"><a href="set-up.html#object-display-and-output-table"><i class="fa fa-check"></i><b>2.5.6</b> Object display and output table</a></li>
<li class="chapter" data-level="2.5.7" data-path="set-up.html"><a href="set-up.html#project-management"><i class="fa fa-check"></i><b>2.5.7</b> Project management</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="set-up.html"><a href="set-up.html#blas-and-alternative-r-interpreters"><i class="fa fa-check"></i><b>2.6</b> BLAS and alternative R interpreters</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="set-up.html"><a href="set-up.html#testing-performance-gains-from-blas"><i class="fa fa-check"></i><b>2.6.1</b> Testing performance gains from BLAS</a></li>
<li class="chapter" data-level="2.6.2" data-path="set-up.html"><a href="set-up.html#other-interpreters"><i class="fa fa-check"></i><b>2.6.2</b> Other interpreters</a></li>
<li class="chapter" data-level="2.6.3" data-path="set-up.html"><a href="set-up.html#useful-blasbenchmarking-resources"><i class="fa fa-check"></i><b>2.6.3</b> Useful BLAS/benchmarking resources</a></li>
<li class="chapter" data-level="" data-path="set-up.html"><a href="set-up.html#exercises-6"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>3</b> Efficient programming</a>
<ul>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#prerequisites-2"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="3.1" data-path="programming.html"><a href="programming.html#top-5-tips-for-efficient-programming"><i class="fa fa-check"></i><b>3.1</b> Top 5 tips for efficient programming</a></li>
<li class="chapter" data-level="3.2" data-path="programming.html"><a href="programming.html#general"><i class="fa fa-check"></i><b>3.2</b> General advice</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="programming.html"><a href="programming.html#memory-allocation"><i class="fa fa-check"></i><b>3.2.1</b> Memory allocation</a></li>
<li class="chapter" data-level="3.2.2" data-path="programming.html"><a href="programming.html#vectorised-code"><i class="fa fa-check"></i><b>3.2.2</b> Vectorised code</a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#exercise-1"><i class="fa fa-check"></i>Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="programming.html"><a href="programming.html#communicating-with-the-user"><i class="fa fa-check"></i><b>3.3</b> Communicating with the user</a>
<ul>
<li><a href="programming.html#fatal-errors-stop">Fatal errors: <code>stop()</code></a></li>
<li><a href="programming.html#warnings-warning">Warnings: <code>warning()</code></a></li>
<li><a href="programming.html#informative-output-message-and-cat">Informative output: <code>message()</code> and <code>cat()</code></a></li>
<li class="chapter" data-level="" data-path="programming.html"><a href="programming.html#exercises-8"><i class="fa fa-check"></i>Exercises</a></li>
<li class="chapter" data-level="3.3.1" data-path="programming.html"><a href="programming.html#invisible-returns"><i class="fa fa-check"></i><b>3.3.1</b> Invisible returns</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="programming.html"><a href="programming.html#factors"><i class="fa fa-check"></i><b>3.4</b> Factors</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="programming.html"><a href="programming.html#inherent-order"><i class="fa fa-check"></i><b>3.4.1</b> Inherent order</a></li>
<li class="chapter" data-level="3.4.2" data-path="programming.html"><a href="programming.html#fixed-set-of-categories"><i class="fa fa-check"></i><b>3.4.2</b> Fixed set of categories</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="programming.html"><a href="programming.html#the-apply-family"><i class="fa fa-check"></i><b>3.5</b> The apply family</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="programming.html"><a href="programming.html#example-the-movies-data-set"><i class="fa fa-check"></i><b>3.5.1</b> Example: the movies data set</a></li>
<li class="chapter" data-level="3.5.2" data-path="programming.html"><a href="programming.html#type-consistency"><i class="fa fa-check"></i><b>3.5.2</b> Type consistency</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="programming.html"><a href="programming.html#caching-variables"><i class="fa fa-check"></i><b>3.6</b> Caching variables</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="programming.html"><a href="programming.html#function-closures"><i class="fa fa-check"></i><b>3.6.1</b> Function closures</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="programming.html"><a href="programming.html#the-byte-compiler"><i class="fa fa-check"></i><b>3.7</b> The byte compiler</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="programming.html"><a href="programming.html#example-the-mean-function"><i class="fa fa-check"></i><b>3.7.1</b> Example: the mean function</a></li>
<li class="chapter" data-level="3.7.2" data-path="programming.html"><a href="programming.html#compiling-code"><i class="fa fa-check"></i><b>3.7.2</b> Compiling code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>4</b> Efficient workflow</a>
<ul>
<li class="chapter" data-level="" data-path="workflow.html"><a href="workflow.html#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="4.1" data-path="workflow.html"><a href="workflow.html#top-5-tips-for-efficient-workflow"><i class="fa fa-check"></i><b>4.1</b> Top 5 tips for efficient workflow</a></li>
<li class="chapter" data-level="4.2" data-path="workflow.html"><a href="workflow.html#a-project-planning-typology"><i class="fa fa-check"></i><b>4.2</b> A project planning typology</a></li>
<li class="chapter" data-level="4.3" data-path="workflow.html"><a href="workflow.html#project-planning-and-management"><i class="fa fa-check"></i><b>4.3</b> Project planning and management</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="workflow.html"><a href="workflow.html#chunking-your-work"><i class="fa fa-check"></i><b>4.3.1</b> ‘Chunking’ your work</a></li>
<li class="chapter" data-level="4.3.2" data-path="workflow.html"><a href="workflow.html#smart"><i class="fa fa-check"></i><b>4.3.2</b> Making your workflow SMART</a></li>
<li class="chapter" data-level="4.3.3" data-path="workflow.html"><a href="workflow.html#visualising-plans-with-r"><i class="fa fa-check"></i><b>4.3.3</b> Visualising plans with R</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="workflow.html"><a href="workflow.html#package-selection"><i class="fa fa-check"></i><b>4.4</b> Package selection</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="workflow.html"><a href="workflow.html#searching-for-r-packages"><i class="fa fa-check"></i><b>4.4.1</b> Searching for R packages</a></li>
<li class="chapter" data-level="4.4.2" data-path="workflow.html"><a href="workflow.html#how-to-select-a-package"><i class="fa fa-check"></i><b>4.4.2</b> How to select a package</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="workflow.html"><a href="workflow.html#publication"><i class="fa fa-check"></i><b>4.5</b> Publication</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="workflow.html"><a href="workflow.html#dynamic-documents-with-r-markdown"><i class="fa fa-check"></i><b>4.5.1</b> Dynamic documents with R Markdown</a></li>
<li class="chapter" data-level="4.5.2" data-path="workflow.html"><a href="workflow.html#r-packages"><i class="fa fa-check"></i><b>4.5.2</b> R packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="input-output.html"><a href="input-output.html"><i class="fa fa-check"></i><b>5</b> Efficient input/output</a>
<ul>
<li class="chapter" data-level="" data-path="input-output.html"><a href="input-output.html#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="5.1" data-path="input-output.html"><a href="input-output.html#top-5-tips-for-efficient-data-io"><i class="fa fa-check"></i><b>5.1</b> Top 5 tips for efficient data I/O</a></li>
<li class="chapter" data-level="5.2" data-path="input-output.html"><a href="input-output.html#versatile-data-import-with-rio"><i class="fa fa-check"></i><b>5.2</b> Versatile data import with rio</a>
<ul>
<li class="chapter" data-level="" data-path="input-output.html"><a href="input-output.html#exercises-11"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="input-output.html"><a href="input-output.html#fread"><i class="fa fa-check"></i><b>5.3</b> Plain text formats</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="input-output.html"><a href="input-output.html#differences-between-fread-and-read_csv"><i class="fa fa-check"></i><b>5.3.1</b> Differences between <code>fread()</code> and <code>read_csv()</code></a></li>
<li class="chapter" data-level="5.3.2" data-path="input-output.html"><a href="input-output.html#preprocessing-text-outside-r"><i class="fa fa-check"></i><b>5.3.2</b> Preprocessing text outside R</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="input-output.html"><a href="input-output.html#binary-file-formats"><i class="fa fa-check"></i><b>5.4</b> Binary file formats</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="input-output.html"><a href="input-output.html#native-binary-formats-rdata-or-rds"><i class="fa fa-check"></i><b>5.4.1</b> Native binary formats: Rdata or Rds?</a></li>
<li class="chapter" data-level="5.4.2" data-path="input-output.html"><a href="input-output.html#the-feather-file-format"><i class="fa fa-check"></i><b>5.4.2</b> The feather file format</a></li>
<li class="chapter" data-level="5.4.3" data-path="input-output.html"><a href="input-output.html#benchmarking-binary-file-formats"><i class="fa fa-check"></i><b>5.4.3</b> Benchmarking binary file formats</a></li>
<li class="chapter" data-level="5.4.4" data-path="input-output.html"><a href="input-output.html#protocol-buffers"><i class="fa fa-check"></i><b>5.4.4</b> Protocol Buffers</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="input-output.html"><a href="input-output.html#download"><i class="fa fa-check"></i><b>5.5</b> Getting data from the internet</a></li>
<li class="chapter" data-level="5.6" data-path="input-output.html"><a href="input-output.html#accessing-data-stored-in-packages"><i class="fa fa-check"></i><b>5.6</b> Accessing data stored in packages</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-carpentry.html"><a href="data-carpentry.html"><i class="fa fa-check"></i><b>6</b> Efficient data carpentry</a>
<ul>
<li class="chapter" data-level="" data-path="data-carpentry.html"><a href="data-carpentry.html#prerequisites-5"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="6.1" data-path="data-carpentry.html"><a href="data-carpentry.html#top-5-tips-for-efficient-data-carpentry"><i class="fa fa-check"></i><b>6.1</b> Top 5 tips for efficient data carpentry</a></li>
<li class="chapter" data-level="6.2" data-path="data-carpentry.html"><a href="data-carpentry.html#efficient-data-frames-with-tibble"><i class="fa fa-check"></i><b>6.2</b> Efficient data frames with tibble</a></li>
<li class="chapter" data-level="6.3" data-path="data-carpentry.html"><a href="data-carpentry.html#tidying-data-with-tidyr-and-regular-expressions"><i class="fa fa-check"></i><b>6.3</b> Tidying data with tidyr and regular expressions</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="data-carpentry.html"><a href="data-carpentry.html#make-wide-tables-long-with-pivot_longer"><i class="fa fa-check"></i><b>6.3.1</b> Make wide tables long with <code>pivot_longer()</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="data-carpentry.html"><a href="data-carpentry.html#split-joint-variables-with-separate"><i class="fa fa-check"></i><b>6.3.2</b> Split joint variables with <code>separate()</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="data-carpentry.html"><a href="data-carpentry.html#other-tidyr-functions"><i class="fa fa-check"></i><b>6.3.3</b> Other tidyr functions</a></li>
<li class="chapter" data-level="6.3.4" data-path="data-carpentry.html"><a href="data-carpentry.html#regular-expressions"><i class="fa fa-check"></i><b>6.3.4</b> Regular expressions</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="data-carpentry.html"><a href="data-carpentry.html#dplyr"><i class="fa fa-check"></i><b>6.4</b> Efficient data processing with dplyr</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="data-carpentry.html"><a href="data-carpentry.html#renaming-columns"><i class="fa fa-check"></i><b>6.4.1</b> Renaming columns</a></li>
<li class="chapter" data-level="6.4.2" data-path="data-carpentry.html"><a href="data-carpentry.html#changing-column-classes"><i class="fa fa-check"></i><b>6.4.2</b> Changing column classes</a></li>
<li class="chapter" data-level="6.4.3" data-path="data-carpentry.html"><a href="data-carpentry.html#filtering-rows"><i class="fa fa-check"></i><b>6.4.3</b> Filtering rows</a></li>
<li class="chapter" data-level="6.4.4" data-path="data-carpentry.html"><a href="data-carpentry.html#chaining-operations"><i class="fa fa-check"></i><b>6.4.4</b> Chaining operations</a></li>
<li class="chapter" data-level="6.4.5" data-path="data-carpentry.html"><a href="data-carpentry.html#data-aggregation"><i class="fa fa-check"></i><b>6.4.5</b> Data aggregation</a></li>
<li class="chapter" data-level="6.4.6" data-path="data-carpentry.html"><a href="data-carpentry.html#non-standard-evaluation"><i class="fa fa-check"></i><b>6.4.6</b> Non standard evaluation</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="data-carpentry.html"><a href="data-carpentry.html#combining-datasets"><i class="fa fa-check"></i><b>6.5</b> Combining datasets</a></li>
<li class="chapter" data-level="6.6" data-path="data-carpentry.html"><a href="data-carpentry.html#working-with-databases"><i class="fa fa-check"></i><b>6.6</b> Working with databases</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="data-carpentry.html"><a href="data-carpentry.html#databases-and-dplyr"><i class="fa fa-check"></i><b>6.6.1</b> Databases and <strong>dplyr</strong></a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="data-carpentry.html"><a href="data-carpentry.html#data-processing-with-data.table"><i class="fa fa-check"></i><b>6.7</b> Data processing with data.table</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="performance.html"><a href="performance.html"><i class="fa fa-check"></i><b>7</b> Efficient optimisation</a>
<ul>
<li class="chapter" data-level="" data-path="performance.html"><a href="performance.html#prerequisites-6"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="7.1" data-path="performance.html"><a href="performance.html#top-5-tips-for-efficient-performance"><i class="fa fa-check"></i><b>7.1</b> Top 5 tips for efficient performance</a></li>
<li class="chapter" data-level="7.2" data-path="performance.html"><a href="performance.html#performance-profvis"><i class="fa fa-check"></i><b>7.2</b> Code profiling</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="performance.html"><a href="performance.html#getting-started-with-profvis"><i class="fa fa-check"></i><b>7.2.1</b> Getting started with <strong>profvis</strong></a></li>
<li class="chapter" data-level="7.2.2" data-path="performance.html"><a href="performance.html#monopoloy"><i class="fa fa-check"></i><b>7.2.2</b> Example: Monopoly Simulation</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="performance.html"><a href="performance.html#efficient-base-r"><i class="fa fa-check"></i><b>7.3</b> Efficient base R</a>
<ul>
<li><a href="performance.html#the-if-vs-ifelse-functions">The <code>if()</code> vs <code>ifelse()</code> functions</a></li>
<li class="chapter" data-level="" data-path="performance.html"><a href="performance.html#sorting-and-ordering"><i class="fa fa-check"></i>Sorting and ordering</a></li>
<li class="chapter" data-level="" data-path="performance.html"><a href="performance.html#reversing-elements"><i class="fa fa-check"></i>Reversing elements</a></li>
<li><a href="performance.html#which-indices-are-true">Which indices are <code>TRUE</code>  </a></li>
<li class="chapter" data-level="" data-path="performance.html"><a href="performance.html#converting-factors-to-numerics"><i class="fa fa-check"></i>Converting factors to numerics</a></li>
<li class="chapter" data-level="" data-path="performance.html"><a href="performance.html#logical-and-and-or"><i class="fa fa-check"></i>Logical AND and OR</a></li>
<li class="chapter" data-level="" data-path="performance.html"><a href="performance.html#row-and-column-operations"><i class="fa fa-check"></i>Row and column operations</a></li>
<li><a href="performance.html#is.na-and-anyna"><code>is.na()</code> and <code>anyNA()</code>  </a></li>
<li class="chapter" data-level="" data-path="performance.html"><a href="performance.html#matrices"><i class="fa fa-check"></i>Matrices</a></li>
<li class="chapter" data-level="" data-path="performance.html"><a href="performance.html#the-integer-data-type"><i class="fa fa-check"></i>The integer data type</a></li>
<li class="chapter" data-level="" data-path="performance.html"><a href="performance.html#sparse-matrices"><i class="fa fa-check"></i>Sparse matrices</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="performance.html"><a href="performance.html#example-optimising-the-move_square-function"><i class="fa fa-check"></i><b>7.4</b> Example: Optimising the <code>move_square()</code> function</a></li>
<li class="chapter" data-level="7.5" data-path="performance.html"><a href="performance.html#performance-parallel"><i class="fa fa-check"></i><b>7.5</b> Parallel computing</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="performance.html"><a href="performance.html#parallel-versions-of-apply-functions"><i class="fa fa-check"></i><b>7.5.1</b> Parallel versions of apply functions</a></li>
<li class="chapter" data-level="7.5.2" data-path="performance.html"><a href="performance.html#example-snakes-and-ladders"><i class="fa fa-check"></i><b>7.5.2</b> Example: Snakes and Ladders</a></li>
<li class="chapter" data-level="7.5.3" data-path="performance.html"><a href="performance.html#exit-functions-with-care"><i class="fa fa-check"></i><b>7.5.3</b> Exit functions with care</a></li>
<li class="chapter" data-level="7.5.4" data-path="performance.html"><a href="performance.html#parallel-code-under-linux-os-x"><i class="fa fa-check"></i><b>7.5.4</b> Parallel code under Linux &amp; OS X</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="performance.html"><a href="performance.html#rcpp"><i class="fa fa-check"></i><b>7.6</b> Rcpp</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="performance.html"><a href="performance.html#simple-c"><i class="fa fa-check"></i><b>7.6.1</b> A simple C++ function</a></li>
<li class="chapter" data-level="7.6.2" data-path="performance.html"><a href="performance.html#cppfunction"><i class="fa fa-check"></i><b>7.6.2</b> The <code>cppFunction()</code> command</a></li>
<li class="chapter" data-level="7.6.3" data-path="performance.html"><a href="performance.html#c-types"><i class="fa fa-check"></i><b>7.6.3</b> C++ data types</a></li>
<li class="chapter" data-level="7.6.4" data-path="performance.html"><a href="performance.html#sourcecpp"><i class="fa fa-check"></i><b>7.6.4</b> The <code>sourceCpp()</code> function</a></li>
<li class="chapter" data-level="7.6.5" data-path="performance.html"><a href="performance.html#vectors-and-loops"><i class="fa fa-check"></i><b>7.6.5</b> Vectors and loops</a></li>
<li class="chapter" data-level="7.6.6" data-path="performance.html"><a href="performance.html#sugar"><i class="fa fa-check"></i><b>7.6.6</b> C++ with sugar on top</a></li>
<li class="chapter" data-level="7.6.7" data-path="performance.html"><a href="performance.html#rcpp-resources"><i class="fa fa-check"></i><b>7.6.7</b> Rcpp resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="hardware.html"><a href="hardware.html"><i class="fa fa-check"></i><b>8</b> Efficient hardware</a>
<ul>
<li class="chapter" data-level="" data-path="hardware.html"><a href="hardware.html#prerequisites-7"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="8.1" data-path="hardware.html"><a href="hardware.html#top-5-tips-for-efficient-hardware"><i class="fa fa-check"></i><b>8.1</b> Top 5 tips for efficient hardware</a></li>
<li class="chapter" data-level="8.2" data-path="hardware.html"><a href="hardware.html#background-what-is-a-byte"><i class="fa fa-check"></i><b>8.2</b> Background: what is a byte?</a></li>
<li class="chapter" data-level="8.3" data-path="hardware.html"><a href="hardware.html#ram"><i class="fa fa-check"></i><b>8.3</b> Random access memory: RAM</a></li>
<li class="chapter" data-level="8.4" data-path="hardware.html"><a href="hardware.html#hard-drives-hdd-vs-ssd"><i class="fa fa-check"></i><b>8.4</b> Hard drives: HDD vs SSD</a></li>
<li class="chapter" data-level="8.5" data-path="hardware.html"><a href="hardware.html#operating-systems-32-bit-or-64-bit"><i class="fa fa-check"></i><b>8.5</b> Operating systems: 32-bit or 64-bit</a></li>
<li class="chapter" data-level="8.6" data-path="hardware.html"><a href="hardware.html#central-processing-unit-cpu"><i class="fa fa-check"></i><b>8.6</b> Central processing unit (CPU)</a></li>
<li class="chapter" data-level="8.7" data-path="hardware.html"><a href="hardware.html#cloud-computing"><i class="fa fa-check"></i><b>8.7</b> Cloud computing</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="hardware.html"><a href="hardware.html#amazon-ec2"><i class="fa fa-check"></i><b>8.7.1</b> Amazon EC2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="collaboration.html"><a href="collaboration.html"><i class="fa fa-check"></i><b>9</b> Efficient collaboration</a>
<ul>
<li class="chapter" data-level="" data-path="collaboration.html"><a href="collaboration.html#prerequisites-8"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="9.1" data-path="collaboration.html"><a href="collaboration.html#top-5-tips-for-efficient-collaboration"><i class="fa fa-check"></i><b>9.1</b> Top 5 tips for efficient collaboration</a></li>
<li class="chapter" data-level="9.2" data-path="collaboration.html"><a href="collaboration.html#coding-style"><i class="fa fa-check"></i><b>9.2</b> Coding style</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="collaboration.html"><a href="collaboration.html#reformatting-code-with-rstudio"><i class="fa fa-check"></i><b>9.2.1</b> Reformatting code with RStudio</a></li>
<li class="chapter" data-level="9.2.2" data-path="collaboration.html"><a href="collaboration.html#file-names"><i class="fa fa-check"></i><b>9.2.2</b> File names</a></li>
<li class="chapter" data-level="9.2.3" data-path="collaboration.html"><a href="collaboration.html#loading-packages"><i class="fa fa-check"></i><b>9.2.3</b> Loading packages</a></li>
<li class="chapter" data-level="9.2.4" data-path="collaboration.html"><a href="collaboration.html#commenting"><i class="fa fa-check"></i><b>9.2.4</b> Commenting</a></li>
<li class="chapter" data-level="9.2.5" data-path="collaboration.html"><a href="collaboration.html#object-names"><i class="fa fa-check"></i><b>9.2.5</b> Object names</a></li>
<li class="chapter" data-level="9.2.6" data-path="collaboration.html"><a href="collaboration.html#example-package"><i class="fa fa-check"></i><b>9.2.6</b> Example package</a></li>
<li class="chapter" data-level="9.2.7" data-path="collaboration.html"><a href="collaboration.html#assignment"><i class="fa fa-check"></i><b>9.2.7</b> Assignment</a></li>
<li class="chapter" data-level="9.2.8" data-path="collaboration.html"><a href="collaboration.html#spacing"><i class="fa fa-check"></i><b>9.2.8</b> Spacing</a></li>
<li class="chapter" data-level="9.2.9" data-path="collaboration.html"><a href="collaboration.html#indentation"><i class="fa fa-check"></i><b>9.2.9</b> Indentation</a></li>
<li class="chapter" data-level="9.2.10" data-path="collaboration.html"><a href="collaboration.html#curly-braces"><i class="fa fa-check"></i><b>9.2.10</b> Curly braces</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="collaboration.html"><a href="collaboration.html#version-control"><i class="fa fa-check"></i><b>9.3</b> Version control</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="collaboration.html"><a href="collaboration.html#commits"><i class="fa fa-check"></i><b>9.3.1</b> Commits</a></li>
<li class="chapter" data-level="9.3.2" data-path="collaboration.html"><a href="collaboration.html#git-integration-in-rstudio"><i class="fa fa-check"></i><b>9.3.2</b> Git integration in RStudio</a></li>
<li class="chapter" data-level="9.3.3" data-path="collaboration.html"><a href="collaboration.html#github"><i class="fa fa-check"></i><b>9.3.3</b> GitHub</a></li>
<li class="chapter" data-level="9.3.4" data-path="collaboration.html"><a href="collaboration.html#branches-forks-pulls-and-clones"><i class="fa fa-check"></i><b>9.3.4</b> Branches, forks, pulls and clones</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="collaboration.html"><a href="collaboration.html#code-review"><i class="fa fa-check"></i><b>9.4</b> Code review</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="learning.html"><a href="learning.html"><i class="fa fa-check"></i><b>10</b> Efficient learning</a>
<ul>
<li class="chapter" data-level="" data-path="learning.html"><a href="learning.html#prerequisties"><i class="fa fa-check"></i>Prerequisties</a></li>
<li class="chapter" data-level="10.1" data-path="learning.html"><a href="learning.html#top-5-tips-for-efficient-learning"><i class="fa fa-check"></i><b>10.1</b> Top 5 tips for efficient learning</a></li>
<li class="chapter" data-level="10.2" data-path="learning.html"><a href="learning.html#using-rs-internal-help"><i class="fa fa-check"></i><b>10.2</b> Using R’s internal help</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="learning.html"><a href="learning.html#searching-r-for-topics"><i class="fa fa-check"></i><b>10.2.1</b> Searching R for topics</a></li>
<li class="chapter" data-level="10.2.2" data-path="learning.html"><a href="learning.html#finding-and-using-vignettes"><i class="fa fa-check"></i><b>10.2.2</b> Finding and using vignettes</a></li>
<li class="chapter" data-level="10.2.3" data-path="learning.html"><a href="learning.html#getting-help-on-functions"><i class="fa fa-check"></i><b>10.2.3</b> Getting help on functions</a></li>
<li class="chapter" data-level="10.2.4" data-path="learning.html"><a href="learning.html#reading-r-source-code"><i class="fa fa-check"></i><b>10.2.4</b> Reading R source code</a></li>
<li class="chapter" data-level="10.2.5" data-path="learning.html"><a href="learning.html#swirl"><i class="fa fa-check"></i><b>10.2.5</b> Swirl</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="learning.html"><a href="learning.html#online-resources"><i class="fa fa-check"></i><b>10.3</b> Online resources</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="learning.html"><a href="learning.html#stackoverflow"><i class="fa fa-check"></i><b>10.3.1</b> Stackoverflow</a></li>
<li class="chapter" data-level="10.3.2" data-path="learning.html"><a href="learning.html#mailing-lists-and-groups."><i class="fa fa-check"></i><b>10.3.2</b> Mailing lists and groups.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="learning.html"><a href="learning.html#asking-a-question"><i class="fa fa-check"></i><b>10.4</b> Asking a question</a>
<ul>
<li class="chapter" data-level="" data-path="learning.html"><a href="learning.html#minimal-data-set"><i class="fa fa-check"></i>Minimal data set</a></li>
<li class="chapter" data-level="" data-path="learning.html"><a href="learning.html#minimal-example"><i class="fa fa-check"></i>Minimal example</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="learning.html"><a href="learning.html#learning-in-depth"><i class="fa fa-check"></i><b>10.5</b> Learning in depth</a></li>
<li class="chapter" data-level="10.6" data-path="learning.html"><a href="learning.html#spread-the-knowledge"><i class="fa fa-check"></i><b>10.6</b> Spread the knowledge</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="building-the-book-from-source.html"><a href="building-the-book-from-source.html"><i class="fa fa-check"></i><b>A</b> Building the book from source</a>
<ul>
<li class="chapter" data-level="A.1" data-path="building-the-book-from-source.html"><a href="building-the-book-from-source.html#package-dependencies"><i class="fa fa-check"></i><b>A.1</b> Package dependencies</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="http://www.jumpingrivers.com">Colin Gillespie</a></li>
<li><a href="http://www.robinlovelace.net">Robin Lovelace</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Efficient R programming</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="input-output" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Efficient input/output</h1>
<p>This chapter explains how to efficiently read and write data in R. Input/output (I/O) is the technical term for reading and writing data: the process of getting information into a particular computer system (in this case R) and then exporting it to the ‘outside world’ again (in this case as a file format that other software can read). Data I/O will be needed on projects where data comes from, or goes to, external sources. However, the majority of R resources and documentation start with the optimistic assumption that your data has already been loaded, ignoring the fact that importing datasets into R, and exporting them to the world outside the R ecosystem, can be a time-consuming and frustrating process. Tricky, slow or ultimately unsuccessful data I/O can cripple efficiency right at the outset of a project. Conversely, reading and writing your data efficiently will make your R projects more likely to succeed in the outside world.</p>
<p>The first section introduces <strong>rio</strong>, a ‘meta package’ for efficiently reading and writing data in a range of file formats. <strong>rio</strong> requires only two intuitive functions for data I/O, making it efficient to learn and use. Next we explore in more detail efficient functions for reading in files stored in common <em>plain text</em> file formats from the <strong>readr</strong> and <strong>data.table</strong> packages. Binary formats, which can dramatically reduce file sizes and read/write times, are covered next.</p>
<p>With the accelerating digital revolution and growth in open data, an increasing proportion of the world’s data can be downloaded from the internet. This trend is set to continue, making section <a href="input-output.html#download">5.5</a>, on downloading and importing data from the web, important for ‘future-proofing’ your I/O skills. The benchmarks in this chapter demonstrate that choice of file format and packages for data I/O can have a huge impact on computational efficiency.</p>
<p>Before reading in a single line of data, it is worth considering a general principle for reproducible data management: never modify raw data files. Raw data should be seen as read-only, and contain information about its provenance. Keeping the original file name and commenting on its origin are a couple of ways to improve reproducibility, even when the data are not publicly available.</p>
<div id="prerequisites-4" class="section level3 unnumbered" number="">
<h3>Prerequisites</h3>
<p>R can read data from a variety of sources. We begin by discussing the generic package <strong>rio</strong> that handles a wide variety of data types. Special attention is paid to CSV files, which leads to the <strong>readr</strong> and <strong>data.table</strong> packages. The relatively new package <strong>feather</strong> is introduced as a binary file format, that has cross-language support.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="input-output.html#cb113-1"></a><span class="kw">library</span>(<span class="st">&quot;rio&quot;</span>)</span>
<span id="cb113-2"><a href="input-output.html#cb113-2"></a><span class="kw">library</span>(<span class="st">&quot;readr&quot;</span>)</span>
<span id="cb113-3"><a href="input-output.html#cb113-3"></a><span class="kw">library</span>(<span class="st">&quot;data.table&quot;</span>)</span>
<span id="cb113-4"><a href="input-output.html#cb113-4"></a><span class="kw">library</span>(<span class="st">&quot;feather&quot;</span>)</span></code></pre></div>
<p>We also use the <strong>WDI</strong> package to illustrate accessing online data sets</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="input-output.html#cb114-1"></a><span class="kw">library</span>(<span class="st">&quot;WDI&quot;</span>)</span></code></pre></div>
</div>
<div id="top-5-tips-for-efficient-data-io" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Top 5 tips for efficient data I/O</h2>
<ol style="list-style-type: decimal">
<li><p>If possible, keep the names of local files downloaded from the internet or copied onto your computer unchanged. This will help you trace the provenance of the data in the future.</p></li>
<li><p>R’s native file format is <code>.Rds</code>. These files can be imported and exported using <code>readRDS()</code> and <code>saveRDS()</code> for fast and space efficient data storage.</p></li>
<li><p>Use <code>import()</code> from the <strong>rio</strong> package to efficiently import data from a wide range of formats, avoiding the hassle of loading format-specific libraries.</p></li>
<li><p>Use the <strong>readr</strong> or <strong>data.table</strong> equivalents of <code>read.table()</code> to efficiently import large text files.</p></li>
<li><p>Use <code>file.size()</code> and <code>object.size()</code> to keep track of the size of files and R objects and take action if they get too big.</p></li>
</ol>
</div>
<div id="versatile-data-import-with-rio" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Versatile data import with rio</h2>
<p><strong>rio</strong> is a ‘A Swiss-Army Knife for Data I/O’. <strong>rio</strong> provides easy-to-use and computationally efficient functions for importing and exporting tabular data in a range of file formats. As stated in the package’s <a href="https://cran.r-project.org/web/packages/rio/vignettes/rio.html">vignette</a>, <strong>rio</strong> aims to “simplify the process of importing data into R and exporting data from R.” The vignette goes on to explain how many of the functions for data I/O described in R’s <a href="https://cran.r-project.org/doc/manuals/r-release/R-data.html">Data Import/Export manual</a> are out of date (for example referring to <strong>WriteXLS</strong> but not the more recent <strong>readxl</strong> package) and difficult to learn.</p>
<p>This is why <strong>rio</strong> is covered at the outset of this chapter: if you just want to get data into R, with a minimum of time learning new functions, there is a fair chance that <strong>rio</strong> can help, for many common file formats. At the time of writing, these include <code>.csv</code>, <code>.feather</code>, <code>.json</code>, <code>.dta</code>, <code>.xls</code>, <code>.xlsx</code> and Google Sheets (see the package’s <a href="https://github.com/leeper/rio">github page</a> for up-to-date information). Below we illustrate the key <strong>rio</strong> functions of <code>import()</code> and <code>export()</code>:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="input-output.html#cb115-1"></a><span class="kw">library</span>(<span class="st">&quot;rio&quot;</span>)</span>
<span id="cb115-2"><a href="input-output.html#cb115-2"></a><span class="co"># Specify a file</span></span>
<span id="cb115-3"><a href="input-output.html#cb115-3"></a>fname =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/voc_voyages.tsv&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;efficient&quot;</span>)</span>
<span id="cb115-4"><a href="input-output.html#cb115-4"></a><span class="co"># Import the file (uses the fread function from data.table)</span></span>
<span id="cb115-5"><a href="input-output.html#cb115-5"></a>voyages =<span class="st"> </span><span class="kw">import</span>(fname)</span>
<span id="cb115-6"><a href="input-output.html#cb115-6"></a><span class="co"># Export the file as an Excel spreadsheet</span></span>
<span id="cb115-7"><a href="input-output.html#cb115-7"></a><span class="kw">export</span>(voyages, <span class="st">&quot;voc_voyages.xlsx&quot;</span>)</span></code></pre></div>
<p>There was no need to specify the optional <code>format</code> argument for data import and export functions because this is inferred by the <em>suffix</em>, in the above example <code>.tsv</code> and <code>.xlsx</code> respectively. You can override the inferred file format for both functions with the <code>format</code> argument. You could, for example, create a comma-delimited file called <code>voc_voyages.xlsx</code> with <code>export(voyages, "voc_voyages.xlsx", format = "csv")</code>. However, this would <strong>not</strong> be a good idea: it is important to ensure that a file’s suffix matches its format.</p>
<p>To provide another example, the code chunk below downloads and imports as a data frame information about the countries of the world stored in <code>.json</code> (downloading data from the internet is covered in more detail in Section <a href="input-output.html#download">5.5</a>):</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="input-output.html#cb116-1"></a>capitals =<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;https://github.com/mledoze/countries/raw/master/countries.json&quot;</span>)</span></code></pre></div>
<div class="rmdtip">
<p>
The ability to import and use <code>.json</code> data is becoming increasingly common as it a standard output format for many APIs. The <strong>jsonlite</strong> and <strong>geojsonio</strong> packages have been developed to make this as easy as possible.
</p>
</div>
<div id="exercises-11" class="section level3 unnumbered" number="">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>The final line in the code chunk above shows a neat feature of <strong>rio</strong> and some other packages: the output format is determined by the suffix of the file-name, which make for concise code. Try opening the <code>voc_voyages.xlsx</code> file with an editor such as LibreOffice Calc or Microsoft Excel to ensure that the export worked, before removing this rather inefficient file format from your system:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="input-output.html#cb117-1"></a><span class="kw">file.remove</span>(<span class="st">&quot;voc_voyages.xlsx&quot;</span>)</span></code></pre></div></li>
<li><p>Try saving the <code>voyages</code> data frames into 3 other file formats of your choosing (see <code>vignette("rio")</code> for supported formats). Try opening these in external programs. Which file formats are more portable?</p></li>
<li><p>As a bonus exercise, create a simple benchmark to compare the write times for the different file formats used to complete the previous exercise. Which is fastest? Which is the most space efficient?</p></li>
</ol>
</div>
</div>
<div id="fread" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Plain text formats</h2>
<p>‘Plain text’ data files are encoded in a format (typically UTF-8) that can be read by humans and computers alike. The great thing about plain text is their simplicity and their ease of use: any programming language can read a plain text file. The most common plain text format is <code>.csv</code>, comma-separated values, in which columns are separated by commas and rows are separated by line breaks. This is illustrated in the simple example below:</p>
<pre><code>Person, Nationality, Country of Birth
Robin, British, England
Colin, British, Scotland</code></pre>
<p>There is often more than one way to read data into R and <code>.csv</code> files are no exception. The method you choose has implications for computational efficiency. This section investigates methods for getting plain text files into R, with a focus on three approaches: base R’s plain text reading functions such as <code>read.csv()</code>; the <strong>data.table</strong> approach, which uses the function <code>fread()</code>; and the newer <strong>readr</strong> package which provides <code>read_csv()</code> and other <code>read_*()</code> functions such as <code>read_tsv()</code>. Although these functions perform differently, they are largely cross-compatible, as illustrated in the below chunk, which loads data on the concentration of CO<sup>2</sup> in the atmosphere over time:</p>
<div class="rmdwarning">
<p>
In general, you should never “hand-write” a CSV file. Instead, you should use <code>write.csv()</code> or an equivalent function. The Internet Engineering Task Force has the <a href="https://www.ietf.org/rfc/rfc4180.txt">CSV definition</a> that facilitates sharing CSV files between tools and operating systems.
</p>
</div>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="input-output.html#cb119-1"></a>df_co2 =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;extdata/co2.csv&quot;</span>)</span>
<span id="cb119-2"><a href="input-output.html#cb119-2"></a>df_co2_dt =<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(<span class="st">&quot;extdata/co2.csv&quot;</span>)</span>
<span id="cb119-3"><a href="input-output.html#cb119-3"></a><span class="co">#&gt; Warning: Missing column names filled in: &#39;X1&#39; [1]</span></span>
<span id="cb119-4"><a href="input-output.html#cb119-4"></a><span class="co">#&gt; </span></span>
<span id="cb119-5"><a href="input-output.html#cb119-5"></a><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb119-6"><a href="input-output.html#cb119-6"></a><span class="co">#&gt; cols(</span></span>
<span id="cb119-7"><a href="input-output.html#cb119-7"></a><span class="co">#&gt;   X1 = col_double(),</span></span>
<span id="cb119-8"><a href="input-output.html#cb119-8"></a><span class="co">#&gt;   time = col_double(),</span></span>
<span id="cb119-9"><a href="input-output.html#cb119-9"></a><span class="co">#&gt;   co2 = col_double()</span></span>
<span id="cb119-10"><a href="input-output.html#cb119-10"></a><span class="co">#&gt; )</span></span>
<span id="cb119-11"><a href="input-output.html#cb119-11"></a>df_co2_readr =<span class="st"> </span>data.table<span class="op">::</span><span class="kw">fread</span>(<span class="st">&quot;extdata/co2.csv&quot;</span>)</span></code></pre></div>
<div class="rmdnote">
<p>
Note that a function ‘derived from’ another in this context means that it calls another function. The functions such as <code>read.csv()</code> and <code>read.delim()</code> in fact are <em>wrappers</em> around <code>read.table()</code>. This can be seen in the source code of <code>read.csv()</code>, for example, which shows that the function is roughly the equivalent of <code>read.table(file, header = TRUE, sep = “,”)</code>.
</p>
</div>
<p>Although this section is focussed on reading text files, it demonstrates the wider principle that the speed and flexibility advantages of additional read functions can be offset by the disadvantage of additional package dependencies (in terms of complexity and maintaining the code) for small datasets. The real benefits kick in on large datasets. Of course, there are some data types that <em>require</em> a certain package to load in R: the <strong>readstata13</strong> package, for example, was developed solely to read in <code>.dta</code> files generated by versions of Stata 13 and above.</p>
<p>Figure <a href="input-output.html#fig:5-1">5.1</a> demonstrates that the relative performance gains of the <strong>data.table</strong> and <strong>readr</strong> approaches increase with data size, especially for data with many rows. Below around <span class="math inline">\(1\)</span> MB <code>read.csv()</code> is actually <em>faster</em> than <code>read_csv()</code> while <code>fread</code> is much faster than both, although these savings are likely to be inconsequential for such small datasets.</p>
<p>For files beyond <span class="math inline">\(100\)</span> MB in size <code>fread()</code> and <code>read_csv()</code> can be expected to be around <em>5 times faster</em> than <code>read.csv()</code>. This efficiency gain may be inconsequential for a one-off file of <span class="math inline">\(100\)</span> MB running on a fast computer (which still takes less than a minute with <code>read.csv()</code>), but could represent an important speed-up if you frequently load large text files.</p>

<div class="figure" style="text-align: center"><span id="fig:5-1"></span>
<img src="_main_files/figure-html/5-1-1.png" alt="Benchmarks of base, data.table and readr approches for reading csv files, using the functions read.csv(), fread() and read_csv(), respectively. The facets ranging from \(2\) to \(200\) represent the number of columns in the csv file." width="90%" />
<p class="caption">
Figure 5.1: Benchmarks of base, data.table and readr approches for reading csv files, using the functions read.csv(), fread() and read_csv(), respectively. The facets ranging from <span class="math inline">\(2\)</span> to <span class="math inline">\(200\)</span> represent the number of columns in the csv file.
</p>
</div>
<p>When tested on a large (<span class="math inline">\(4\)</span>GB) <code>.csv</code> file it was found that <code>fread()</code> and <code>read_csv()</code> were almost identical in load times and that <code>read.csv()</code> took around <span class="math inline">\(5\)</span> times longer. This consumed more than <span class="math inline">\(10\)</span>GB of RAM, making it unsuitable to run on many computers (see Section <a href="hardware.html#ram">8.3</a> for more on memory). Note that both <strong>readr</strong> and base methods can be made significantly faster by pre-specifying the column types at the outset (see below). Further details are provided by the help in <code>?read.table</code>.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="input-output.html#cb120-1"></a><span class="kw">read.csv</span>(file_name, <span class="dt">colClasses =</span> <span class="kw">c</span>(<span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;numeric&quot;</span>))</span></code></pre></div>
<p>In some cases with R programming there is a trade-off between speed and robustness. This is illustrated below with reference to differences in how the <strong>readr</strong>, <strong>data.table</strong> and base R approaches handle unexpected values. Figure <a href="input-output.html#fig:5-1">5.1</a> highlights the benefit of switching to <code>fread()</code> and (eventually) to <code>read_csv()</code> as the dataset size increases. For a small (<span class="math inline">\(1\)</span>MB) dataset:
<code>fread()</code> is around <span class="math inline">\(5\)</span> times faster than base R.</p>
<div id="differences-between-fread-and-read_csv" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Differences between <code>fread()</code> and <code>read_csv()</code></h3>
<p>The file <code>voc_voyages</code> was taken from a dataset on Dutch naval expeditions used with permission from the CWI Database Architectures Group. The data is described more fully at <a href="https://www.monetdb.org/Documentation/UserGuide/MonetDB-R">monetdb.org</a>. From this dataset we primarily use the ‘voyages’ table which lists Dutch shipping expeditions by their date of departure.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="input-output.html#cb121-1"></a>fname =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/voc_voyages.tsv&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;efficient&quot;</span>)</span>
<span id="cb121-2"><a href="input-output.html#cb121-2"></a>voyages_base =<span class="st"> </span><span class="kw">read.delim</span>(fname)</span></code></pre></div>
<p>When we run the equivalent operation using <strong>readr</strong>,</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="input-output.html#cb122-1"></a>voyages_readr =<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_tsv</span>(fname)</span>
<span id="cb122-2"><a href="input-output.html#cb122-2"></a><span class="co">#&gt; </span></span>
<span id="cb122-3"><a href="input-output.html#cb122-3"></a><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb122-4"><a href="input-output.html#cb122-4"></a><span class="co">#&gt; cols(</span></span>
<span id="cb122-5"><a href="input-output.html#cb122-5"></a><span class="co">#&gt;   .default = col_character(),</span></span>
<span id="cb122-6"><a href="input-output.html#cb122-6"></a><span class="co">#&gt;   number = col_double(),</span></span>
<span id="cb122-7"><a href="input-output.html#cb122-7"></a><span class="co">#&gt;   number_sup = col_logical(),</span></span>
<span id="cb122-8"><a href="input-output.html#cb122-8"></a><span class="co">#&gt;   trip = col_double(),</span></span>
<span id="cb122-9"><a href="input-output.html#cb122-9"></a><span class="co">#&gt;   tonnage = col_double(),</span></span>
<span id="cb122-10"><a href="input-output.html#cb122-10"></a><span class="co">#&gt;   hired = col_logical(),</span></span>
<span id="cb122-11"><a href="input-output.html#cb122-11"></a><span class="co">#&gt;   departure_date = col_date(format = &quot;&quot;),</span></span>
<span id="cb122-12"><a href="input-output.html#cb122-12"></a><span class="co">#&gt;   cape_arrival = col_date(format = &quot;&quot;),</span></span>
<span id="cb122-13"><a href="input-output.html#cb122-13"></a><span class="co">#&gt;   cape_departure = col_date(format = &quot;&quot;),</span></span>
<span id="cb122-14"><a href="input-output.html#cb122-14"></a><span class="co">#&gt;   cape_call = col_logical(),</span></span>
<span id="cb122-15"><a href="input-output.html#cb122-15"></a><span class="co">#&gt;   arrival_date = col_date(format = &quot;&quot;),</span></span>
<span id="cb122-16"><a href="input-output.html#cb122-16"></a><span class="co">#&gt;   next_voyage = col_double()</span></span>
<span id="cb122-17"><a href="input-output.html#cb122-17"></a><span class="co">#&gt; )</span></span>
<span id="cb122-18"><a href="input-output.html#cb122-18"></a><span class="co">#&gt; ℹ Use `spec()` for the full column specifications.</span></span>
<span id="cb122-19"><a href="input-output.html#cb122-19"></a><span class="co">#&gt; Warning: 77 parsing failures.</span></span>
<span id="cb122-20"><a href="input-output.html#cb122-20"></a><span class="co">#&gt;  row   col           expected actual                                                       file</span></span>
<span id="cb122-21"><a href="input-output.html#cb122-21"></a><span class="co">#&gt; 1023 hired 1/0/T/F/TRUE/FALSE 1664   &#39;/home/travis/R/Library/efficient/extdata/voc_voyages.tsv&#39;</span></span>
<span id="cb122-22"><a href="input-output.html#cb122-22"></a><span class="co">#&gt; 1025 hired 1/0/T/F/TRUE/FALSE 1664   &#39;/home/travis/R/Library/efficient/extdata/voc_voyages.tsv&#39;</span></span>
<span id="cb122-23"><a href="input-output.html#cb122-23"></a><span class="co">#&gt; 1030 hired 1/0/T/F/TRUE/FALSE 1664   &#39;/home/travis/R/Library/efficient/extdata/voc_voyages.tsv&#39;</span></span>
<span id="cb122-24"><a href="input-output.html#cb122-24"></a><span class="co">#&gt; 1034 hired 1/0/T/F/TRUE/FALSE 1664/5 &#39;/home/travis/R/Library/efficient/extdata/voc_voyages.tsv&#39;</span></span>
<span id="cb122-25"><a href="input-output.html#cb122-25"></a><span class="co">#&gt; 1035 hired 1/0/T/F/TRUE/FALSE 1665   &#39;/home/travis/R/Library/efficient/extdata/voc_voyages.tsv&#39;</span></span>
<span id="cb122-26"><a href="input-output.html#cb122-26"></a><span class="co">#&gt; .... ..... .................. ...... ..........................................................</span></span>
<span id="cb122-27"><a href="input-output.html#cb122-27"></a><span class="co">#&gt; See problems(...) for more details.</span></span></code></pre></div>
<p>a warning is raised regarding row 2841 in the <code>built</code> variable. This is because <code>read_*()</code> decides what class each variable is based on the first <span class="math inline">\(1000\)</span> rows, rather than all rows, as base <code>read.*()</code> functions do. Printing the offending element</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="input-output.html#cb123-1"></a>voyages_base<span class="op">$</span>built[<span class="dv">2841</span>] <span class="co"># a factor.</span></span>
<span id="cb123-2"><a href="input-output.html#cb123-2"></a><span class="co">#&gt; [1] &quot;1721-01-01&quot;</span></span>
<span id="cb123-3"><a href="input-output.html#cb123-3"></a>voyages_readr<span class="op">$</span>built[<span class="dv">2841</span>] <span class="co"># an NA: text cannot be converted to numeric</span></span>
<span id="cb123-4"><a href="input-output.html#cb123-4"></a><span class="co">#&gt; [1] &quot;1721-01-01&quot;</span></span></code></pre></div>
<p>Reading the file using <strong>data.table</strong></p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="input-output.html#cb124-1"></a><span class="co"># Verbose warnings not shown</span></span>
<span id="cb124-2"><a href="input-output.html#cb124-2"></a>voyages_dt =<span class="st"> </span>data.table<span class="op">::</span><span class="kw">fread</span>(fname)</span></code></pre></div>
<p>generates 5 warning messages stating that columns 2, 4, 9, 10 and 11 were <code>Bumped to type character on data row ...</code>, with the offending rows printed in place of <code>...</code>. Instead of changing the offending values to <code>NA</code>, as <strong>readr</strong> does for the <code>built</code> column (9), <code>fread()</code> automatically converts any columns it thought of as numeric into characters. An additional feature of <code>fread</code> is that it can read-in a selection of the columns, either by their index or name, using the <code>select</code> argument. This is illustrated below by reading in only half of the columns (the first 11) from the voyages dataset and comparing the result with <code>fread()</code>’ing all the columns in.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="input-output.html#cb125-1"></a><span class="kw">microbenchmark</span>(<span class="dt">times =</span> <span class="dv">5</span>,</span>
<span id="cb125-2"><a href="input-output.html#cb125-2"></a>  <span class="dt">with_select =</span> data.table<span class="op">::</span><span class="kw">fread</span>(fname, <span class="dt">select =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">11</span>),</span>
<span id="cb125-3"><a href="input-output.html#cb125-3"></a>  <span class="dt">without_select =</span> data.table<span class="op">::</span><span class="kw">fread</span>(fname)</span>
<span id="cb125-4"><a href="input-output.html#cb125-4"></a>)</span>
<span id="cb125-5"><a href="input-output.html#cb125-5"></a><span class="co">#&gt; Unit: milliseconds</span></span>
<span id="cb125-6"><a href="input-output.html#cb125-6"></a><span class="co">#&gt;            expr  min   lq mean median   uq  max neval</span></span>
<span id="cb125-7"><a href="input-output.html#cb125-7"></a><span class="co">#&gt;     with_select 10.9 11.0 11.5   11.4 12.0 12.0     5</span></span>
<span id="cb125-8"><a href="input-output.html#cb125-8"></a><span class="co">#&gt;  without_select 15.3 15.7 16.4   15.7 17.3 18.2     5</span></span></code></pre></div>
<p>To summarise, the differences between base, <strong>readr</strong> and <strong>data.table</strong> functions for reading in data go beyond code execution times. The functions <code>read_csv()</code> and <code>fread()</code> boost speed partially at the expense of robustness because they decide column classes based on a small sample of available data. The similarities and differences between the approaches are summarised for the Dutch shipping data in Table <a href="input-output.html#tab:colclasses">5.1</a>.</p>
<table>
<caption><span id="tab:colclasses">Table 5.1: </span>Comparison of base, <strong>readr</strong> and <strong>data.table</strong> reading in the voyages data set.</caption>
<thead>
<tr class="header">
<th align="left">number</th>
<th align="left">boatname</th>
<th align="left">built</th>
<th align="left">departure_date</th>
<th align="left">Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">integer</td>
<td align="left">character</td>
<td align="left">character</td>
<td align="left">character</td>
<td align="left">base</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">character</td>
<td align="left">character</td>
<td align="left">Date</td>
<td align="left">readr</td>
</tr>
<tr class="odd">
<td align="left">integer</td>
<td align="left">character</td>
<td align="left">character</td>
<td align="left">IDate, Date</td>
<td align="left">data.table</td>
</tr>
</tbody>
</table>
<p>Table <a href="input-output.html#tab:colclasses">5.1</a> shows 4 main similarities and differences between the three read types of read function:</p>
<ul>
<li><p>For uniform data such as the ‘number’ variable in Table <a href="input-output.html#tab:colclasses">5.1</a>, all reading methods yield the same result (integer in this case).</p></li>
<li><p>For columns that are obviously characters such as ‘boatname’, the base method results in factors (unless <code>stringsAsFactors</code> is set to <code>FALSE</code>) whereas <code>fread()</code> and <code>read_csv()</code> functions return characters.</p></li>
<li><p>For columns in which the first 1000 rows are of one type but which contain anomalies, such as ‘built’ and ‘departure_data’ in the shipping example, <code>fread()</code> coerces the result to characters.
<code>read_csv()</code> and siblings, by contrast, keep the class that is correct for the first 1000 rows and sets the anomalous records to <code>NA</code>. This is illustrated in <a href="input-output.html#tab:colclasses">5.1</a>, where <code>read_tsv()</code> produces a <code>numeric</code> class for the ‘built’ variable, ignoring the non-numeric text in row 2841.</p></li>
<li><p><code>read_*()</code> functions generate objects of class <code>tbl_df</code>, an extension of the <code>data.frame</code> class, as discussed in Section <a href="data-carpentry.html#dplyr">6.4</a>. <code>fread()</code> generates objects of class <code>data.table()</code>. These can be used as standard data frames but differ subtly in their behaviour.</p></li>
</ul>
<p>An additional difference is that <code>read_csv()</code> creates data frames of class <code>tbl_df</code>, <em>and</em> <code>data.frame</code>. This makes no practical difference, unless the <strong>tibble</strong> package is loaded, as described in section <a href="data-carpentry.html#efficient-data-frames-with-tibble">6.2</a> in the next chapter.</p>
<p>The wider point associated with these tests is that functions that save time can also lead to additional considerations or complexities for your workflow. Taking a look at what is going on ‘under the hood’ of fast functions to increase speed, as we have done in this section, can help understand the knock-on consequences of choosing fast functions over slower functions from base R.</p>
</div>
<div id="preprocessing-text-outside-r" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Preprocessing text outside R</h3>
<p>There are circumstances when datasets become too large to read directly into R.
Reading in a <span class="math inline">\(4\)</span> GB text file using the functions tested above, for example, consumes all available RAM on a <span class="math inline">\(16\)</span> GB machine. To overcome this limitation, external <em>stream processing</em> tools can be used to preprocess large text files.
The following command, using the Linux command line ‘shell’ (or Windows based Linux shell emulator <a href="https://cygwin.com/install.html">Cygwin</a>) command <code>split</code>, for example, will break a large multi GB file into many chunks, each of which is more manageable for R:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb126-1"><a href="input-output.html#cb126-1"></a><span class="fu">split</span> -b100m bigfile.csv</span></code></pre></div>
<p>The result is a series of files, set to 100 MB each with the <code>-b100m</code> argument in the above code. By default these will be called <code>xaa</code>, <code>xab</code> and can be read in <em>one chunk at a time</em> (e.g. using <code>read.csv()</code>, <code>fread()</code> or <code>read_csv()</code>, described in the previous section) without crashing most modern computers.</p>
<p>Splitting a large file into individual chunks may allow it to be read into R.
This is not an efficient way to import large datasets, however, because it results in a non-random sample of the data this way.
A more efficient, robust and scalable way to work with large datasets is via databases, covered in Section <a href="data-carpentry.html#working-with-databases">6.6</a> in the next chapter.</p>
</div>
</div>
<div id="binary-file-formats" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Binary file formats</h2>
<p>There are limitations to plain text files. Even the trusty CSV format is “restricted to tabular data, lacks type-safety, and has limited precision for numeric values” <span class="citation">(Eddelbuettel, Stokely, and Ooms <a href="#ref-JSSv071i02" role="doc-biblioref">2016</a>)</span>.
Once you have read-in the raw data (e.g. from a plain text file) and tidied it (covered in the next chapter), it is common to want to save it for future use. Saving it after tidying is recommended, to reduce the chance of having to run all the data cleaning code again. We recommend saving tidied versions of large datasets in one of the binary formats covered in this section: this will decrease read/write times and file sizes, making your data more
portable.<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a></p>
<p>Unlike plain text files, data stored in binary formats cannot be read by humans. This allows space-efficient data compression but means that the files will be less language agnostic. R’s native file format, <code>.Rds</code>, for example may be difficult to read and write using external programs such as Python or LibreOffice Calc. This section provides an overview of binary file formats in R, with benchmarks to show how they compare with the plain text format <code>.csv</code> covered in the previous section.</p>
<div id="native-binary-formats-rdata-or-rds" class="section level3" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Native binary formats: Rdata or Rds?</h3>
<p><code>.Rds</code> and <code>.RData</code> are R’s native binary file formats. These formats are optimised for speed and compression ratios. But what is the difference between them? The following code chunk demonstrates the key difference between them:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="input-output.html#cb127-1"></a><span class="kw">save</span>(df_co2, <span class="dt">file =</span> <span class="st">&quot;extdata/co2.RData&quot;</span>)</span>
<span id="cb127-2"><a href="input-output.html#cb127-2"></a><span class="kw">saveRDS</span>(df_co2, <span class="st">&quot;extdata/co2.Rds&quot;</span>)</span>
<span id="cb127-3"><a href="input-output.html#cb127-3"></a><span class="kw">load</span>(<span class="st">&quot;extdata/co2.RData&quot;</span>)</span>
<span id="cb127-4"><a href="input-output.html#cb127-4"></a>df_co2_rds =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;extdata/co2.Rds&quot;</span>)</span>
<span id="cb127-5"><a href="input-output.html#cb127-5"></a><span class="kw">identical</span>(df_co2, df_co2_rds)</span>
<span id="cb127-6"><a href="input-output.html#cb127-6"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The first method is the most widely used. It uses the <code>save()</code> function which takes any number of R objects and writes them to a file, which must be specified by the <code>file =</code> argument. <code>save()</code> is like <code>save.image()</code>, which saves <em>all</em> the objects currently loaded in R.</p>
<p>The second method is slightly less used but we recommend it. Apart from being slightly more concise for saving single R objects, the <code>readRDS()</code> function is more flexible: as shown in the subsequent line, the resulting object can be assigned to any name. In this case we called it <code>df_co2_rds</code> (which we show to be identical to <code>df_co2</code>, loaded with the <code>load()</code> command) but we could have called it anything or simply printed it to the console.</p>
<p>Using <code>saveRDS()</code> is good practice because it forces you to specify object names. If you use <code>save()</code> without care, you could forget the names of the objects you saved and accidentally overwrite objects that already existed.</p>
</div>
<div id="the-feather-file-format" class="section level3" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> The feather file format</h3>
<p>Feather was developed as a collaboration between R and Python developers to create a fast, light and language agnostic format for storing data frames. The code chunk below shows how it can be used to save and then re-load the <code>df_co2</code> dataset loaded previously in both R and Python:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="input-output.html#cb128-1"></a><span class="kw">library</span>(<span class="st">&quot;feather&quot;</span>)</span>
<span id="cb128-2"><a href="input-output.html#cb128-2"></a><span class="kw">write_feather</span>(df_co2, <span class="st">&quot;extdata/co2.feather&quot;</span>)</span>
<span id="cb128-3"><a href="input-output.html#cb128-3"></a>df_co2_feather =<span class="st"> </span><span class="kw">read_feather</span>(<span class="st">&quot;extdata/co2.feather&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb129"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb129-1"><a href="input-output.html#cb129-1"></a><span class="im">import</span> feather</span>
<span id="cb129-2"><a href="input-output.html#cb129-2"></a>path <span class="op">=</span> <span class="st">&#39;data/co2.feather&#39;</span></span>
<span id="cb129-3"><a href="input-output.html#cb129-3"></a>df_co2_feather <span class="op">=</span> feather.read_dataframe(path)</span></code></pre></div>
</div>
<div id="benchmarking-binary-file-formats" class="section level3" number="5.4.3">
<h3><span class="header-section-number">5.4.3</span> Benchmarking binary file formats</h3>
<p>We know that binary formats are advantageous from space and read/write time perspectives, but how much so? The benchmarks in this section, based on large matrices containing random numbers, are designed to help answer this question. Figure <a href="input-output.html#fig:5-2">5.2</a> shows the <em>relative</em> efficiency gains of the feather and Rds formats, compared with base CSV. From left to right, figure <a href="input-output.html#fig:5-2">5.2</a> shows benefits in terms of file size, read times, and write times.</p>
<p>In terms of file size, Rds files perform the best, occupying just over a quarter of the hard disc space compared with the equivalent CSV files. The equivalent feather format also outperformed the CSV format, occupying around half the disc space.</p>

<div class="figure" style="text-align: center"><span id="fig:5-2"></span>
<img src="_main_files/figure-html/5-2-1.png" alt="Comparison of the performance of binary formats for reading and writing datasets with 20 column with the plain text format CSV. The functions used to read the files were read.csv(), readRDS() and feather::read_feather() respectively. The functions used to write the files were write.csv(), saveRDS() and feather::write_feather()." width="90%" />
<p class="caption">
Figure 5.2: Comparison of the performance of binary formats for reading and writing datasets with 20 column with the plain text format CSV. The functions used to read the files were read.csv(), readRDS() and feather::read_feather() respectively. The functions used to write the files were write.csv(), saveRDS() and feather::write_feather().
</p>
</div>
<p>The results of this simple disk usage benchmark show that saving data in a compressed binary format can save space and if your data will be shared on-line, reduce data download time and bandwidth usage. But how does each method compare from a computational efficiency perspective? The read and write times for each file format are illustrated in the middle and right hand panels of <a href="input-output.html#fig:5-2">5.2</a>.</p>
<p>The results show that file size is not a reliable predictor of data read and write times. This is due to the computational overheads of compression. Although feather files occupied more disc space, they were roughly equivalent in terms of read times: the functions <code>read_feather()</code> and <code>readRDS()</code> were consistently around 10 times faster than <code>read.csv()</code>. In terms of write times, feather excels: <code>write_feather()</code> was around 10 times faster than <code>write.csv()</code>, whereas <code>saveRDS()</code> was only around 1.2 times faster.</p>
<div class="rmdnote">
<p>
Note that the performance of different file formats depends on the content of the data being saved. The benchmarks above showed savings for matrices of random numbers. For real life data, the results would be quite different. The <code>voyages</code> dataset, saved as an Rds file, occupied less than a quarter the disc space as the original TSV file, whereas the file size was <em>larger</em> than the original when saved as a feather file!
</p>
</div>
</div>
<div id="protocol-buffers" class="section level3" number="5.4.4">
<h3><span class="header-section-number">5.4.4</span> Protocol Buffers</h3>
<p>Google’s <a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a> offers a portable, efficient and scalable solution to binary data storage. A recent package, <strong>RProtoBuf</strong>, provides an R interface. This approach is not covered in this book, as it is new, advanced and not (at the time of writing) widely used in the R community. The approach is discussed in detail in a <a href="https://www.jstatsoft.org/article/view/v071i02">paper</a> on the subject, which also provides an excellent overview of the issues associated with different file formats <span class="citation">(Eddelbuettel, Stokely, and Ooms <a href="#ref-JSSv071i02" role="doc-biblioref">2016</a>)</span>.</p>
</div>
</div>
<div id="download" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Getting data from the internet</h2>
<p>The code chunk below shows how the functions
<code>download.file()</code> and <code>unzip()</code> can be used to download and unzip a dataset from the internet.
(Since R 3.2.3 the base function <code>download.file()</code> can be used to download from secure (<code>https://</code>) connections on any operating system.)
R can automate processes that are often performed manually, e.g. through the graphical user interface of a web browser, with potential advantages for reproducibility and programmer efficiency. The result is data stored neatly in the <code>data</code> directory ready to be imported. Note we deliberately kept the file name intact, enhancing understanding of the data’s <em>provenance</em> so future users can quickly find out where the data came from. Note also that part of the dataset is stored in the <strong>efficient</strong> package. Using R for basic file management can help create a reproducible workflow, as illustrated below.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="input-output.html#cb130-1"></a>url =<span class="st"> &quot;https://www.monetdb.org/sites/default/files/voc_tsvs.zip&quot;</span></span>
<span id="cb130-2"><a href="input-output.html#cb130-2"></a><span class="kw">download.file</span>(url, <span class="st">&quot;voc_tsvs.zip&quot;</span>) <span class="co"># download file</span></span>
<span id="cb130-3"><a href="input-output.html#cb130-3"></a><span class="kw">unzip</span>(<span class="st">&quot;voc_tsvs.zip&quot;</span>, <span class="dt">exdir =</span> <span class="st">&quot;data&quot;</span>) <span class="co"># unzip files</span></span>
<span id="cb130-4"><a href="input-output.html#cb130-4"></a><span class="kw">file.remove</span>(<span class="st">&quot;voc_tsvs.zip&quot;</span>) <span class="co"># tidy up by removing the zip file</span></span></code></pre></div>
<p>This workflow applies equally to downloading and loading single files. Note that one could make the code more concise by replacing the second line with <code>df = read.csv(url)</code>. However, we recommend downloading the file to disk so that if for some reason it fails (e.g. if you would like to skip the first few lines), you don’t have to keep downloading the file over and over again. The code below downloads and loads data on atmospheric concentrations of CO<sup>2</sup>. Note that this dataset is also available from the <strong>datasets</strong> package.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="input-output.html#cb131-1"></a>url =<span class="st"> &quot;https://vincentarelbundock.github.io/Rdatasets/csv/datasets/co2.csv&quot;</span></span>
<span id="cb131-2"><a href="input-output.html#cb131-2"></a><span class="kw">download.file</span>(url, <span class="st">&quot;extdata/co2.csv&quot;</span>)</span>
<span id="cb131-3"><a href="input-output.html#cb131-3"></a>df_co2 =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;extdata/co2.csv&quot;</span>)</span></code></pre></div>
<p>There are now many R packages to assist with the download and import of data. The organisation <a href="https://ropensci.org/">rOpenSci</a> supports a number of these.
The example below illustrates this using the WDI package (not supported by rOpenSci) to access World Bank data on CO2 emissions in the transport sector:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="input-output.html#cb132-1"></a><span class="kw">library</span>(<span class="st">&quot;WDI&quot;</span>)</span>
<span id="cb132-2"><a href="input-output.html#cb132-2"></a><span class="kw">WDIsearch</span>(<span class="st">&quot;CO2&quot;</span>) <span class="co"># search for data on a topic</span></span>
<span id="cb132-3"><a href="input-output.html#cb132-3"></a>co2_transport =<span class="st"> </span><span class="kw">WDI</span>(<span class="dt">indicator =</span> <span class="st">&quot;EN.CO2.TRAN.ZS&quot;</span>) <span class="co"># import data</span></span></code></pre></div>
<p>There will be situations where you cannot download the data directly or when the data cannot be made available. In this case, simply providing a comment relating to the data’s origin (e.g. <code># Downloaded from http://example.com</code>) before referring to the dataset can greatly improve the utility of the code to yourself and others.</p>
<p>There are a number of R packages that provide more advanced functionality than simply downloading files. The CRAN task view on <a href="https://cran.r-project.org/web/views/WebTechnologies.html">Web technologies</a> provides a comprehensive list. The two packages for interacting with web pages are <strong>httr</strong> and <strong>RCurl</strong>. The former package provides (a relatively) user-friendly interface for executing standard HTTP methods, such as <code>GET</code> and <code>POST</code>. It also provides support for web authentication protocols and returns HTTP status codes that are essential for debugging. The <strong>RCurl</strong> package focuses on lower-level support and is particularly useful for web-based XML support or FTP operations.</p>
</div>
<div id="accessing-data-stored-in-packages" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> Accessing data stored in packages</h2>
<p>Most well documented packages provide some example data for you to play with. This can help demonstrate use cases in specific domains, that uses a particular data format. The command <code>data(package = "package_name")</code> will show the datasets in a package. Datasets provided by <strong>dplyr</strong>, for example, can be viewed with <code>data(package = "dplyr")</code>.</p>
<p>Raw data (i.e. data which has not been converted into R’s native <code>.Rds</code> format) is usually located within the sub-folder <code>extdata</code> in R (which corresponds to <code>inst/extdata</code> when developing packages. The function <code>system.file()</code> outputs file paths associated with specific packages. To see all the external files within the <strong>readr</strong> package, for example, one could use the following command:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="input-output.html#cb133-1"></a><span class="kw">list.files</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;readr&quot;</span>))</span>
<span id="cb133-2"><a href="input-output.html#cb133-2"></a><span class="co">#&gt; [1] &quot;challenge.csv&quot;     &quot;epa78.txt&quot;         &quot;example.log&quot;      </span></span>
<span id="cb133-3"><a href="input-output.html#cb133-3"></a><span class="co">#&gt; [4] &quot;fwf-sample.txt&quot;    &quot;massey-rating.txt&quot; &quot;mtcars.csv&quot;       </span></span>
<span id="cb133-4"><a href="input-output.html#cb133-4"></a><span class="co">#&gt; [7] &quot;mtcars.csv.bz2&quot;    &quot;mtcars.csv.zip&quot;</span></span></code></pre></div>
<p>Further, to ‘look around’ to see what files are stored in a particular package, one could type the following, taking advantage of RStudio’s intellisense file completion capabilities (using copy and paste to enter the file path):</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="input-output.html#cb134-1"></a><span class="kw">system.file</span>(<span class="dt">package =</span> <span class="st">&quot;readr&quot;</span>)</span>
<span id="cb134-2"><a href="input-output.html#cb134-2"></a><span class="co">#&gt; [1] &quot;/home/robin/R/x86_64-pc-linux-gnu-library/3.3/readr&quot;</span></span></code></pre></div>
<p>Hitting <code>Tab</code> after the second command should trigger RStudio to create a miniature pop-up box listing the files within the folder, as illustrated in figure <a href="input-output.html#fig:5-3">5.3</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:5-3"></span>
<img src="figures/f5_3_rstudio-package-filepath-intellisense.png" alt="Discovering files in R packages using RStudio's 'intellisense'." width="50%" />
<p class="caption">
Figure 5.3: Discovering files in R packages using RStudio’s ‘intellisense’.
</p>
</div>

<!-- To do: -->
<!-- Talk about merge vs *_join -->
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-JSSv071i02">
<p>Eddelbuettel, Dirk, Murray Stokely, and Jeroen Ooms. 2016. “RProtoBuf: Efficient Cross-Language Data Serialization in R.” <em>Journal of Statistical Software</em> 71 (1): 1–24. <a href="https://doi.org/10.18637/jss.v071.i02">https://doi.org/10.18637/jss.v071.i02</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="13">
<li id="fn13"><p>Geographical data, for example, can be slow to read in external formats. A large <code>.shp</code> or <code>.geojson</code> file can take more than <span class="math inline">\(100\)</span> times longer to load than an equivalent <code>.Rds</code> or <code>.Rdata</code> file.<a href="input-output.html#fnref13" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="workflow.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-carpentry.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/csgillespie/efficientR/edit/master/05-input-output.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
